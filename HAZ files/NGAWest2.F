C  ***** PEER NGA-West 2 MODELS (2013) **********

c ---------------------------------------------------------------------            
C ** Idriss (NGA-2013) Horizontal **
C     PEER Report 2013/08
C        NGA-West2 Model for Estimating Average Horizontal Values of 
C            Pseudo-Absolute Spectral Accelerations Generated by
C            Crustal Earthquakes
C         I. M. Idriss
C     Notes:
C        Applicable Range (see Abstract):  
C           5 <= M <= 8.5
C           Vs>=450 m/sec
C              for Vs>1200 use Vs=1200
C           Rrup <= 150 km
C        Mechanisms: Strike-slip and Norml (0)
C                    Reverse and Oblique (1)
c ---------------------------------------------------------------------            
      Subroutine I_NGAWest2_2013 ( m, Rrup, ftype, vs30, specT,
     1                     period2, lnY, sigma, iflag )

C     Last Updated: 5/18/13

      implicit none

      integer MAXPER
      parameter (MAXPER=23)
      REAL Period(MAXPER), a1mlt675(MAXPER), a2mlt675(MAXPER), a3mlt675(MAXPER)
      REAL b1mlt675(MAXPER), b2mlt675(MAXPER)
      REAL a1(MAXPER), a2(MAXPER), a3(MAXPER), b1(MAXPER), b2(MAXPER) 
      real gam(MAXPER), phi(MAXPER), xsi(MAXPER), period1

      REAL M, Rrup, Vs30, specT, sigma
      REAL SOF, period2, lnY, PhiT, gamT, XsiT, ftype

      real a1T, a2T, a3T, b1T, b2T, a1mlt675T, a2mlt675T, a3mlt675T, b1mlt675T, b2mlt675T
      integer iflag, count1, count2, nPer, i

      data Period / 0.0, 0.01, 0.02, 0.03, 0.04, 0.05, 0.075, 0.1, 0.15, 0.2, 0.25,
     1              0.3, 0.4, 0.5, 0.75, 1.0, 1.5, 2.0, 3.0, 4.0, 5.0, 7.5, 10.0 /
      data a1mlt675 / 7.0887, 7.0887, 7.1157, 7.2087, 7.3287, 6.2638, 5.9051, 
     1                7.5791, 8.019, 9.2812, 9.5804, 9.8912, 9.5342, 9.2142, 
     2                8.3517, 7.0453, 5.1307, 3.361, 0.1784, -2.4301, -4.357, 
     3               -7.8275, -9.2857 /
      data a2mlt675 / 0.2058, 0.2058, 0.2058, 0.2058, 0.2058, 0.0625, 0.1128, 
     1                0.0848, 0.1713, 0.1041, 0.0875, 0.0003, 0.0027, 0.0399, 
     2                0.0689, 0.16, 0.2429, 0.3966, 0.756, 0.9283, 1.1209, 
     3                1.4016, 1.5574 /
      data a3mlt675 / 0.0589, 0.0589, 0.0589, 0.0589, 0.0589, 0.0417, 0.0527, 
     1                0.0442, 0.0329, 0.0188, 0.0095, -0.0039, -0.0133, -0.0224,
     2               -0.0267, -0.0198, -0.0367, -0.0291, -0.0214, -0.024, -0.0202, 
     3               -0.0219, -0.0035 /
      data b1mlt675 / 2.9935, 2.9935, 2.9935, 2.9935, 2.9935, 2.8664, 2.9406, 
     1                3.019, 2.7871, 2.8611, 2.8289, 2.8423, 2.83, 2.856, 2.7544, 
     2                2.7339, 2.68, 2.6837, 2.6907, 2.5782, 2.5468, 2.4478, 2.3922 /
      data b2mlt675 / -0.2287, -0.2287, -0.2287, -0.2287, -0.2287, -0.2418, 
     1                -0.2513, -0.2516, -0.2236, -0.2229, -0.22, -0.2284, -0.2318,
     2                -0.2337, -0.2392, -0.2398, -0.2417, -0.245, -0.2389, -0.2514,
     3                -0.2541, -0.2593, -0.2586 /
      data xsi / -0.854, -0.854, -0.854, -0.854, -0.854, -0.631, -0.591, -0.757, 
     1           -0.911, -0.998, -1.042, -1.03, -1.019, -1.023, -1.056, -1.009, 
     2           -0.898, -0.851, -0.761, -0.675, -0.629, -0.531, -0.586 /
      data gam / -0.0027, -0.0027, -0.0027, -0.0027, -0.0027, -0.0061, -0.0056, 
     1           -0.0042, -0.0046, -0.003, -0.0028, -0.0029, -0.0028, -0.0021, 
     2           -0.0029, -0.0032, -0.0033, -0.0032, -0.0031, -0.0051, -0.0059, 
     3           -0.0057, -0.0061 /
      data phi / 0.08, 0.08, 0.08, 0.08, 0.08, 0.08, 0.08, 0.08, 0.08, 0.08, 0.08, 
     1           0.08, 0.08, 0.08, 0.08, 0.06, 0.04, 0.02, 0.02, 0.0, 0.0, 0.0, 0.0 /


      data a1 / 9.0138, 9.0138, 9.0408, 9.1338, 9.2538, 7.9837, 7.756, 9.4252, 
     1          9.6242, 11.13, 11.3629, 11.7818, 11.6097, 11.4484, 10.9065, 
     2          9.8565, 8.3363, 6.8656, 4.1178, 1.8102, 0.0977, -3.0563, -4.4387 /
      data a2 / -0.0794, -0.0794, -0.0794, -0.0794, -0.0794, -0.1923, -0.1614, 
     1          -0.1887, -0.0665, -0.1698, -0.1766, -0.2798, -0.3048, -0.2911, 
     2          -0.3097, -0.2565, -0.232, -0.1226, 0.1724, 0.3001, 0.4609, 
     3           0.6948, 0.8393 /
      data a3 / 0.0589, 0.0589, 0.0589, 0.0589, 0.0589, 0.0417, 0.0527, 0.0442, 
     1          0.0329, 0.0188, 0.0095, -0.0039, -0.0133, -0.0224, -0.0267, 
     2         -0.0198, -0.0367, -0.0291, -0.0214, -0.024, -0.0202, 
     3         -0.0219, -0.0035 /
      data b1 / 2.9935, 2.9935, 2.9935, 2.9935, 2.9935, 2.7995, 2.8143, 
     1          2.8131, 2.4091, 2.4938, 2.3773, 2.3772, 2.3413, 2.3477, 2.2042,
     2          2.1493, 2.0408, 2.0013, 1.9408, 1.7763, 1.703, 1.5212, 1.4195 /
      data b2 / -0.2287, -0.2287, -0.2287, -0.2287, -0.2287, -0.2319, -0.2326, 
     1          -0.2211, -0.1676, -0.1685, -0.1531, -0.1595, -0.1594, -0.1584, 
     2          -0.1577, -0.1532, -0.147, -0.1439, -0.1278, -0.1326, -0.1291, 
     3          -0.122, -0.1145 /

      
C Find the requested spectral period and corresponding coefficients
      nPer = 23
C First check for the PGA case (i.e., specT=0.0) 
      if (specT .eq. 0.0) then
         period1 = period(1)
         a1T     = a1(1)
         a2T     = a2(1)
         a3T     = a3(1)
         b1T     = b1(1)
         b2T     = b2(1)
         a1mlt675T = a1mlt675(1)
         a2mlt675T = a2mlt675(1)
         a3mlt675T = a3mlt675(1)
         b1mlt675T = b1mlt675(1)
         b2mlt675T = b2mlt675(1)
         xsiT   = xsi(1)
         gamT   = gam(1)
         phiT   = phi(1)
         goto 1011
      elseif (specT .gt. 0.0) then
C Now loop over the spectral period range of the attenuation relationship.
         do i=2,nper-1
            if (specT .ge. period(i) .and. specT .le. period(i+1) ) then
               count1 = i
               count2 = i+1
               goto 1020 
            endif
         enddo
      endif

C Selected spectral period is outside range defined by attenuaton model.
      write (*,*) 
      write (*,*) 'Idriss (NGA West2-2013) Horizontal'
      write (*,*) 'attenuation model is not defined for a '
      write (*,*) ' spectral period of: ' 
      write (*,'(a10,f10.5)') ' Period = ',specT
      write (*,*) 'This spectral period is outside the defined'
      write (*,*) 'period range in the code or beyond the range'
      write (*,*) 'of spectral periods for interpolation.'
      write (*,*) 'Please check the input file.'
      write (*,*) 
      stop 99

C Interpolate the coefficients for the requested spectral period.
 1020       call interp (period(count1),period(count2),a1(count1),a1(count2),
     +                   specT,a1T,iflag)
            call interp (period(count1),period(count2),a2(count1),a2(count2),
     +                   specT,a2T,iflag)
            call interp (period(count1),period(count2),a3(count1),a3(count2),
     +                   specT,a3T,iflag)
            call interp (period(count1),period(count2),b1(count1),b1(count2),
     +                   specT,b1T,iflag)
            call interp (period(count1),period(count2),b2(count1),b2(count2),
     +                   specT,b2T,iflag)
            call interp (period(count1),period(count2),a1mlt675(count1),a1mlt675(count2),
     +                   specT,a1mlt675T,iflag)
            call interp (period(count1),period(count2),a2mlt675(count1),a2mlt675(count2),
     +                   specT,a2mlt675T,iflag)
            call interp (period(count1),period(count2),a3mlt675(count1),a3mlt675(count2),
     +                   specT,a3mlt675T,iflag)
            call interp (period(count1),period(count2),b1mlt675(count1),b1mlt675(count2),
     +                   specT,b1mlt675T,iflag)
            call interp (period(count1),period(count2),b2mlt675(count1),b2mlt675(count2),
     +                   specT,b2mlt675T,iflag)
            call interp (period(count1),period(count2),phi(count1),phi(count2),
     +                   specT,phiT,iflag)
            call interp (period(count1),period(count2),gam(count1),gam(count2),
     +                   specT,gamT,iflag)
            call interp (period(count1),period(count2),xsi(count1),xsi(count2),
     +                   specT,xsiT,iflag)

 1011 period1 = specT                                                                                                              

C.....Compute the Ground motion.......

C.....Set the mechanism term.....................
C     Strike-slip and normal events --> SOF = 0
C     Reverse and oblique events     --> SOF = 1
C     Otherwise assume SOF = 0
      if (ftype .eq. 1.0) then
         SOF = 1.0
      else
         SOF = 0.0
      endif

      if (m .lt. 6.75) then
         lnY = a1mlt675T + a2mlt675T*m + a3mlt675T*(8.5 - m)**2.0 - (b1mlt675T+b2mlt675T*m) * alog(Rrup+10.0) +
     1         xsiT*alog(Vs30) + gamT*rRup + SOF*phiT
      else
         lnY = a1T + a2T*m + a3T*(8.5 - m)**2.0 - (b1T+b2T*m) * alog(Rrup+10.0) +
     1         xsiT*alog(Vs30) + gamT*rRup + SOF*phiT
      endif

C     Convert ground motion to units of gals.
      lnY = lnY + 6.89

C     Compute Sigma which is Period and magnitude dependent.
C     Note report does not state a limit on sigma for M<5 but 
C     Since model is only applicable for M>=5 a limit is retained
C     for sigma with M<5 equal to M=5 values. 
      if (specT .le. 0.05) then
         if (m .le. 5.0) then
            sigma = 1.18 + 0.035*alog(0.05) - 0.06*5.0
         elseif (m .ge. 7.5) then
            sigma = 1.18 + 0.035*alog(0.05) - 0.06*7.5
         else
            sigma = 1.18 + 0.035*alog(0.05) - 0.06*m
         endif
      elseif (specT .ge. 3.0) then
         if (m .le. 5.0) then
            sigma = 1.18 + 0.035*alog(3.00) - 0.06*5.0
         elseif (m .ge. 7.5) then
            sigma = 1.18 + 0.035*alog(3.00) - 0.06*7.5
         else
            sigma = 1.18 + 0.035*alog(3.00) - 0.06*m
         endif
      else
         if (m .le. 5.0) then
            sigma = 1.18 + 0.035*alog(specT) - 0.06*5.0
         elseif (m .ge. 7.5) then
            sigma = 1.18 + 0.035*alog(specT) - 0.06*7.5
         else
            sigma = 1.18 + 0.035*alog(specT) - 0.06*m
         endif
      endif

      period2 = period1

      return
      end 


c ---------------------------------------------------------------------------            
C     *** Boore, Stewart, Seyhan and Atkinson NGA West 2 (NGA West2-2013) ***
C         Earthquake Spectra Report:
C            NGA-West2 Equations for Predicting PGA, PGV, and 5%-Damped
C                PSA for Shallow Crustal Earthquakes.
C             D. M. Boore, J. P. Stewart, E. Seyhan, and G. M. Atkinson
C     Notes:
C        Applicable Range:
C            3.0 < M < 8.5 (Strike-Slip)
C            3.0 < M < 7.0 (Normal)
C            Distance < 300km
C            150 < Vs < 1500 m/s
C            0.0 < Z1 < 3.0 km
C            Region Flag:
C               0 = Global 
C               1 = China-Turkey
C               2 = Italy-Japan
c ---------------------------------------------------------------------------            

      subroutine BSSA_NGAWest2_2013 ( mag, Rbjf, specT, 
     1        period2, lnY, sigma, iflag, vs, ftype, pga4nl, z10, regionflag, basinflag,
     1        phi, tau ) 

C     Last Updated: 9/16/13

      parameter (MAXPER=107)
      REAL Period(MAXPER), c1(MAXPER), c2(MAXPER), c3(MAXPER)
      real h(MAXPER), DC3ChinaTrk(MAXPER), DC3ItalyJapan(MAXPER), e0(MAXPER)
      real e1(MAXPER), e2(MAXPER), e3(MAXPER), e4(MAXPER)
      real e5(MAXPER), e6(MAXPER), mh(MAXPER), c(MAXPER), Vc(MAXPER)
      real phi2(MAXPER), phi3(MAXPER), f4(MAXPER)
      real l1(MAXPER), l2(MAXPER), t1(MAXPER), t2(MAXPER)
      real f5(MAXPER), rjbbar(MAXPER), Dfr(MAXPER), Dfv(MAXPER)
      real R1(MAXPER), R2(MAXPER), DC3Global(MAXPER), f6(MAXPER), f7(MAXPER)

      real Mref, Rref, Vref, f1, f3, specT
      REAL MAG, RBJF, VS, z10
      real ftype, Rp, R
      INTEGER iFlag, count1, count2, regionflag, basinflag
      real lnY, mechS, mechN, mechR, pga4nl
      real f2, flin, fBasin, phi, tau
      real c1T, c2T, c3T, hT, e0T, e1T, e2T, e3T, e4T
      real e5T, e6T, mhT, cT, VcT, phi2T, phi3T, f4T, l1T, l2T, t1T, t2T
      real deltaz1, f5T, rjbbarT, DfrT, DfvT, R1T, R2T, DC3GlobalT
      real DC3ChinaTrkT, DC3ItalyJapanT, f6T, f7T

      Data Period / 0.0, -1.0, 0.01, 0.02, 0.022, 0.025, 0.029, 0.03, 0.032, 0.035, 0.036, 0.04, 0.042, 
     1     0.044, 0.045, 0.046, 0.048, 0.05, 0.055, 0.06, 0.065, 0.067, 0.07, 0.075, 0.08, 0.085, 0.09, 
     1     0.095, 0.1, 0.11, 0.12, 0.13, 0.133, 0.14, 0.15, 0.16, 0.17, 0.18, 0.19, 0.2, 0.22, 0.24, 0.25, 
     1     0.26, 0.28, 0.29, 0.3, 0.32, 0.34, 0.35, 0.36, 0.38, 0.4, 0.42, 0.44, 0.45, 0.46, 0.48, 0.5, 0.55, 
     1     0.6, 0.65, 0.667, 0.7, 0.75, 0.8, 0.85, 0.9, 0.95, 1.0, 1.1, 1.2, 1.3, 1.4, 1.5, 1.6, 1.7, 1.8, 1.9,
     1     2.0, 2.2, 2.4, 2.5, 2.6, 2.8, 3.0, 3.2, 3.4, 3.5, 3.6, 3.8, 4.0, 4.2, 4.4, 4.6, 4.8, 5.0, 5.5, 6.0,
     1     6.5, 7.0, 7.5, 8.0, 8.5, 9.0, 9.5, 10.0 / 
      Data e0 / 0.4473, 5.037, 0.4534, 0.48598, 0.49866, 0.52283, 0.55949, 0.56916, 0.58802, 0.61636, 0.62554, 
     1     0.66281, 0.68087, 0.69882, 0.70822, 0.71779, 0.73574, 0.75436, 0.7996, 0.84394, 0.88655, 0.9027, 0.92652,
     1     0.96447, 1.0003, 1.034, 1.0666, 1.0981, 1.1268, 1.1785, 1.223, 1.2596, 1.2692, 1.2883, 1.3095, 1.3235,
     1     1.3306, 1.3327, 1.3307, 1.3255, 1.3091, 1.2881, 1.2766, 1.2651, 1.2429, 1.2324, 1.2217, 1.2007, 1.179, 
     1     1.1674, 1.1558, 1.1305, 1.1046, 1.0782, 1.0515, 1.0376, 1.0234, 0.99719, 0.96991, 0.9048, 0.84165, 0.78181, 
     1     0.76262, 0.72513, 0.66903, 0.61346, 0.55853, 0.50296, 0.44701, 0.3932, 0.28484, 0.1734, 0.06152, -0.04575, 
     1    -0.14954, -0.2486, -0.34145, -0.42975, -0.51276, -0.58669, -0.72143, -0.8481, -0.90966, -0.96863, -1.0817, 
     1    -1.1898, -1.2914, -1.386, -1.4332, -1.4762, -1.5617, -1.6388, -1.7116, -1.7798, -1.8469, -1.9063, -1.966, 
     1    -2.1051, -2.2421, -2.3686, -2.4827, -2.5865, -2.6861, -2.782, -2.8792, -2.9769, -3.0702  / 
      Data e1 / 0.4856, 5.078, 0.4916, 0.52359, 0.53647, 0.5613, 0.59923, 0.6092, 0.62875, 0.65818, 0.66772, 
     1     0.70604, 0.72443, 0.74277, 0.75232, 0.76202, 0.78015, 0.79905, 0.8445, 0.88884, 0.93116, 0.94711, 
     1     0.97057, 1.0077, 1.0426, 1.0755, 1.1076, 1.1385, 1.1669, 1.2179, 1.2621, 1.2986, 1.3082, 1.327, 1.3481, 
     1     1.3615, 1.3679, 1.3689, 1.3656, 1.359, 1.3394, 1.315, 1.3017, 1.2886, 1.2635, 1.2517, 1.2401, 1.2177, 
     1     1.1955, 1.1836, 1.172, 1.1468, 1.1214, 1.0955, 1.0697, 1.0562, 1.0426, 1.0172, 0.99106, 0.9283, 0.86715, 
     1     0.80876, 0.78994, 0.75302, 0.69737, 0.64196, 0.58698, 0.53136, 0.47541, 0.4218, 0.31374, 0.20259, 0.09106, 
     1    -0.0157, -0.11866, -0.21672, -0.3084, -0.39558, -0.47731, -0.55003, -0.6822, -0.8069, -0.86765, -0.92577, 
     1    -1.0367, -1.142, -1.2406, -1.3322, -1.3778, -1.4193, -1.5014, -1.5748, -1.6439, -1.7089, -1.7731, -1.8303, 
     1    -1.8882, -2.0232, -2.1563, -2.2785, -2.3881, -2.4874, -2.5829, -2.6752, -2.7687, -2.8634, -2.9537  / 
      Data e2 / 0.2459, 4.849, 0.2519, 0.29707, 0.31347, 0.34426, 0.39146, 0.40391, 0.42788, 0.46252, 0.47338, 0.51532,
     1     0.53445, 0.55282, 0.56222, 0.57166, 0.58888, 0.60652, 0.6477, 0.68562, 0.71941, 0.73171, 0.7494, 0.77678, 
     1     0.80161, 0.82423, 0.84591, 0.86703, 0.8871, 0.92702, 0.96616, 1.0031, 1.0135, 1.036, 1.0648, 1.0876, 1.104, 
     1     1.1149, 1.1208, 1.122, 1.1133, 1.0945, 1.0828, 1.071, 1.0476, 1.0363, 1.0246, 1.0011, 0.97677, 0.9638, 0.9512,
     1     0.9244, 0.89765, 0.87067, 0.84355, 0.82941, 0.81509, 0.7886, 0.7615, 0.6984, 0.63875, 0.58231, 0.56422, 0.52878,
     1     0.47523, 0.42173, 0.36813, 0.31376, 0.25919, 0.207, 0.10182, -0.006195, -0.11345, -0.2155, -0.3138, -0.40682, 
     1    -0.49295, -0.57388, -0.64899, -0.71466, -0.83003, -0.9326, -0.98228, -1.0313, -1.1301, -1.23, -1.3255, -1.415, 
     1    -1.4599, -1.5014, -1.5865, -1.6673, -1.7451, -1.8192, -1.8923, -1.9573, -2.0245, -2.1908, -2.3659, -2.5322, 
     1    -2.6818, -2.8176, -2.9438, -3.0597, -3.1713, -3.2785, -3.3776  / 
      Data  e3 / 0.4539, 5.033, 0.4599, 0.48875, 0.49973, 0.51999, 0.54995, 0.55783, 0.5733, 0.59704, 0.60496, 0.63828,
     1     0.65505, 0.67225, 0.68139, 0.69076, 0.70854, 0.72726, 0.7737, 0.82067, 0.86724, 0.88526, 0.91227, 0.9563, 
     1     0.99818, 1.0379, 1.0762, 1.1127, 1.1454, 1.203, 1.2502, 1.2869, 1.2961, 1.3137, 1.3324, 1.3437, 1.3487, 1.3492, 
     1     1.3463, 1.3414, 1.3281, 1.3132, 1.3052, 1.2972, 1.2815, 1.2736, 1.2653, 1.2479, 1.2286, 1.2177, 1.2066, 1.1816, 
     1     1.1552, 1.1276, 1.0995, 1.0847, 1.0696, 1.0415, 1.012, 0.9417, 0.87351, 0.80948, 0.78916, 0.74985, 0.69173, 
     1     0.63519, 0.57969, 0.52361, 0.46706, 0.4124, 0.30209, 0.18866, 0.07433, -0.03607, -0.1437, -0.24708, -0.34465, 
     1    -0.43818, -0.52682, -0.60658, -0.75402, -0.8941, -0.96187, -1.0266, -1.1495, -1.2664, -1.376, -1.4786, -1.5297,
     1    -1.5764, -1.6685, -1.7516, -1.829, -1.9011, -1.9712, -2.0326, -2.0928, -2.2288, -2.3579, -2.477, -2.5854, -2.6854,
     1    -2.7823, -2.8776, -2.9759, -3.076, -3.1726  / 
      Data  e4 / 1.431, 1.073, 1.421, 1.4331, 1.4336, 1.4328, 1.4279, 1.4261, 1.4227, 1.4174, 1.4158, 1.409, 1.4059, 
     1     1.4033, 1.4021, 1.4009, 1.3991, 1.3974, 1.3947, 1.3954, 1.4004, 1.4032, 1.4082, 1.4174, 1.4261, 1.4322, 1.435, 
     1     1.4339, 1.4293, 1.411, 1.3831, 1.3497, 1.3395, 1.3162, 1.2844, 1.2541, 1.2244, 1.1941, 1.1635, 1.1349, 1.0823, 
     1     1.0366, 1.0166, 0.99932, 0.97282, 0.96348, 0.95676, 0.95004, 0.94956, 0.95077, 0.95278, 0.95899, 0.96766, 0.97862, 
     1     0.99144, 0.99876, 1.0064, 1.0215, 1.0384, 1.0833, 1.1336, 1.1861, 1.2035, 1.2375, 1.2871, 1.3341, 1.378, 1.4208, 
     1     1.4623, 1.5004, 1.569, 1.6282, 1.6794, 1.7239, 1.7622, 1.7955, 1.8259, 1.8564, 1.8868, 1.9152, 1.9681, 2.017, 2.0406, 
     1     2.0628, 2.1014, 2.1323, 2.1545, 2.1704, 2.1775, 2.1834, 2.1938, 2.204, 2.2123, 2.2181, 2.223, 2.2268, 2.2299, 2.2389, 
     1     2.2377, 2.215, 2.172, 2.1187, 2.0613, 2.0084, 1.9605, 1.9189, 1.8837  / 
      Data  e5 / 0.05053, -0.1536, 0.04932, 0.053388, 0.054888, 0.057529, 0.060732, 0.061444, 0.062806, 0.064559, 0.065028,
     1     0.066183, 0.066438, 0.066663, 0.066774, 0.066891, 0.067127, 0.067357, 0.067797, 0.068591, 0.070127, 0.070895, 
     1     0.072075, 0.073549, 0.073735, 0.07194, 0.068097, 0.062327, 0.055231, 0.037389, 0.016373, -0.005158, -0.011354,
     1    -0.024711, -0.042065, -0.057593, -0.071861, -0.08564, -0.098884, -0.11096, -0.133, -0.15299, -0.16213, -0.17041, 
     1    -0.18463, -0.19057, -0.1959, -0.20454, -0.21134, -0.21446, -0.21716, -0.22214, -0.22608, -0.22924, -0.23166, 
     1    -0.23263, -0.2335, -0.23464, -0.23522, -0.23449, -0.23128, -0.22666, -0.22497, -0.22143, -0.21591, -0.21047, 
     1    -0.20528, -0.20011, -0.1949, -0.18983, -0.18001, -0.1709, -0.16233, -0.15413, -0.1467, -0.13997, -0.13361, 
     1    -0.12686, -0.11959, -0.11237, -0.098017, -0.083765, -0.076308, -0.068925, -0.055229, -0.04332, -0.03444, 
     1    -0.027889, -0.024997, -0.022575, -0.018362, -0.014642, -0.012248, -0.011459, -0.01176, -0.012879, -0.014855, 
     1    -0.019502, -0.026383, -0.039505, -0.05914, -0.081606, -0.10382, -0.12114, -0.13407, -0.14364, -0.15096  / 
      Data  e6 / -0.1662, 0.2252, -0.1659, -0.16561, -0.1652, -0.16499, -0.16632, -0.1669, -0.16813, -0.17015, -0.17083,
     1    -0.17357, -0.17485, -0.17619, -0.17693, -0.17769, -0.1792, -0.18082, -0.1848, -0.18858, -0.19176, -0.19291, 
     1    -0.19451, -0.19665, -0.19816, -0.19902, -0.19929, -0.199, -0.19838, -0.19601, -0.19265, -0.18898, -0.18792,
     1    -0.18566, -0.18234, -0.17853, -0.17421, -0.16939, -0.16404, -0.15852, -0.14704, -0.13445, -0.12784, -0.12115,
     1    -0.10714, -0.10011, -0.092855, -0.078923, -0.065134, -0.057921, -0.05104, -0.036755, -0.023189, -0.010417, 
     1     0.0011678, 0.0065887, 0.011871, 0.020767, 0.029119, 0.046932, 0.062667, 0.077997, 0.083058, 0.093185, 0.10829, 
     1     0.12256, 0.13608, 0.14983, 0.16432, 0.17895, 0.21042, 0.2441, 0.27799, 0.30956, 0.33896, 0.36616, 0.39065, 
     1     0.41244, 0.43151, 0.44788, 0.48024, 0.51873, 0.53883, 0.5581, 0.59394, 0.62694, 0.65811, 0.68755, 0.70216, 
     1     0.71523, 0.74028, 0.76303, 0.78552, 0.80792, 0.83126, 0.8524, 0.87314, 0.91466, 0.9487, 0.97643, 0.99757, 
     1     1.0121, 1.0232, 1.0335, 1.0453, 1.0567, 1.0651  / 
      Data  Mh / 5.5, 6.2, 5.5, 5.5, 5.5, 5.5, 5.5, 5.5, 5.5, 5.5, 5.5, 5.5, 5.5, 5.5, 5.5, 5.5, 5.5, 5.5, 
     1     5.5, 5.5, 5.5, 5.5, 5.5, 5.5, 5.5, 5.51, 5.52, 5.53, 5.54, 5.57, 5.62, 5.66, 5.67, 5.7, 5.74, 5.78, 
     1     5.82, 5.85, 5.89, 5.92, 5.97, 6.03, 6.05, 6.07, 6.11, 6.12, 6.14, 6.16, 6.18, 6.18, 6.19, 6.19, 6.2, 
     1     6.2, 6.2, 6.2, 6.2, 6.2, 6.2, 6.2, 6.2, 6.2, 6.2, 6.2, 6.2, 6.2, 6.2, 6.2, 6.2, 6.2, 6.2, 6.2, 6.2, 
     1     6.2, 6.2, 6.2, 6.2, 6.2, 6.2, 6.2, 6.2, 6.2, 6.2, 6.2, 6.2, 6.2, 6.2, 6.2, 6.2, 6.2, 6.2, 6.2, 6.2, 
     1     6.2, 6.2, 6.2, 6.2, 6.2, 6.2, 6.2, 6.2, 6.2, 6.2, 6.2, 6.2, 6.2, 6.2  / 
      Data  c1 / -1.134, -1.243, -1.134, -1.1394, -1.1405, -1.1419, -1.1423, -1.1421, -1.1412, -1.1388, 
     1     -1.1378, -1.1324, -1.1292, -1.1259, -1.1242, -1.1224, -1.1192, -1.1159, -1.1082, -1.1009, 
     1     -1.0942, -1.0918, -1.0884, -1.0831, -1.0785, -1.0745, -1.0709, -1.0678, -1.0652, -1.0607, 
     1     -1.0572, -1.0549, -1.0545, -1.0537, -1.0532, -1.0533, -1.0541, -1.0556, -1.0579, -1.0607, 
     1     -1.067, -1.0737, -1.0773, -1.0808, -1.0879, -1.0913, -1.0948, -1.1013, -1.1074, -1.1105, 
     1     -1.1133, -1.119, -1.1243, -1.1291, -1.1337, -1.1359, -1.1381, -1.142, -1.1459, -1.1543, 
     1     -1.1615, -1.1676, -1.1694, -1.1728, -1.1777, -1.1819, -1.1854, -1.1884, -1.1909, -1.193, 
     1     -1.1966, -1.1996, -1.2018, -1.2039, -1.2063, -1.2086, -1.2106, -1.2123, -1.2141, -1.2159, 
     1     -1.219, -1.2202, -1.2201, -1.2198, -1.2189, -1.2179, -1.2169, -1.216, -1.2156, -1.2156, 
     1     -1.2158, -1.2162, -1.2165, -1.2169, -1.2175, -1.2182, -1.2189, -1.2204, -1.2232, -1.2299, 
     1     -1.2408, -1.2543, -1.2688, -1.2839, -1.2989, -1.313, -1.3253  / 
      Data  c2 / 0.1917, 0.1489, 0.1916, 0.18962, 0.18924, 0.18875, 0.18844, 0.18842, 0.1884, 0.18839,
     1     0.18837, 0.18816, 0.18797, 0.18775, 0.18764, 0.18752, 0.1873, 0.18709, 0.18655, 0.18582, 
     1     0.18485, 0.18442, 0.18369, 0.18225, 0.18052, 0.17856, 0.17643, 0.1742, 0.17203, 0.1677, 
     1     0.16352, 0.15982, 0.15882, 0.15672, 0.15401, 0.15158, 0.14948, 0.14768, 0.14616, 0.14489, 
     1     0.14263, 0.14035, 0.13925, 0.13818, 0.13604, 0.13499, 0.13388, 0.13179, 0.12984, 0.1289, 
     1     0.12806, 0.12647, 0.12512, 0.12389, 0.12278, 0.12227, 0.12177, 0.12093, 0.12015, 0.11847,
     1     0.11671, 0.11465, 0.11394, 0.11253, 0.11054, 0.10873, 0.10709, 0.10548, 0.10389, 0.10248, 
     1     0.10016, 0.098482, 0.097375, 0.096743, 0.096445, 0.096338, 0.096254, 0.096207, 0.096255,
     1     0.096361, 0.096497, 0.096198, 0.096106, 0.096136, 0.096667, 0.097638, 0.098649, 0.099553, 
     1     0.099989, 0.10043, 0.10142, 0.10218, 0.10269, 0.10304, 0.10324, 0.10337, 0.10353, 0.1046, 
     1     0.1075, 0.11231, 0.11853, 0.12507, 0.13146, 0.13742, 0.14294, 0.14781, 0.15183 / 
      Data  c3 / -0.008088, -0.00344, -0.008088, -0.008074, -0.008095, -0.008153, -0.00829, -0.008336, 
     1    -0.008445, -0.008642, -0.008715, -0.00903, -0.009195, -0.00936, -0.009441, -0.009521, -0.009676, 
     1    -0.009819, -0.01012, -0.01033, -0.01048, -0.01052, -0.01056, -0.01058, -0.01056, -0.01051, -0.01042, 
     1    -0.01032, -0.0102, -0.009964, -0.009722, -0.009476, -0.009402, -0.009228, -0.008977, -0.008725, 
     1    -0.008472, -0.008219, -0.007967, -0.007717, -0.007224, -0.006747, -0.006517, -0.006293, 
     1    -0.005866, -0.005666, -0.005475, -0.005122, -0.004808, -0.004663, -0.004527, -0.004276, 
     1    -0.004053, -0.003853, -0.003673, -0.00359, -0.00351, -0.00336, -0.00322, -0.002897, 
     1    -0.00261, -0.002356, -0.002276, -0.002131, -0.001931, -0.001754, -0.001597, -0.001456, 
     1    -0.001328, -0.00121, -0.000994, -0.000803, -0.000635, -0.00049, -0.000365, -0.000259, 
     1    -0.000171, -0.000099, -0.000042, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -0.000023, -0.00004,
     1    -0.000045, -0.000049, -0.000053, -0.000052, -0.000047, -0.000039, -0.000027, -0.000014,
     1     0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0  / 
      Data  h / 4.5, 5.3, 4.5, 4.5, 4.5, 4.5, 4.5, 4.49, 4.45, 4.4, 4.38, 4.32, 4.29, 4.27, 
     1    4.25, 4.24, 4.22, 4.2, 4.15, 4.11, 4.08, 4.07, 4.06, 4.04, 4.02, 4.03, 4.07, 4.1,
     1    4.13, 4.19, 4.24, 4.29, 4.3, 4.34, 4.39, 4.44, 4.49, 4.53, 4.57, 4.61, 4.68, 4.75,
     1    4.78, 4.82, 4.88, 4.9, 4.93, 4.98, 5.03, 5.06, 5.08, 5.12, 5.16, 5.2, 5.24, 5.25, 
     1    5.27, 5.3, 5.34, 5.41, 5.48, 5.53, 5.54, 5.56, 5.6, 5.63, 5.66, 5.69, 5.72, 5.74, 
     1    5.82, 5.92, 6.01, 6.1, 6.18, 6.26, 6.33, 6.4, 6.48, 6.54, 6.66, 6.73, 6.77, 6.81, 
     1    6.87, 6.93, 6.99, 7.08, 7.12, 7.16, 7.24, 7.32, 7.39, 7.46, 7.52, 7.64, 7.78, 8.07,
     1    8.48, 8.9, 9.2, 9.48, 9.57, 9.62, 9.66, 9.66, 9.66  / 
      Data  Dc3Global / 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
     1     0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 
     1     0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 
     1     0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 
     1     0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 
     1     0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 
     1     0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0  / 
      Data  Dc3ChinaTrk / 0.002857567, 0.004345, 0.002815856, 0.002779513, 0.002759652, 0.002754174, 0.002761597, 0.00276458, 
     1     0.00276913, 0.00278369, 0.00280098, 0.00282191, 0.00284648, 0.00287378, 0.00290017, 0.00292292, 0.00294385, 
     1     0.00295659, 0.00296387, 0.00296751, 0.00296842, 0.00296751, 0.00296387, 0.00295659, 0.00294476, 0.0029302, 
     1     0.00291382, 0.00289653, 0.00287924, 0.00286286, 0.00284648, 0.00283101, 0.00281645, 0.00280189, 0.00278642, 
     1     0.00276458, 0.00273364, 0.00269906, 0.00265993, 0.0026117, 0.00255983, 0.00250523, 0.00244426, 0.00237965, 
     1     0.00231413, 0.00225043, 0.00219583, 0.00215488, 0.00212394, 0.00210392, 0.00209664, 0.00209755, 0.00210665, 
     1     0.00212667, 0.00216034, 0.0022022, 0.00224952, 0.00229775, 0.0023478, 0.00239876, 0.00245154, 0.00250796, 
     1     0.00256802, 0.00262899, 0.00268996, 0.00274638, 0.00279734, 0.00284284, 0.0028847, 0.0029211, 0.00295386, 
     1     0.00298207, 0.00300664, 0.00302575, 0.0030394, 0.00304122, 0.00302575, 0.00300027, 0.00296751, 0.00292292, 
     1     0.00287014, 0.00281463, 0.00276094, 0.00270816, 0.00265811, 0.00261625, 0.00258804, 0.0025753, 0.00257166, 
     1     0.00257348, 0.00258622, 0.00260533, 0.00261898, 0.00262353, 0.00262171, 0.00261534, 0.00260351, 0.00259077,
     1     0.00258349, 0.00258622, 0.0026026, 0.0026, 0.00263, 0.00267, 0.00276, 0.00289, 0.00303 /
      Data  Dc3ItalyJapan / -0.00255, -0.00033, -0.002436667, -0.00234, -0.002288571, -0.00225, -0.002214545,
     1    -0.00216762, -0.00211666, -0.00209573, -0.0020748, -0.00205387, -0.00203476, -0.00201565, -0.00200109, 
     1    -0.0019929, -0.00198835, -0.00199108, -0.00200109, -0.00201929, -0.00204477, -0.00207662, -0.00211484,
     1    -0.00215943, -0.00221221, -0.00226954, -0.00232687, -0.00238329, -0.0024388, -0.00249158, -0.00253981,
     1    -0.0025844, -0.00262626, -0.0026663, -0.00270634, -0.00275093, -0.00280189, -0.00285467, -0.00291109, 
     1    -0.00297024, -0.00302848, -0.0030849, -0.0031395, -0.00318955, -0.00323505, -0.00327418, -0.00329693,
     1    -0.0033033, -0.00329966, -0.00328692, -0.0032669, -0.00324233, -0.0032123, -0.00317681, -0.00313222, 
     1    -0.00307944, -0.0030212, -0.00296387, -0.00290654, -0.0028483, -0.00278915, -0.00272727, -0.00266175,
     1    -0.00259532, -0.00252707, -0.00245609, -0.00237874, -0.0022932, -0.00219583, -0.00208936, -0.00197743,
     1    -0.00186186, -0.00174538, -0.00162981, -0.00151788, -0.00141141, -0.00132314, -0.00125307, -0.0012012,
     1    -0.00117026, -0.00115661, -0.00115479, -0.00115934, -0.00116844, -0.00118027, -0.00118846, -0.0011921,
     1    -0.00118664, -0.0011739, -0.00115388, -0.00112294, -0.0010829, -0.00102466, -0.0009464, -0.00084448,
     1    -0.00071799, -0.00057148, -0.00040768, -0.00022841, -0.0000364, 0.00016835, 0.00038493, 0.00072, 0.00094, 
     1     0.00113, 0.00131, 0.00149  / 
      Data  c / -0.6, -0.84, -0.603721973, -0.573875667, -0.566752279, -0.555197163, -0.538497033, -0.534143553,
     1    -0.525291966, -0.511923959, -0.507518438, -0.490646419, -0.482903339, -0.475723249, -0.472356517, 
     1    -0.469145165, -0.463208107, -0.457951091, -0.447868462, -0.441861646, -0.43951233, -0.439503002, 
     1    -0.440402202, -0.444112949, -0.450201502, -0.458125772, -0.467318914, -0.477214082, -0.487244431,
     1    -0.506318022, -0.524378592, -0.542139779, -0.547516445, -0.560315222, -0.579618559, -0.600520122, 
     1    -0.622517009, -0.644863016, -0.666811933, -0.687617555, -0.72431141, -0.756461552, -0.771774699, 
     1    -0.786969142, -0.816133148, -0.829498623, -0.841650351, -0.86175209, -0.877260496, -0.883751522, 
     1    -0.889645401, -0.900376636, -0.910924032, -0.922413076, -0.93459188, -0.940753619, -0.94686421, 
     1    -0.958633835, -0.969304522, -0.989249151, -1.001214084, -1.007814444, -1.009301181, -1.01166535, 
     1    -1.015381923, -1.020991723, -1.028172052, -1.036012654, -1.043603269, -1.050033639, -1.057333673, 
     1    -1.058435992, -1.055424896, -1.050384681, -1.045399647, -1.042113359, -1.040406454, -1.03971884, 
     1    -1.039490421, -1.039161103, -1.036792003, -1.032293817, -1.029407219, -1.026181432, -1.018969732, 
     1    -1.011173605, -1.003211399, -0.995115318, -0.99099697, -0.986821029, -0.9782642, -0.969380498, -0.960119456, 
     1    -0.950486073, -0.940499213, -0.93017774, -0.919540518, -0.891762036, -0.862855832, -0.833549707, -0.804571467,
     1    -0.776648914, -0.750329102, -0.725436082, -0.701613157, -0.678503629, -0.655750799  / 
      Data  Vc / 1500, 1300, 1500.201617, 1500.361025, 1500.677261, 1501.037995, 1501.258061, 1502.954014, 1503.117309, 
     1     1503.238882, 1503.315564, 1503.348394, 1503.335313, 1503.125148, 1502.84162, 1502.474189, 1502.006843, 
     1     1501.42407, 1500.709379, 1499.82835, 1498.744966, 1497.421638, 1495.849038, 1493.996829, 1491.824848, 
     1     1489.292214, 1486.358303, 1482.982534, 1479.123815, 1474.74145, 1469.754986, 1464.088325, 1457.758978,
     1     1450.711732, 1442.854605, 1434.221674, 1424.854574, 1414.76993, 1403.993193, 1392.611037, 1380.715909,
     1     1368.509262, 1356.213377, 1343.894304, 1331.672205, 1319.833647, 1308.468996, 1297.649994, 1287.501604, 
     1     1278.056394, 1269.187123, 1260.738035, 1252.656788, 1244.799597, 1237.031362, 1229.225574, 1221.164101, 
     1     1212.743387, 1203.907562, 1194.594168, 1184.92666, 1175.185012, 1165.686403, 1156.455103, 1147.587208, 
     1     1139.208933, 1131.337078, 1123.914989, 1116.831532, 1109.947082, 1103.070401, 1096.038941, 1088.666571,
     1     1080.77314, 1072.388357, 1061.772378, 1049.291238, 1036.418535, 1023.143794, 1009.49373, 995.5184397, 
     1     981.3309345, 966.9378275, 952.3379474, 937.5231841, 922.4304827, 908.7902245, 896.1527649, 883.1598664,
     1     870.0472783, 857.0733474, 844.4757455, 832.454304, 821.1814444, 810.7946349, 801.4123822, 793.1312281, 
     1     785.7331967, 779.9122405, 775.6002501, 772.6812408, 771.0093237, 760.810005, 764.5003506, 768.0682561, 
     1     771.5545347, 775.0  / 
      Data  f4 / -0.15, -0.1, -0.148333333, -0.1471, -0.147742857, -0.149588889, -0.152490909, -0.1548547, 
     1     -0.1574391, -0.1606605, -0.164073, -0.1677676, -0.1715259, -0.1760031, -0.1809899, -0.186186, 
     1     -0.191464, -0.1963325, -0.2014012, -0.2065973, -0.2120391, -0.2176447, -0.2232048, -0.2286648,
     1     -0.233688, -0.2382016, -0.2421328, -0.2458274, -0.249158, -0.251888, -0.2540356, -0.2556008, 
     1     -0.2566291, -0.2571296, -0.2571296, -0.2562014, -0.254436, -0.2522247, -0.2496949, -0.2465827,
     1     -0.2432066, -0.2396485, -0.2357446, -0.2315495, -0.2273544, -0.2231866, -0.2191189, -0.2151968, 
     1     -0.2111655, -0.2070341, -0.2032667, -0.1995903, -0.1958229, -0.1922284, -0.1883609, -0.1840384,
     1     -0.1793337, -0.1748565, -0.1704066, -0.1657929, -0.1610063, -0.1558375, -0.1502956, -0.1445717, 
     1     -0.1386567, -0.1325233, -0.1261897, -0.119665, -0.1125943, -0.1052142, -0.0977431, -0.0902265, 
     1     -0.0827281, -0.0752843, -0.0679406, -0.060424, -0.0533897, -0.047047, -0.0413504, -0.0361361, 
     1     -0.031395, -0.0270725, -0.023114, -0.0195923, -0.0164619, -0.0135772, -0.0112294, -0.0092729, 
     1     -0.007462, -0.0057876, -0.0043862, -0.0032123, -0.0022932, -0.0016107, -0.0010374, -0.0005551,
     1     -0.0002548, -0.0001001, -0.0000455, -0.0000364, -0.0000455, -0.0000546, 0.0001, 0.0001, 0.0001, 
     1      0.0001, 0.0  / 
      Data  f5 / -0.00701, -0.00844, -0.00701, -0.00728, -0.00732, -0.00736, -0.00737, -0.00735, -0.00731, 
     1     -0.00721, -0.00717, -0.00698, -0.00687, -0.00677, -0.00672, -0.00667, -0.00656, -0.00647, -0.00625, 
     1     -0.00607, -0.00593, -0.00588, -0.00582, -0.00573, -0.00567, -0.00563, -0.00561, -0.0056, -0.0056, 
     1     -0.00562, -0.00567, -0.00572, -0.00574, -0.00578, -0.00585, -0.00591, -0.00597, -0.00602, -0.00608,
     1     -0.00614, -0.00626, -0.00638, -0.00644, -0.0065, -0.0066, -0.00665, -0.0067, -0.0068, -0.00689, 
     1     -0.00693, -0.00697, -0.00705, -0.00713, -0.00719, -0.00726, -0.00729, -0.00732, -0.00738, -0.00744,
     1     -0.00758, -0.00773, -0.00787, -0.00792, -0.008, -0.00812, -0.00822, -0.0083, -0.00836, -0.00841,
     1     -0.00844, -0.00847, -0.00842, -0.00829, -0.00806, -0.00771, -0.00723, -0.00666, -0.00603, -0.0054,
     1     -0.00479, -0.00378, -0.00302, -0.00272, -0.00246, -0.00208, -0.00183, -0.00167, -0.00158, -0.00155, 
     1     -0.00154, -0.00152, -0.00152, -0.00152, -0.0015, -0.00148, -0.00146, -0.00144, -0.0014, -0.00138, 
     1     -0.00137, -0.00137, -0.00137, -0.00137, -0.00137, -0.00137, -0.00136, -0.00136  / 
      Data  f6 / -9.9, -9.9, -9.9, -9.9, -9.9, -9.9, -9.9, -9.9, -9.9, -9.9, -9.9, -9.9, -9.9, -9.9, 
     1      -9.9, -9.9, -9.9, -9.9, -9.9, -9.9, -9.9, -9.9, -9.9, -9.9, -9.9, -9.9, -9.9, -9.9, -9.9, 
     1      -9.9, -9.9, -9.9, -9.9, -9.9, -9.9, -9.9, -9.9, -9.9, -9.9, -9.9, -9.9, -9.9, -9.9, -9.9, 
     1      -9.9, -9.9, -9.9, -9.9, -9.9, -9.9, -9.9, -9.9, -9.9, -9.9, -9.9, -9.9, -9.9, -9.9, -9.9, 
     1      -9.9, -9.9, 0.005828594, 0.026445503, 0.055495036, 0.092259036, 0.140404486, 0.194954971, 
     1       0.25203482, 0.309399196, 0.366954397, 0.424517299, 0.481161353, 0.535968267, 0.588318983, 
     1       0.637893676, 0.688890073, 0.735781413, 0.779920766, 0.824265713, 0.871376753, 0.920327295, 
     1       0.969309177, 1.016723853, 1.060103429, 1.09899486, 1.134793579, 1.163774071, 1.188166647, 
     1       1.211437922, 1.233642439, 1.253424259, 1.27110697, 1.286957162, 1.300439228, 1.312470713, 
     1       1.322538099, 1.328863194, 1.344999719, 1.349625795, 1.348905674, 1.342176853, 1.32877683, 
     1       1.308397977, 1.28215216, 1.251506122, 1.217926602, 1.182880341  / 
      Data  f7  / -9.9, -9.9, -9.9, -9.9, -9.9, -9.9, -9.9, -9.9, -9.9, -9.9, -9.9, -9.9, -9.9, 
     1      -9.9, -9.9, -9.9, -9.9, -9.9, -9.9, -9.9, -9.9, -9.9, -9.9, -9.9, -9.9, -9.9, -9.9, 
     1      -9.9, -9.9, -9.9, -9.9, -9.9, -9.9, -9.9, -9.9, -9.9, -9.9, -9.9, -9.9, -9.9, -9.9, 
     1      -9.9, -9.9, -9.9, -9.9, -9.9, -9.9, -9.9, -9.9, -9.9, -9.9, -9.9, -9.9, -9.9, -9.9, 
     1      -9.9, -9.9, -9.9, -9.9, -9.9, -9.9, 0.00376198, 0.017099524, 0.035727688, 0.059023688,
     1       0.088480942, 0.120292256, 0.151586304, 0.180774958, 0.207894202, 0.233095306, 0.256059658,
     1       0.276475905, 0.294236955, 0.309439975, 0.324490532, 0.337199059, 0.349628672, 0.364131615,
     1       0.382450146, 0.404017146, 0.427420811, 0.451423337, 0.47422331, 0.495355417, 0.515851214,
     1       0.534106657, 0.551448338, 0.569813289, 0.589323461, 0.60918484, 0.62938684, 0.65157128, 
     1       0.674207041, 0.696976687, 0.718876747, 0.73805695, 0.777903392, 0.802777241, 0.814799392,
     1       0.816147696, 0.809, 0.795381782, 0.776709043, 0.754245413, 0.729254522, 0.703  / 
      Data  R1 / 110, 105, 111.6666667, 113.1049769, 113.365134, 113.0730437, 112.3626778, 112.1334015,
     1       111.649752, 110.6393557, 109.5292026, 108.2841996, 106.991052, 105.4058905, 103.6093099, 
     1       101.702388, 99.75578729, 97.92699525, 96.02975863, 94.095103, 92.07864539, 90.0051328,
     1        87.96898961, 85.98934118, 84.23192283, 82.73832083, 81.5414182, 80.46255966, 79.58653623, 
     1        79.04686861, 78.85033023, 78.99499127, 79.47021873, 80.25667639, 81.32632483, 82.85748095,
     1        84.71789203, 86.67450587, 88.726045, 90.90707909, 93.03884764, 95.07698571, 97.03859501, 
     1        98.87495843, 100.5322872, 102.0095808, 103.1519179, 103.9974686, 104.6999207, 105.2612709,
     1       105.6123877, 105.8666708, 106.0179016, 106.0284851, 105.9218534, 105.7931301, 105.6885583, 
     1       105.5855206, 105.5360087, 105.6057595, 105.8268681, 106.2043227, 106.7482103, 107.4783404,
     1       108.3883404, 109.6153201, 111.0800633, 112.7113815, 114.5005392, 116.3880882, 118.2980535, 
     1       120.1853199, 122.0128003, 123.7514352, 125.3801935, 126.8996072, 128.1360898, 129.1139085, 
     1       129.8589263, 130.3687486, 130.6712208, 130.8051591, 130.8085281, 130.721677, 130.5673434, 
     1       130.3648553, 130.12523, 129.9030418, 129.7128463, 129.5637958, 129.4894929, 129.4894929, 
     1       129.5715517, 129.7087991, 129.8714112, 130.0466063, 130.2244428, 130.3891852, 130.5283358,
     1       130.6326348, 130.6960606, 130.7158297, 130.873965, 130.7100966, 130.4994086, 130.2575075, 130.0  / 
      Data  R2 / 270, 272, 270, 270, 269.9997543, 269.9992309, 269.9983922, 269.9981809, 269.9977811, 
     1       269.9972914, 269.9971716, 269.9970038, 269.9971562, 269.9975038, 269.9977596, 269.9980747, 
     1       269.9988974, 270, 270.0040574, 270.0098275, 270.0170967, 270.0203763, 270.0256516, 270.0352787, 
     1       270.0457645, 270.0568956, 270.0684584, 270.0802395, 270.0920255, 270.1147579, 270.1349479, 
     1       270.1508876, 270.1545854, 270.1608691, 270.1631848, 270.1561266, 270.1379869, 270.1070578, 
     1       270.0616314, 270, 269.8250997, 269.5877388, 269.4485078, 269.2971082, 268.9623989, 268.7813869,
     1       268.5928018, 268.1975077, 267.7857076, 267.57649, 267.3665924, 266.9493531, 266.5431804, 266.1572654, 
     1       265.800799, 265.6364811, 265.482972, 265.2129753, 265, 264.7422542, 264.8313969, 265.2004904, 
     1       265.3778612, 265.782597, 266.510779, 267.3180986, 268.1376183, 268.9024002, 269.5455067, 270.0, 
     1       270.1791373, 269.4230155, 267.8185789, 265.4527717, 262.4125382, 258.7848227, 254.6565695, 
     1       250.1147229, 245.2462272, 240.1380267, 229.5502883, 219.0470621, 214.0445018, 209.3239025, 
     1       201.0763636, 195, 191.6136929, 190.7296319, 191.1120427, 191.9833337, 195.0103148, 199.446092, 
     1       204.9261818, 211.0861009, 217.5613658, 223.9874933, 230, 241.8599813, 249.3431264, 252.9357504,
     1       253.1241685, 250.3946958, 245.2336475, 238.1273386, 229.5620843, 220.0241997, 210.0  / 
      Data  Dfr / 0.1, 0.082, 0.096, 0.091556303, 0.088356963, 0.085930921, 0.083774947, 0.081223653, 0.078450218, 
     1       0.076699698, 0.075050821, 0.073489313, 0.072059045, 0.07036674, 0.068529339, 0.06670742, 0.064913586, 
     1       0.063379806, 0.062101875, 0.061276478, 0.060989702, 0.06133913, 0.062433193, 0.064253193, 0.067384107,
     1       0.071538679, 0.076452754, 0.081554497, 0.086987015, 0.092720015, 0.098560479, 0.104347708, 0.109955172,
     1       0.115290504, 0.120295504, 0.124574223, 0.12813777, 0.131112496, 0.133926359, 0.136382309, 0.138372212, 
     1       0.139861579, 0.140667227, 0.140708243, 0.14020071, 0.139212607, 0.137527587, 0.135418947, 0.133021345, 
     1       0.130412765, 0.127758217, 0.125076732, 0.122353451, 0.11979987, 0.117403432, 0.115021796, 0.112681769, 
     1       0.110724177, 0.10905305, 0.107537651, 0.106110511, 0.104652438, 0.103172943, 0.101745588, 0.100380588,
     1       0.099271998, 0.098511921, 0.098154151, 0.098108335, 0.098414462, 0.099072372, 0.100016376, 0.101173456, 
     1       0.102461958, 0.103791594, 0.104918523, 0.105585288, 0.105844726, 0.105606577, 0.104550166, 0.102730166, 
     1       0.100295607, 0.09739545, 0.094271022, 0.0909955, 0.087543726, 0.084141798, 0.08096985, 0.077858707, 
     1       0.074831719, 0.072192082, 0.069917082, 0.067800173, 0.065899225, 0.064137445, 0.062563893, 0.061283667, 
     1       0.060261764, 0.05948127, 0.058928134, 0.058585237, 0.058432387, 0.058770303, 0.059293737, 0.05963202, 
     1       0.059846869, 0.06  / 
      Data  Dfv / 0.07, 0.08, 0.07, 0.03, 0.027159957, 0.026237399, 0.028339447, 0.029, 0.030097364, 0.031181748, 
     1       0.031409017, 0.031751013, 0.031636307, 0.031372686, 0.031194772, 0.030991317, 0.030523366, 0.03, 
     1       0.028577736, 0.027035261, 0.025403918, 0.024733518, 0.02371505, 0.022, 0.020290275, 0.01861804, 
     1       0.017015622, 0.015515351, 0.014149555, 0.011950702, 0.010677692, 0.010589153, 0.010832228, 0.011943713,
     1       0.015, 0.019857769, 0.025981273, 0.032675893, 0.039247009, 0.045, 0.052435395, 0.055236451, 0.055341803,
     1       0.05481981, 0.052602113, 0.051260568, 0.05, 0.048175615, 0.047273115, 0.04713309, 0.047182157, 0.047792402, 
     1       0.048993507, 0.050675131, 0.052726934, 0.05385717, 0.055038574, 0.057499709, 0.06, 0.065861445, 0.070535071,
     1       0.073277974, 0.073638741, 0.073347252, 0.07, 0.062845201, 0.052899385, 0.041530968, 0.030108368, 0.02, 
     1       0.006941622, 0.002013136, 0.00261384, 0.006143029, 0.01, 0.012102633, 0.012443147, 0.011532345, 
     1       0.009881028, 0.008, 0.004880563, 0.002703168, 0.00191076, 0.001285492, 0.00044521, 0.0, 0.0, 0.0,
     1       0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0  / 
      Data  l1 / 0.695051846, 0.643957111, 0.698006309, 0.701782868, 0.706548506, 0.711195123, 0.715957974, 
     1      0.721228156, 0.725942427, 0.730195711, 0.734334083, 0.738239534, 0.741598585, 0.744979853, 
     1      0.747973129, 0.750188754, 0.75209786, 0.753056971, 0.753304669, 0.75281229, 0.751695457, 0.749966473, 
     1      0.747587664, 0.74467779, 0.741109596, 0.737430282, 0.734030858, 0.730795089, 0.727910373, 0.725618992,
     1      0.723867585, 0.722567618, 0.721619586, 0.720913015, 0.720326459, 0.719605374, 0.718334246, 0.716582057,
     1      0.714396303, 0.711263893, 0.707527789, 0.703315207, 0.698360929, 0.69279583, 0.687088675, 0.681296181, 
     1      0.675439264, 0.669671543, 0.663799354, 0.657924575, 0.652668626, 0.647663884, 0.642782715, 0.638426045,
     1      0.634108934, 0.629382098, 0.62422, 0.619437355, 0.614715708, 0.60976365, 0.604598073, 0.599098137, 0.59331998,
     1      0.587439352, 0.581472705, 0.575542921, 0.56974676, 0.564165911, 0.558374926, 0.55272515, 0.547545691, 
     1      0.542855555, 0.538656813, 0.534944688, 0.531707555, 0.529040997, 0.527287131, 0.526285195, 0.525960554,
     1      0.526307836, 0.527166224, 0.52834572, 0.529680229, 0.531034833, 0.532338272, 0.533540823, 0.534501454, 
     1      0.535195447, 0.53572513, 0.536079697, 0.536152067, 0.535963593, 0.535334938, 0.534237376, 0.532692511, 
     1      0.530739791, 0.528478635, 0.526053601, 0.523587452, 0.519579085, 0.515163198, 0.511680885, 0.509575165,
     1      0.508690441, 0.508721463, 0.509362984, 0.510309754  / 
      Data  l2 / 0.495071232, 0.551764538, 0.499186122, 0.502296989, 0.504963222, 0.507711953, 0.510432167, 
     1      0.513604818, 0.515812524, 0.517910447, 0.519820383, 0.521402475, 0.523129981, 0.524965283, 0.526820259,
     1      0.528708567, 0.530428701, 0.532293889, 0.534221721, 0.536160253, 0.538032763, 0.539754341, 0.541286846, 
     1      0.54230586, 0.542737255, 0.542591025, 0.542250646, 0.541620905, 0.54068589, 0.539679771, 0.538779888, 
     1      0.538078566, 0.53758311, 0.537215808, 0.536753324, 0.536194907, 0.53588924, 0.535908118, 0.537036817,
     1      0.538800565, 0.541040388, 0.543935168, 0.547119553, 0.550316608, 0.553588111, 0.55729675, 0.561416998, 
     1      0.565632437, 0.569784669, 0.573041125, 0.575835249, 0.578362937, 0.580379619, 0.582628329, 0.585348815, 
     1      0.588511395, 0.591752878, 0.595223545, 0.598956616, 0.602828209, 0.606867381, 0.611000872, 0.615003616, 
     1      0.618790868, 0.621818942, 0.623941399, 0.625112169, 0.625681285, 0.625612877, 0.624981547, 0.623995573, 
     1      0.622818294, 0.621570841, 0.620332135, 0.619246543, 0.61833633, 0.617742703, 0.61756745, 0.617771454, 
     1      0.618226977, 0.618751361, 0.619191142, 0.619485437, 0.619577577, 0.619420571, 0.618953454, 0.618315241, 
     1      0.617611537, 0.616887033, 0.616226985, 0.615704939, 0.615594552, 0.616075661, 0.617144784, 0.618703484, 
     1      0.620552902, 0.622345733, 0.623772152, 0.624590185, 0.633513742, 0.635817329, 0.634364218, 0.629589543, 
     1      0.622323697, 0.613397069, 0.603640051, 0.603640051  / 
      Data  t1 / 0.398193694, 0.400827625, 0.401893456, 0.408676088, 0.418215995, 0.427177711, 0.436070182, 
     1      0.444905042, 0.453803323, 0.462101001, 0.470160072, 0.477710678, 0.484117494, 0.490450614, 0.495749173, 
     1      0.499225985, 0.5019699, 0.502723139, 0.501716932, 0.498998129, 0.494902796, 0.489481958, 0.482598999, 
     1      0.474402161, 0.464064092, 0.452397199, 0.440074986, 0.42776387, 0.41532093, 0.403152947, 0.391532446, 
     1      0.380671789, 0.370738923, 0.361857385, 0.354106294, 0.348697556, 0.345545196, 0.34407253, 0.343233924,
     1      0.34359108, 0.344988097, 0.347145162, 0.349972884, 0.353255966, 0.356679848, 0.360119486, 0.363355575, 
     1      0.366266916, 0.369220285, 0.372279947, 0.375096598, 0.377930593, 0.381004878, 0.384177876, 0.388083411,
     1      0.392859672, 0.398485375, 0.404140478, 0.410108475, 0.416659177, 0.423725413, 0.431438154, 0.439733967, 
     1      0.448335773, 0.457160435, 0.465979626, 0.474518531, 0.482567294, 0.490617708, 0.498251771, 0.50510595, 
     1      0.511173165, 0.516462552, 0.52099982, 0.524827245, 0.527976145, 0.530028087, 0.531310584, 0.532064486,
     1      0.532495149, 0.532827717, 0.533264138, 0.533936771, 0.534723951, 0.535652785, 0.536865297, 0.538270252, 
     1      0.539706125, 0.540974908, 0.541959278, 0.542571426, 0.542697784, 0.541836187, 0.540132614, 0.537902038,
     1      0.535225635, 0.531984637, 0.528251638, 0.524152448, 0.51703024, 0.514030219, 0.51099634, 0.50724853, 
     1      0.502792431, 0.497805116, 0.492463657, 0.486945126  / 
      Data  t2 / 0.347961282, 0.346, 0.344624643, 0.346399037, 0.349366743, 0.353738803, 0.359460225, 0.363952874,
     1      0.368811265, 0.373842596, 0.379107128, 0.384262017, 0.390425887, 0.397348031, 0.404643011, 0.412089601, 
     1      0.419038179, 0.426287022, 0.433617896, 0.441053708, 0.448398577, 0.455250767, 0.461467608, 0.465817909, 
     1      0.467937664, 0.467608429, 0.466420682, 0.46356957, 0.458269257, 0.450717697, 0.441157005, 0.42985318, 
     1      0.417096098, 0.403199519, 0.387932255, 0.372064984, 0.356693866, 0.340873973, 0.324302547, 0.308523554, 
     1      0.293692632, 0.279508434, 0.266403159, 0.254656614, 0.244164399, 0.235734829, 0.229011128, 0.223109817, 
     1      0.218034838, 0.214750474, 0.212270202, 0.210458348, 0.209660515, 0.209761075, 0.210814327, 0.21303599,
     1      0.215644591, 0.218995528, 0.22351873, 0.229084423, 0.235478509, 0.242538306, 0.250154969, 0.258169451,
     1      0.26638574, 0.27414039, 0.28100386, 0.287597367, 0.293500417, 0.298388408, 0.302490095, 0.306026433, 
     1      0.309176939, 0.312079691, 0.315069876, 0.317927959, 0.320621219, 0.323280328, 0.32612537, 0.329087419,
     1      0.332035841, 0.334860327, 0.337480621, 0.339873426, 0.342037657, 0.343756785, 0.345102581, 0.346340837,
     1      0.347484261, 0.348366463, 0.349020367, 0.349244347, 0.348718464, 0.34720797, 0.344536399, 0.340620313, 
     1      0.335449924, 0.329006892, 0.321283835, 0.312293834, 0.302070431, 0.269937816, 0.277859662, 0.26488399,
     1      0.252029114, 0.239234636, 0.239234636 / 

C     Set constant parameters
      mref = 4.5
      rref = 1.0
      vref = 760.0
      f1 = 0.0
      f3 = 0.1
      V1 = 225.0
      V2 = 300.0

C First check for the PGA case (i.e., specT=0.0) 
      nPer = 107
      if (specT .eq. 0.0) then
         period1 = period(1)
         e0T = e0(1)
         e1T = e1(1)
         e2T = e2(1)
         e3T = e3(1)
         e4T = e4(1)
         e5T = e5(1)
         e6T = e6(1)
         mhT = mh(1)
         c1T = c1(1)
         c2T = c2(1)
         c3T = c3(1)        
         hT = h(1)
         cT = c(1)
         VcT = vc(1)
         phi2T = phi2(1)
         phi3T = phi3(1)
         Dc3GlobalT = DC3global(1)
         Dc3ChinaTrkT = DC3ChinaTrk(1)
         Dc3ItalyJapanT = DC3ItalyJapan(1)
         f4T = f4(1)
         f5T = f5(1)
         f6T = f6(1)
         f7T = f7(1)
         R1T = R1(1)
         R2T = R2(1)
         l1T = l1(1)
         l2T = l2(1)
         t1T = t1(1)
         t2T = t2(1)
         rjbbarT = rjbbar(1)
         DfrT = Dfr(1)
         DfvT = Dfv(1)
         goto 1011
      elseif (specT .eq. -1.0) then
         period1 = period(2)
         e0T = e0(2)
         e1T = e1(2)
         e2T = e2(2)
         e3T = e3(2)
         e4T = e4(2)
         e5T = e5(2)
         e6T = e6(2)
         mhT = mh(2)
         c1T = c1(2)
         c2T = c2(2)
         c3T = c3(2)        
         hT = h(2)
         cT = c(2)
         VcT = vc(2)
         phi2T = phi2(2)
         phi3T = phi3(2)
         Dc3GlobalT = DC3global(2)
         Dc3ChinaTrkT = DC3ChinaTrk(2)
         Dc3ItalyJapanT = DC3ItalyJapan(2)
         f4T = f4(2)
         f5T = f5(2)
         f6T = f6(2)
         f7T = f7(2)
         R1T = R1(2)
         R2T = R2(2)
         l1T = l1(2)
         l2T = l2(2)
         t1T = t1(2)
         t2T = t2(2)
         rjbbarT = rjbbar(2)
         DfrT = Dfr(2)
         DfvT = Dfv(2)
         goto 1011
      elseif (specT .gt. 0.0) then
C Now loop over the spectral period range of the attenuation relationship.
         do i=3,nper-1
            if (specT .ge. period(i) .and. specT .le. period(i+1) ) then
               count1 = i
               count2 = i+1
               goto 1020 
            endif
         enddo
      endif

C Selected spectral period is outside range defined by attenuaton model.
      write (*,*) 
      write (*,*) 'BSSA (NGA West2-2013) Horizontal'
      write (*,*) 'attenuation model is not defined for a '
      write (*,*) ' spectral period of: ' 
      write (*,'(a10,f10.5)') ' Period = ',specT
      write (*,*) 'This spectral period is outside the defined'
      write (*,*) 'period range in the code or beyond the range'
      write (*,*) 'of spectral periods for interpolation.'
      write (*,*) 'Please check the input file.'
      write (*,*) 
      stop 99

C Interpolate the coefficients for the requested spectral period.
 1020       call interp (period(count1),period(count2),e0(count1),e0(count2),
     +                   specT,e0T,iflag)
            call interp (period(count1),period(count2),e1(count1),e1(count2),
     +                   specT,e1T,iflag)
            call interp (period(count1),period(count2),e2(count1),e2(count2),
     +                   specT,e2T,iflag)
            call interp (period(count1),period(count2),e3(count1),e3(count2),
     +                   specT,e3T,iflag)
            call interp (period(count1),period(count2),e4(count1),e4(count2),
     +                   specT,e4T,iflag)
            call interp (period(count1),period(count2),e5(count1),e5(count2),
     +                   specT,e5T,iflag)
            call interp (period(count1),period(count2),e6(count1),e6(count2),
     +                   specT,e6T,iflag)
            call interp (period(count1),period(count2),mh(count1),mh(count2),
     +                   specT,mhT,iflag)
            call interp (period(count1),period(count2),c1(count1),c1(count2),
     +                   specT,c1T,iflag)
            call interp (period(count1),period(count2),c2(count1),c2(count2),
     +                   specT,c2T,iflag)
            call interp (period(count1),period(count2),c3(count1),c3(count2),
     +                   specT,c3T,iflag)
            call interp (period(count1),period(count2),h(count1),h(count2),
     +                   specT,hT,iflag)
            call interp (period(count1),period(count2),c(count1),c(count2),
     +                   specT,cT,iflag)
            call interp (period(count1),period(count2),phi2(count1),phi2(count2),
     +                   specT,phi2T,iflag)
            call interp (period(count1),period(count2),phi3(count1),phi3(count2),
     +                   specT,phi3T,iflag)
            call interp (period(count1),period(count2),DC3Global(count1),DC3Global(count2),
     +                   specT,DC3GlobalT,iflag)
            call interp (period(count1),period(count2),DC3ChinaTrk(count1),DC3ChinaTrk(count2),
     +                   specT,DC3ChinaTrkT,iflag)
            call interp (period(count1),period(count2),DC3ItalyJapan(count1),DC3ItalyJapan(count2),
     +                   specT,DC3ItalyJapanT,iflag)
            call interp (period(count1),period(count2),Vc(count1),Vc(count2),
     +                   specT,VcT,iflag)
            call interp (period(count1),period(count2),f4(count1),f4(count2),
     +                   specT,f4T,iflag)
            call interp (period(count1),period(count2),f5(count1),f5(count2),
     +                   specT,f5T,iflag)
            call interp (period(count1),period(count2),f6(count1),f6(count2),
     +                   specT,f6T,iflag)
            call interp (period(count1),period(count2),f7(count1),f7(count2),
     +                   specT,f7T,iflag)
            call interp (period(count1),period(count2),R1(count1),R1(count2),
     +                   specT,R1T,iflag)
            call interp (period(count1),period(count2),R2(count1),R2(count2),
     +                   specT,R2T,iflag)
            call interp (period(count1),period(count2),l1(count1),l1(count2),
     +                   specT,l1T,iflag)
            call interp (period(count1),period(count2),l2(count1),l2(count2),
     +                   specT,l2T,iflag)
            call interp (period(count1),period(count2),t1(count1),t1(count2),
     +                   specT,t1T,iflag)
            call interp (period(count1),period(count2),t2(count1),t2(count2),
     +                   specT,t2T,iflag)
            call interp (period(count1),period(count2),rjbbar(count1),rjbbar(count2),
     +                   specT,rjbbarT,iflag)
            call interp (period(count1),period(count2),Dfr(count1),Dfr(count2),
     +                   specT,DfrT,iflag)
            call interp (period(count1),period(count2),Dfv(count1),Dfv(count2),
     +                   specT,DfvT,iflag)
 1011 period1 = specT                                                                                                              

C.....Set the mechanism terms based on ftype............
C     Set mechanism term and corresponding Frv and Fnm values.
C     fType     Mechanism                      Rake
C     ------------------------------------------------------
C      -1       Normal                    -120 < Rake <  -60
C     -0.5      Normal/Oblique            -150 < Rake < -120
C                                          -60 < Rake <  -30
C       0       Strike-Slip               -180 < Rake < -150
C                                          -30 < Rake <   30
C                                          150 < Rake <  180
C      0.5      Reverse/Oblique             30 < Rake <   60
C                                          120 < Rake <  150
C       1       Reverse                     60 < Rake <  120 
C     Note: Unknown Mechanism is not currently coded.  
      if (ftype .eq. -1.0) then
         mechS = 0.0
         mechN = 1.0
         mechR = 0.0
      elseif (ftype .eq. -0.5) then 
         mechS = 0.0
         mechN = 1.0
         mechR = 0.0
      elseif (ftype .eq. 0.0) then 
         mechS = 1.0
         mechN = 0.0
         mechR = 0.0
      elseif (ftype .eq. 0.5) then
         mechS = 0.0
         mechN = 0.0
         mechR = 1.0
      elseif (ftype .eq. 1.0) then
         mechS = 0.0
         mechN = 0.0
         mechR = 1.0
      endif 

C.....First compute the Reference Rock PGA value...........
C.....This will include the regional dependence for PGA....
C.....MAGNITUDE DEPENDENCE.................................
      if (mag .le. mh(1)) then
         term1 = e1(1)*mechS + e2(1)*mechN + e3(1)*mechR +
     1           e4(1)*(mag-mh(1)) + e5(1)*(mag-mh(1))**2.0
      else
         term1 = e1(1)*mechS + e2(1)*mechN + e3(1)*mechR +
     1           e6(1)*(mag-mh(1))
      endif
C.....Distance dependence......
      Rp = SQRT( Rbjf*Rbjf+h(1)*h(1) )

C.....Apply Regional term.....
      if (regionflag .eq. 0) then
         TERM2 = ( c1(1) + c2(1)*(mag-mref) ) * alog(Rp/rref) + 
     1          ( c3(1) + DC3global(1) ) * (Rp-rref)
      elseif (regionflag .eq. 1) then
         TERM2 = ( c1(1) + c2(1)*(mag-mref) ) * alog(Rp/rref) + 
     1          ( c3(1) + DC3ChinaTrk(1) ) * (Rp-rref)
      elseif (regionflag .eq. 2) then
         TERM2 = ( c1(1) + c2(1)*(mag-mref) ) * alog(Rp/rref) + 
     1          ( c3(1) + DC3ItalyJapan(1) ) * (Rp-rref)      
      endif
      
      pga4nl = exp(term1+term2)


C.....Now compute the requested ground motion value........
C.....MAGNITUDE DEPENDENCE.................................
      if (mag .le. mhT) then
         term1 = e1T*mechS + e2T*mechN + e3T*mechR +
     1           e4T*(mag-mhT) + e5T*(mag-mhT)**2.0
      else
         term1 = e1T*mechS + e2T*mechN + e3T*mechR +
     1           e6T*(mag-mhT)
      endif

C.....Distance dependence......
      R = SQRT( Rbjf*Rbjf+hT*hT )

C     Now apply the regional attenuation differnece.
C     Global Case
      if (regionflag .eq. 0) then
         TERM2 = ( c1T + c2T*(mag-mref) ) * alog(R/rref) + 
     1        c3T * (R-rref) + DC3globalT * (R-rref)
C     China-Turkey Case
      elseif (regionflag .eq. 1) then
         TERM2 = ( c1T + c2T*(mag-mref) ) * alog(R/rref) + 
     1        c3T * (R-rref) + DC3ChinaTrkT * (R-rref)
C     Italy-Japan Case
      elseif (regionflag .eq. 2) then
         TERM2 = ( c1T + c2T*(mag-mref) ) * alog(R/rref) + 
     1        c3T * (R-rref) + DC3ItalyJapanT * (R-rref)
      endif

C.....Site Response Term.........
C.....Now compute the site term........
C.....First the linear term......
      if (vs .lt. VcT ) then
         flin = cT*alog(Vs/Vref)
      else
         flin = cT*alog(VcT/Vref)
      endif

C.....Next the non-linear term......
      f2 = f4T*(exp(f5T*(min(vs,760.0)-360.0))-exp(f5T*(760.0-360.0))) 
      
C.....Now compute the basin effect term......
C Deviation from ln(Vs30) scaling: bedrock depth (Z1) effect for California.
      if (basinflag .eq. 1) then 
c     Compute the DeltaZ1 term. Apply the California model for all regions except for Japan. 
         if (regionflag .eq. 2) then
             deltaz1 = z10 -
     1           exp(-5.23/2.0 * alog((vs**2.0 + 412.29**2.0)/(1360.0**2.0 + 412.39**2.0)))/1000.0
         else
             deltaz1 = z10 -
     1           exp(-7.15/4.0 * alog((vs**4.0 + 570.94**4.0)/(1360.0**4.0 + 570.94**4.0)))/1000.0        
         endif

         if (specT .lt. 0.65) then
            fbasin = 0.0
         else
            if (deltaZ1 .le. f7T/f6T) then
               fbasin = f6T * deltaZ1
            elseif (deltaZ1 .gt. f7T/f6T) then
               fbasin = f7T
            endif
         endif
      else
         fbasin = 0.0
      endif

      TERM3 = flin + f1 + f2*alog((pga4nl+f3)/f3) + fBasin
      
      lnY = term1 + term2 + term3 

      period2 = period1

c     Now compute the sigma value which is a function of magnitude and Vs
C     Tau (Eq. 4.11)
      if (mag .le. 4.5) then
         tau = t1T
      elseif (mag .gt. 4.5 .and. mag .lt. 5.5) then
         tau = t1T + (t2T - t1T)*(mag - 4.5)
      else
         tau = t2T
      endif
      
C     Phi - Magnitude (Eq. 4.12) 
      if (mag .le. 4.5) then
         phi = l1T
      elseif (mag .gt. 4.5 .and. mag .lt. 5.5) then
         phi = l1T + (l2T - l1T)*(mag - 4.5)
      else
         phi = l2T
      endif

C     Phi - Distance (Eq. 4.13)
      if (rbjf .le. R1T) then
          phi = phi
      elseif (rbjf .gt. R1T .and. rbjf .le. R2T) then
          phi = phi + DfrT*( (alog(rbjf/R1T))/(alog(R2T/R1T)) )
      else
          phi = phi + DfrT 
      endif

C     Phi - Vs30 (Eq. 4.14)
      if (vs .ge. V2) then
         phi = phi
      elseif (vs .ge. V1 .and. vs .lt. V2) then
         phi = phi - DfvT*( alog(V2/vs) / alog(V2/V1) )
      else
         phi = phi - DfvT
      endif

      sigma = sqrt (tau**2 + phi**2)

C     Convert ground motion to units of gals.
      lnY = lnY + 6.89

      return
      END

c ---------------------------------------------------------------------            
C     *** Campbell and Bozorgnia NGA West2 (NGA-2013) ***
C         Earthquake Spectra Paper:
C            Campbell-Bozorgnia NGA-West2 ground motion model
C                 for the average horizontal components of PGA, 
C                 PGV, and 5%-damped linear Response Spectra
C             K. W. Campbel and Y. Bozorgnia
C     Notes:
C        Applicable Range:
C            3.3 < M < 8.5 (strike-slip)
C            3.3 < M < 8.0 (reverse)
C            3.3 < M < 7.5 (normal)
C            Distance < 300km
C            150 < Vs30m < 1500 m/s
C            0 < Z25 < 10 km
C            0 < Zhyp < 20 km
C            15 < Dip < 90 
C        Report provides formulation for estimating recommended
C           parameters when they are not defined (e.g., Z25 given Vs30m).
C           See Chapter 06 of the report. 
c ---------------------------------------------------------------------------            

      subroutine CB_NGAWest2_2013 ( mag, Rrup, Rbjf, Ftype, specT, 
     1                     period2, lnY, sigma, iflag, vs,
     2                     depthtop, D25, Dip, depth, HWflag, Rx, rupwidth, regionflag, phi, tau ) 

C     Last Updated: 5/22/14
C     Coefficients updated from PEER Report version to be consistent with EQ Spectra paper in press. 
C     Minor change to T=5, 7.5, and 10 sec for coefficient C6

      parameter (MAXPER=23)
      REAL Period(MAXPER), C0(MAXPER), C1(MAXPER), C2(MAXPER), C3(MAXPER), C4(MAXPER), C5(MAXPER)
      REAL C6(MAXPER), C7(MAXPER), C8(MAXPER), C9(MAXPER), C10(MAXPER), C11(MAXPER), C12(MAXPER)
      REAL C13(MAXPER), C14(MAXPER), C15(MAXPER), C16(MAXPER), C17(MAXPER), C18(MAXPER), C19(MAXPER)
      REAL A2(MAXPER), h1(MAXPER), h2(MAXPER), h3(MAXPER), h4(MAXPER)
      REAL h5(MAXPER), h6(MAXPER)
      REAL K1(MAXPER), K2(MAXPER), K3(MAXPER)
      REAL C20(MAXPER), DC20CA(MAXPER), DC20JP(MAXPER), DC20CH(MAXPER)
      REAL T1(MAXPER), T2(MAXPER), phi1(MAXPER), Phi2(MAXPER), phic(MAXPER)
      REAL flnAF(MAXPER), rho(MAXPER)

      REAL MAG, RRUP, RBJF, VS, D25, FHWR, FHWM, FHWZ, FHWD, PGAROCK, C, N
      real lnY, ftype, Dip, pgasoil, Rx, R1, R2, f1, f2
      real fhypH, D25_RK
      INTEGER count1, count2, HWFlag, regionflag

      real c0T, c1T, c2T, c3T, c4T, c5T, c6T, c7T, c8T, c9T, c10T, c11T, c12T
      real c13T, c14T, c15T ,c16T, c17T, c18T, c19T, c20T, Dc20CAT, Dc20JPT, Dc20CHT
      real k1T, k2T, k3T, a2T, h1T, h2T, h3T, h4T, h5T, h6T
      real t1T, t2T, phi1T, phi2T, phicT
      real rhoT, flnAFT

      real alpha, tau
      real tau_lnyB, tau_lnPGAB, phi_lnY, phi_lnyB, phi_lnPGAB, phi, sigmatot

C.....MODEL COEFFICIENTS.....................

      data Period / 0.0, -1.0, 0.01, 0.02, 0.03, 0.05, 0.075, 0.1, 0.15, 0.2, 0.25, 
     1       0.3, 0.4, 0.5, 0.75, 1.0, 1.5, 2.0, 3.0, 4.0, 5.0, 7.5, 10.0 /
      data c0 / -4.416, -2.895, -4.365, -4.348, -4.024, -3.479, -3.293, -3.666, -4.866, 
     1       -5.411, -5.962, -6.403, -7.566, -8.379, -9.841, -11.011, -12.469, -12.969, 
     2      -13.306, -14.02, -14.558, -15.509, -15.975 / 
      data c1 / 0.984, 1.51, 0.977, 0.976, 0.931, 0.887, 0.902, 0.993, 1.267, 1.366, 
     1       1.458, 1.528, 1.739, 1.872, 2.021, 2.18, 2.27, 2.271, 2.15, 2.132, 2.116,
     2       2.223, 2.132  /
      data c2 / 0.537, 0.27, 0.533, 0.549, 0.628, 0.674, 0.726, 0.698, 0.51, 0.447, 0.274, 
     1       0.193, -0.02, -0.121, -0.042, -0.069, 0.047, 0.149, 0.368, 0.726, 1.027, 
     2       0.169, 0.367  /
      data c3 / -1.499, -1.299, -1.485, -1.488, -1.494, -1.388, -1.469, -1.572, -1.669, 
     1      -1.75, -1.711, -1.77, -1.594, -1.577, -1.757, -1.707, -1.621, -1.512, -1.315, 
     2      -1.506, -1.721, -0.756, -0.8  /
      data c4 / -0.496, -0.453, -0.499, -0.501, -0.517, -0.615, -0.596, -0.536, -0.49, 
     1      -0.451, -0.404, -0.321, -0.426, -0.44, -0.443, -0.527, -0.63, -0.768, -0.89, 
     2      -0.885, -0.878, -1.077, -1.282  /
      data c5 / -2.773, -2.466, -2.773, -2.772, -2.782, -2.791, -2.745, -2.633, -2.458, 
     1      -2.421, -2.392, -2.376, -2.303, -2.296, -2.232, -2.158, -2.063, -2.104, -2.051,
     2      -1.986, -2.021, -2.179, -2.244  /
      data c6 / 0.248, 0.204, 0.248, 0.247, 0.246, 0.24, 0.227, 0.21, 0.183, 0.182, 0.189, 
     1       0.195, 0.185, 0.186, 0.186, 0.169, 0.158, 0.158, 0.148, 0.135, 0.135, 0.165, 0.180  /
      data c7 / 6.768, 5.837, 6.753, 6.502, 6.291, 6.317, 6.861, 7.294, 8.031, 8.385, 7.534, 
     1       6.99, 7.012, 6.902, 5.522, 5.65, 5.795, 6.632, 6.759, 7.978, 8.538, 8.468, 6.564  /
      data c8 / 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
     1       0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0  /
      data c9 / -0.212, -0.168, -0.214, -0.208, -0.213, -0.244, -0.266, -0.229, -0.211, -0.163,
     1      -0.15, -0.131, -0.159, -0.153, -0.09, -0.105, -0.058, -0.028, 0.0, 0.0, 0.0, 0.0, 0.0  /
      data c10 / 0.72, 0.305, 0.72, 0.73, 0.759, 0.826, 0.815, 0.831, 0.749, 0.764, 0.716, 0.737, 
     1       0.738, 0.718, 0.795, 0.556, 0.48, 0.401, 0.206, 0.105, 0.0, 0.0, 0.0  /
      data c11 / 1.09, 1.713, 1.094, 1.149, 1.29, 1.449, 1.535, 1.615, 1.877, 2.069, 2.205, 
     1       2.306, 2.398, 2.355, 1.995, 1.447, 0.33, -0.514, -0.848, -0.793, -0.748,
     2      -0.664, -0.576  /
      data c12 / 2.186, 2.602, 2.191, 2.189, 2.164, 2.138, 2.446, 2.969, 3.544, 3.707, 
     1       3.343, 3.334, 3.544, 3.016, 2.616, 2.47, 2.108, 1.327, 0.601, 0.568, 0.356, 
     2       0.075, -0.027  /
      data c13 / 1.42, 2.457, 1.416, 1.453, 1.476, 1.549, 1.772, 1.916, 2.161, 2.465, 
     1       2.766, 3.011, 3.203, 3.333, 3.054, 2.562, 1.453, 0.657, 0.367, 0.306, 0.268, 
     2       0.374, 0.297 /
      data c14 / -0.0064, 0.106, -0.007, -0.0167, -0.0422, -0.0663, -0.0794, -0.0294, 
     1       0.0642, 0.0968, 0.1441, 0.1597, 0.141, 0.1474, 0.1764, 0.2593, 0.2881,
     2       0.3112, 0.3478, 0.3747, 0.3382, 0.3754, 0.3506  /
      data c15 / -0.202, 0.332, -0.207, -0.199, -0.202, -0.339, -0.404, -0.416, -0.407,
     1      -0.311, -0.172, -0.084, 0.085, 0.233, 0.411, 0.479, 0.566, 0.562, 0.534, 
     2       0.522, 0.477, 0.321, 0.174  /
      data c16 / 0.393, 0.585, 0.39, 0.387, 0.378, 0.295, 0.322, 0.384, 0.417, 0.404, 
     1       0.466, 0.528, 0.54, 0.638, 0.776, 0.771, 0.748, 0.763, 0.686, 0.691, 
     2       0.67, 0.757, 0.621  /
      data c17 / 0.0977, 0.0517, 0.0981, 0.1009, 0.1095, 0.1226, 0.1165, 0.0998, 0.076, 
     1       0.0571, 0.0437, 0.0323, 0.0209, 0.0092, -0.0082, -0.0131, -0.0187, -0.0258, 
     2      -0.0311, -0.0413, -0.0281, -0.0205, 0.0009  /
      data c18 / 0.0333, 0.0327, 0.0334, 0.0327, 0.0331, 0.027, 0.0288, 0.0325, 0.0388, 
     1       0.0437, 0.0463, 0.0508, 0.0432, 0.0405, 0.042, 0.0426, 0.038, 0.0252, 0.0236, 
     2       0.0102, 0.0034, 0.005, 0.0099  /
      data c19 / 0.00757, 0.00613, 0.00755, 0.00759, 0.0079, 0.00803, 0.00811, 0.00744, 
     1       0.00716, 0.00688, 0.00556, 0.00458, 0.00401, 0.00388, 0.0042, 0.00409, 0.00424, 
     2       0.00448, 0.00345, 0.00603, 0.00805, 0.0028, 0.00458  /
      data k1 / 865.0, 400.0, 865.0, 865.0, 908.0, 1054.0, 1086.0, 1032.0, 878.0, 748.0, 654.0, 
     1       587.0, 503.0, 457.0, 410.0, 400.0, 400.0, 400.0, 400.0, 400.0, 400.0, 400.0, 400.0  /
      data k2 / -1.186, -1.955, -1.186, -1.219, -1.273, -1.346, -1.471, -1.624, -1.931, -2.188,
     1      -2.381, -2.518, -2.657, -2.669, -2.401, -1.955, -1.025, -0.299, 0.0, 0.0,
     2       0.0, 0.0, 0.0  /
      data k3 / 1.839, 1.929, 1.839, 1.84, 1.841, 1.843, 1.845, 1.847, 1.852, 1.856, 1.861, 
     1       1.865, 1.874, 1.883, 1.906, 1.929, 1.974, 2.019, 2.11, 2.2, 2.291, 2.517, 2.744  /
      data a2 / 0.167, 0.596, 0.168, 0.166, 0.167, 0.173, 0.198, 0.174, 0.198, 0.204, 0.185, 0.164,
     1       0.16, 0.184, 0.216, 0.596, 0.596, 0.596, 0.596, 0.596, 0.596, 0.596, 0.596  /
      data h1 / 0.241, 0.117, 0.242, 0.244, 0.246, 0.251, 0.26, 0.259, 0.254, 0.237, 0.206, 0.21, 
     1       0.226, 0.217, 0.154, 0.117, 0.117, 0.117, 0.117, 0.117, 0.117, 0.117, 0.117  /
      data h2 / 1.474, 1.616, 1.471, 1.467, 1.467, 1.449, 1.435, 1.449, 1.461, 1.484, 1.581, 
     1       1.586, 1.544, 1.554, 1.626, 1.616, 1.616, 1.616, 1.616, 1.616, 1.616, 1.616, 1.616  /
      data h3 / -0.715, -0.733, -0.714, -0.711, -0.713, -0.701, -0.695, -0.708, -0.715, -0.721, 
     1      -0.787, -0.795, -0.77, -0.77, -0.78, -0.733, -0.733, -0.733, -0.733, -0.733, -0.733, 
     2      -0.733, -0.733 /
      data h4 / 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 
     1       1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0  /
      data h5 / -0.337, -0.128, -0.336, -0.339, -0.338, -0.338, -0.347, -0.391, -0.449, -0.393, 
     1      -0.339, -0.447, -0.525, -0.407, -0.371, -0.128, -0.128, -0.128, -0.128, -0.128, 
     2      -0.128, -0.128, -0.128  /
      data h6 / -0.27, -0.756, -0.27, -0.263, -0.259, -0.263, -0.219, -0.201, -0.099, -0.198,
     1      -0.21, -0.121, -0.086, -0.281, -0.285, -0.756, -0.756, -0.756, -0.756, -0.756, 
     2      -0.756, -0.756, -0.756  /
      data c20 / -0.0055, -0.0017, -0.0055, -0.0055, -0.0057, -0.0063, -0.007, -0.0073,
     1      -0.0069, -0.006, -0.0055, -0.0049, -0.0037, -0.0027, -0.0016, -0.0006, 0.0, 
     2       0.0, 0.0, 0.0, 0.0, 0.0, 0.0  /
      data Dc20CA / 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
     1       0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0  /
      data Dc20JP / -0.0035, -0.0006, -0.0035, -0.0035, -0.0034, -0.0037, -0.0037, 
     1      -0.0034, -0.003, -0.0031, -0.0033, -0.0035, -0.0034, -0.0034, -0.0032, 
     2      -0.003, -0.0019, -0.0005, 0.0, 0.0, 0.0, 0.0, 0.0  /
      data Dc20CH / 0.0036, 0.0017, 0.0036, 0.0036, 0.0037, 0.004, 0.0039, 0.0042, 
     1       0.0042, 0.0041, 0.0036, 0.0031, 0.0028, 0.0025, 0.0016, 0.0006, 0.0, 
     2       0.0, 0.0, 0.0, 0.0, 0.0, 0.0  /
      data t1 / 0.409, 0.317, 0.404, 0.417, 0.446, 0.508, 0.504, 0.445, 0.382, 0.339, 
     1          0.34, 0.34, 0.356, 0.379, 0.43, 0.47, 0.497, 0.499, 0.5, 0.543, 0.534, 
     2          0.523, 0.466  /
      data t2 / 0.322, 0.297, 0.325, 0.326, 0.344, 0.377, 0.418, 0.426, 0.387, 0.338, 
     1          0.316, 0.3, 0.264, 0.263, 0.326, 0.353, 0.399, 0.4, 0.417, 0.393, 
     2          0.421, 0.438, 0.438  /
      data phi1 / 0.734, 0.655, 0.734, 0.738, 0.747, 0.777, 0.782, 0.769, 0.769, 
     1            0.761, 0.744, 0.727, 0.69, 0.663, 0.606, 0.579, 0.541, 0.529, 0.527, 
     2            0.521, 0.502, 0.457, 0.441  /
      data phi2 / 0.492, 0.494, 0.492, 0.496, 0.503, 0.52, 0.535, 0.543, 0.543, 0.552,
     1            0.545, 0.568, 0.593, 0.611, 0.633, 0.628, 0.603, 0.588, 0.578, 0.559, 
     2            0.551, 0.546, 0.543  /
      data flnaf / 0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 
     1             0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3  /
      data phic / 0.166, 0.19, 0.166, 0.166, 0.165, 0.162, 0.158, 0.17, 0.18, 0.186,
     1            0.191, 0.198, 0.206, 0.208, 0.221, 0.225, 0.222, 0.226, 0.229, 
     2            0.237, 0.237, 0.271, 0.29  /
      data rho / 1.00, 0.684, 1.00, 0.998, 0.986, 0.938, 0.887, 0.87, 0.876, 0.87,
     1           0.85, 0.819, 0.743, 0.684, 0.562, 0.467, 0.364, 0.298, 0.234, 0.202, 
     1           0.184, 0.176, 0.154 /

      nPer = 23
      c = 1.88
      n = 1.18

C First check for the PGA case (i.e., specT=0.0) 
      if (specT .eq. 0.0) then
         period1 = period(1)
         c0T = c0(1)
         c1T = c1(1)
         c2T = c2(1)
         c3T = c3(1)
         c4T = c4(1)
         c5T = c5(1)
         c6T = c6(1)
         c7T = c7(1)
         c8T = c8(1)
         c9T = c9(1)
         c10T = c10(1)
         c11T = c11(1)
         c12T = c12(1)
         c13T = c13(1)
         c14T = c14(1)
         c15T = c15(1)
         c16T = c16(1)
         c17T = c17(1)
         c18T = c18(1)
         c19T = c19(1)

         a2T = a2(1)
         h1T = h1(1)
         h2T = h2(1)
         h3T = h3(1)
         h4T = h4(1)
         h5T = h5(1)
         h6T = h6(1)

         k1T = k1(1)
         k2T = k2(1)
         k3T = k3(1)
         c20T = c20(1)
         Dc20CAT = Dc20CA(1)
         Dc20JPT = Dc20JP(1)
         Dc20CHT = Dc20CH(1)
         
         phi1T = phi1(1)
         phi2T = phi2(1)
         t1T = t1(1)
         t2T = t2(1)
         flnAFT = flnaf(1)
         phicT = phic(1)
         rhoT = rho(1)

         goto 1011
      elseif (specT .eq. -1.0) then
         period1 = period(2)
        c0T = c0(2)
         c1T = c1(2)
         c2T = c2(2)
         c3T = c3(2)
         c4T = c4(2)
         c5T = c5(2)
         c6T = c6(2)
         c7T = c7(2)
         c8T = c8(2)
         c9T = c9(2)
         c10T = c10(2)
         c11T = c11(2)
         c12T = c12(2)
         c13T = c13(2)
         c14T = c14(2)
         c15T = c15(2)
         c16T = c16(2)
         c17T = c17(2)
         c18T = c18(2)
         c19T = c19(2)
         
         a2T = a2(2)
         h1T = h1(2)
         h2T = h2(2)
         h3T = h3(2)
         h4T = h4(2)
         h5T = h5(2)
         h6T = h6(2)

         k1T = k1(2)
         k2T = k2(2)
         k3T = k3(2)
         c20T = c20(2)
         Dc20CAT = Dc20CA(2)
         Dc20JPT = Dc20JP(2)
         Dc20CHT = Dc20CH(2)
         
         phi1T = phi1(2)
         phi2T = phi2(2)
         t1T = t1(2)
         t2T = t2(2)
         flnAFT = flnaf(2)
         phicT = phic(2)
         rhoT = rho(2)

         goto 1011

      elseif (specT .gt. 0.0) then
C Now loop over the spectral period range of the attenuation relationship.
         do i=3,nper-1
            if (specT .ge. period(i) .and. specT .le. period(i+1) ) then
               count1 = i
               count2 = i+1
               goto 1020 
            endif
         enddo
      endif

C Selected spectral period is outside range defined by attenuaton model.
      write (*,*) 
      write (*,*) 'Campbell&Bozorgnia (NGA West2-2013) Horizontal'
      write (*,*) 'attenuation model is not defined for a '
      write (*,*) ' spectral period of: ' 
      write (*,'(a10,f10.5)') ' Period = ',specT
      write (*,*) 'This spectral period is outside the defined'
      write (*,*) 'period range in the code or beyond the range'
      write (*,*) 'of spectral periods for interpolation.'
      write (*,*) 'Please check the input file.'
      write (*,*) 
      stop 99

C Interpolate the coefficients for the requested spectral period.
 1020       call interp (period(count1),period(count2),c0(count1),c0(count2),
     +                   specT,c0T,iflag)
            call interp (period(count1),period(count2),c1(count1),c1(count2),
     +                   specT,c1T,iflag)
            call interp (period(count1),period(count2),c2(count1),c2(count2),
     +                   specT,c2T,iflag)
            call interp (period(count1),period(count2),c3(count1),c3(count2),
     +                   specT,c3T,iflag)
            call interp (period(count1),period(count2),c4(count1),c4(count2),
     +                   specT,c4T,iflag)
            call interp (period(count1),period(count2),c5(count1),c5(count2),
     +                   specT,c5T,iflag)
            call interp (period(count1),period(count2),c6(count1),c6(count2),
     +                   specT,c6T,iflag)
            call interp (period(count1),period(count2),c7(count1),c7(count2),
     +                   specT,c7T,iflag)
            call interp (period(count1),period(count2),c8(count1),c8(count2),
     +                   specT,c8T,iflag)
            call interp (period(count1),period(count2),c9(count1),c9(count2),
     +                   specT,c9T,iflag)
            call interp (period(count1),period(count2),c10(count1),c10(count2),
     +                   specT,c10T,iflag)
            call interp (period(count1),period(count2),c11(count1),c11(count2),
     +                   specT,c11T,iflag)
            call interp (period(count1),period(count2),c12(count1),c12(count2),
     +                   specT,c12T,iflag)
            call interp (period(count1),period(count2),c13(count1),c13(count2),
     +                   specT,c13T,iflag)
            call interp (period(count1),period(count2),c14(count1),c14(count2),
     +                   specT,c14T,iflag)
            call interp (period(count1),period(count2),c15(count1),c15(count2),
     +                   specT,c15T,iflag)
            call interp (period(count1),period(count2),c16(count1),c16(count2),
     +                   specT,c16T,iflag)
            call interp (period(count1),period(count2),c17(count1),c17(count2),
     +                   specT,c17T,iflag)
            call interp (period(count1),period(count2),c18(count1),c18(count2),
     +                   specT,c18T,iflag)
            call interp (period(count1),period(count2),c19(count1),c19(count2),
     +                   specT,c19T,iflag)
            call interp (period(count1),period(count2),a2(count1),a2(count2),
     +                   specT,a2T,iflag)
            call interp (period(count1),period(count2),h1(count1),h1(count2),
     +                   specT,h1T,iflag)
            call interp (period(count1),period(count2),h2(count1),h2(count2),
     +                   specT,h2T,iflag)
            call interp (period(count1),period(count2),h3(count1),h3(count2),
     +                   specT,h3T,iflag)
            call interp (period(count1),period(count2),h4(count1),h4(count2),
     +                   specT,h4T,iflag)
            call interp (period(count1),period(count2),h5(count1),h5(count2),
     +                   specT,h5T,iflag)
            call interp (period(count1),period(count2),h6(count1),h6(count2),
     +                   specT,h6T,iflag)

            call interp (period(count1),period(count2),k1(count1),k1(count2),
     +                   specT,k1T,iflag)
            call interp (period(count1),period(count2),k2(count1),k2(count2),
     +                   specT,k2T,iflag)
            call interp (period(count1),period(count2),k3(count1),k3(count2),
     +                   specT,k3T,iflag)

            call interp (period(count1),period(count2),c20(count1),c20(count2),
     +                   specT,c20T,iflag)
            call interp (period(count1),period(count2),Dc20CA(count1),Dc20CA(count2),
     +                   specT,Dc20CAT,iflag)
            call interp (period(count1),period(count2),Dc20JP(count1),Dc20JP(count2),
     +                   specT,Dc20JPT,iflag)
            call interp (period(count1),period(count2),Dc20CH(count1),Dc20CH(count2),
     +                   specT,Dc20CHT,iflag)
     
            call interp (period(count1),period(count2),phi1(count1),phi1(count2),
     +                   specT,phi1T,iflag)
            call interp (period(count1),period(count2),phi2(count1),phi2(count2),
     +                   specT,phi2T,iflag)
            call interp (period(count1),period(count2),t1(count1),t1(count2),
     +                   specT,t1T,iflag)
            call interp (period(count1),period(count2),t2(count1),t2(count2),
     +                   specT,t2T,iflag)
            call interp (period(count1),period(count2),flnAF(count1),flnAF(count2),
     +                   specT,flnAfT,iflag)
            call interp (period(count1),period(count2),phic(count1),phic(count2),
     +                   specT,phicT,iflag)
            call interp (period(count1),period(count2),rho(count1),rho(count2),
     +                   specT,rhoT,iflag)

 1011 period1 = specT                                                                                                              

C.....COMPUTE ROCK PGA VALUE FIRST.........................
C.....MAGNITUDE DEPENDENCE (Eq 3.2)........................
      IF (MAG .LE. 4.5) THEN
         TERM1 = C0(1) + C1(1)*MAG
      elseif (mag .le. 5.5) then
         TERM1 = C0(1) + c1(1)*MAG + c2(1)*(MAG-4.5)
      elseif (mag .le. 6.5) then
         TERM1 = C0(1) + C1(1)*MAG + c2(1)*(MAG-4.5) + c3(1)*(mag-5.5)
      ELSE
         TERM1 = C0(1) + C1(1)*MAG + c2(1)*(MAG-4.5) + C3(1)*(MAG-5.5) + c4(1)*(mag-6.5)
      ENDIF
      
C.....Distance dependence (Eq 3.3).....
      R = SQRT( RRUP*RRUP+C7(1)*C7(1) )
      TERM2 = (C5(1) + C6(1)*MAG)*ALOG(R)

C.....SET UP STYLE OF FAULTING TERMS (Eq 3.4, 3.5, and 3.6).........

C     Set mechanism term and corresponding Frv and Fnm values.
C     fType     Mechanism                      Rake
C     ------------------------------------------------------
C    -1,-0.5    Normal and NMl/Obl       -150 < Rake < -30.0
C     1, 0.5    Reverse and Rev/Obl        30 < Rake < 150.0
C       0       Strike-Slip                    Otherwise
      IF (Ftype .EQ. 0.0) THEN
         TERM3 = 0.0
      ELSEIF (Ftype .ge. 0.5) THEN
         if (mag .le. 4.5) then
            TERM3 = 0.0
         elseif (mag .le. 5.5) then
            TERM3 = C8(1)*(mag-4.5)
         else
            TERM3 = c8(1)
         endif
      ELSEIF (Ftype .le. -0.5) THEN
         if (mag .le. 4.5) then
            TERM3 = 0.0
         elseif (mag .le. 5.5) then
            TERM3 = C9(1)*(mag-4.5)
         else
            TERM3 = C9(1)
         endif
      ENDIF

C.....SET UP HANGING WALL TERMS (Eq 3.7)..............
      if (HWflag .eq. 1) then
         R1 = rupwidth*cos(abs(dip)*3.14159/180.0)
         R2 = 62.0*mag - 350.0
         f1 = h1(1) + h2(1)*(Rx/R1) + h3(1)*(Rx/R1)**2.0
         f2 = h4(1) + h5(1)*((Rx-R1)/(R2-R1)) + h6(1)*((Rx-R1)/(R2-R1))**2.0
         if (Rrup .eq. 0.0) then
            fhwrrup = 1.0
         else
            fhwrrup = ((Rrup-Rbjf)/Rrup)         
         endif
         if (Rx .lt. R1) Then
            fhwr = f1*fhwrrup
         else
            fhwr = max(f2,0.0)*fhwrrup
         endif
         if (mag .le. 5.5) then
            fhwm = 0.0         
         elseif (mag .le. 6.5) then
            fhwm = (mag-5.5)*(1.0+a2(1)*(mag-6.5))
         else
            fhwm = 1.0 + a2(1)*(mag-6.5)        
         endif
         if (depthtop .le. 16.66) then
            fhwz = 1.0 - 0.06*depthtop 
         else
            fhwz = 0.0
         endif
         fhwd = (90.0 - dip)/45.0        
         TERM4 = c10(1)*fhwr*fhwm*fhwz*fhwd
      else   
         term4 = 0.0
      endif 

C.....NOW COMPUTE THE SITE CONDITION FACTORS...............
C.....(FOR PGA ROCK, VS=1100, i.e., Vs>k1)
      TERM5_RK = (C11(1) + K2(1)*n)*ALOG( 1100.0/K1(1) )
      if (regionflag .eq. 1) then
         TERM5_RK = TERM5_RK + (C13(1) + K2(1)*n)*ALOG( 1100.0/K1(1) )
      endif
C.....NOW COMPUTE THE SEDIMENT DEPTH DEPENDENCE (Eq 3.17)............
C     For Rock PGA the D25 value should be set at the recommended value of D25=0.398
      D25_RK = 0.398
      if (D25_RK .le. 1.0) then
         if (regionflag .eq. 1) then
c            TERM6 = (C14(1)+c15(1))*(D25-1.0)
            TERM6_RK = (C14(1)+c15(1))*(D25_RK-1.0)
         else
c            TERM6 = C14(1)*(D25-1.0)
            TERM6_RK = C14(1)*(D25_RK-1.0)
         endif   
      elseif (D25_RK .GT. 1.0 .AND. D25_RK .LE. 3.0) then
        TERM6_RK = 0.0
      elseif (D25_RK .GT. 3.0) then
         TERM6_RK = c16(1)*k3(1)*exp(-0.75)*(1.0-exp(-0.25*(D25_RK-3.0)))
      endif

C.....Now compute the hypocentral depth term (Eq 3.21).........
      if (depth .le. 7.0) then
         fhypH = 0.0
      elseif (depth .le. 20.0) then
         fhypH = depth - 7.0      
      else
         fhypH = 13.0
      endif
      if (mag .le. 5.5) then
          term7 = c17(1)*fhypH
      elseif (mag .le. 6.5) then
          term7 = (c17(1) + (c18(1)-c17(1))*(mag-5.5))*fhypH
      else
          term7 = c18(1)*fhypH     
      endif

C.....Compute Rupture Dip term (Eq 3.24)............
      if (mag .le. 4.5) then
          term8 = c19(1)*dip
      elseif (mag .le. 5.5) then
          term8 = c19(1)*(5.5-mag)*dip      
      else 
          term8 = 0.0
      endif

C.....Compute anelastic attenuation term.....
      if (Rrup .le. 80.0) then
         term9 = 0.0
      else      
         if (regionflag .eq. 0) then
            term9 = (c20(1)+Dc20CA(1) ) * (Rrup-80.0)
         elseif (regionflag .eq. 1 .or. regionflag .eq. 3) then
            term9 = (c20(1)+Dc20JP(1) ) * (Rrup-80.0)
         elseif (regionflag .eq. 2) then
            term9 = (c20(1)+Dc20CH(1) ) * (Rrup-80.0)      
         endif
      endif      
      
      PGAROCK = EXP(TERM1+TERM2+TERM3+TERM4+TERM5_RK+TERM6_RK+TERM7+TERM8+TERM9)
            
C.....For PGA Specific Vs30m Value
      if (vs .le. k1(1) ) then
         term5 = c11(1)*alog(vs/k1(1)) + 
     1           k2(1)*(alog(pgarock+c*((vs/k1(1))**n)) - 
     2           alog(pgarock+c))
      else
         term5 = (c11(1) + k2(1)*n)*alog(vs/k1(1))
      endif

C     Add Japan Site response Factor is requested
      if (regionflag .eq. 1) then
         if (VS .le. 200.0) then
            term5 = term5 + (c12(1)+k2(1)*n)*(alog(VS/k1(1))-alog(200.0/k1(1)))
         else
            term5 = term5 + (c13(1)+k2(1)*n)*alog(Vs/k1(1))
         endif
      endif

C.....NOW COMPUTE THE SEDIMENT DEPTH DEPENDENCE (Eq 3.17)............
C     For Rock PGA the D25 value should be set at the recommended value of D25=0.398
      if (D25 .le. 1.0) then
         if (regionflag .eq. 1) then
            TERM6 = (C14(1)+c15(1))*(D25-1.0)
         else
            TERM6 = C14(1)*(D25-1.0)
         endif   
      elseif (D25 .GT. 1.0 .AND. D25 .LE. 3.0) then
        TERM6 = 0.0
      elseif (D25 .GT. 3.0) then
         TERM6 = c16(1)*k3(1)*exp(-0.75)*(1.0-exp(-0.25*(D25-3.0)))
      endif

      pgasoil = alog(pgarock) - term5_rk - term6_RK + term5 + term6
      psoil2 = (TERM1+TERM2+TERM3+TERM4+TERM5+TERM6+TERM7+TERM8+TERM9)


C.....NOW COMPUTE THE GROUND MOTION VALUES.................
C.....MAGNITUDE DEPENDENCE.................................
      IF (MAG .LE. 4.5) THEN
         TERM1 = C0T + C1T*MAG
      elseif (mag .le. 5.5) then
         TERM1 = C0T + c1T*MAG + c2T*(MAG-4.5)
      elseif (mag .le. 6.5) then
         TERM1 = C0T + C1T*MAG + c2T*(MAG-4.5) + c3T*(mag-5.5)
      ELSE
         TERM1 = C0T + C1T*MAG + c2T*(MAG-4.5) + C3T*(MAG-5.5) + c4T*(mag-6.5)
      ENDIF

C.....Distance dependence......
      R = SQRT( RRUP*RRUP+C7T*C7T )
      TERM2 = (C5T + C6T*MAG)*ALOG(R)

C.....SET UP STYLE OF FAULTING TERMS...........

C     Set mechanism term and corresponding Frv and Fnm values.
C     fType     Mechanism                      Rake
C     ------------------------------------------------------
C    -1,-0.5    Normal and NMl/Obl       -150 < Rake < -30.0
C     1, 0.5    Reverse and Rev/Obl        30 < Rake < 150.0
C       0       Strike-Slip                    Otherwise
      IF (Ftype .EQ. 0.0) THEN
         TERM3 = 0.0
      ELSEIF (Ftype .ge. 0.5) THEN
         if (mag .le. 4.5) then
            TERM3 = 0.0
         elseif (mag .le. 5.5) then
            TERM3 = C8T*(mag-4.5)
         else
            TERM3 = C8T
         endif
      ELSEIF (Ftype .le. -0.5) THEN
         if (mag .le. 4.5) then
            TERM3 = 0.0
         elseif (mag .le. 5.5) then
            TERM3 = C9T*(mag-4.5)
         else
            TERM3 = C9T
         endif
      ENDIF

C.....SET UP HANGING WALL TERMS................
      if (HWflag .eq. 1) then
         R1 = rupwidth*cos(abs(dip)*3.14159/180.0)
         R2 = 62.0*mag - 350.0
         f1 = h1T + h2T*(Rx/R1) + h3T*(Rx/R1)**2.0
         f2 = h4T + h5T*((Rx-R1)/(R2-R1)) + h6T*((Rx-R1)/(R2-R1))**2.0
         if (Rrup .eq. 0.0) then
            fhwrrup = 1.0
         else
            fhwrrup = ((Rrup-Rbjf)/Rrup)         
         endif
         if (Rx .lt. R1) Then
            fhwr = f1*fhwrrup
         else
            fhwr = max(f2,0.0)*fhwrrup
         endif
         if (mag .le. 5.5) then
            fhwm = 0.0         
         elseif (mag .le. 6.5) then
            fhwm = (mag-5.5)*(1.0+a2T*(mag-6.5))
         else
            fhwm = 1.0 + a2T*(mag-6.5)        
         endif
         if (depthtop .le. 16.66) then
            fhwz = 1.0 - 0.06*depthtop 
         else
            fhwz = 0.0
         endif
         fhwd = (90.0 - dip)/45.0        
         TERM4 = c10T*fhwr*fhwm*fhwz*fhwd
      else   
         term4 = 0.0
      endif 

C.....NOW COMPUTE THE SITE CONDITION FACTORS...............
      IF (VS .LE. K1T ) THEN
         TERM5 = C11T*ALOG( VS/K1T ) +
     1           K2T*( ALOG( PGAROCK+c*( (VS/K1T)**N) ) -
     2           ALOG( PGAROCK+c ) )
      ELSE
         TERM5 = ( C11T+K2T*n )*ALOG( VS/K1T )
      ENDIF
c     Add Japan Site Term Effects
      if (regionflag .eq. 1) then
         IF (VS .LE. 200.0 ) THEN
            TERM5 = term5 + (C12T+k2T*n)*(alog(Vs/k1T)-alog(200/k1T))
         ELSE
            TERM5 = term5 + ( C13T+K2T*n )*ALOG( VS/K1T )
         ENDIF
      endif

C.....NOW COMPUTE THE SEDIMENT DEPTH DEPENDENCE.............
      IF (D25 .LE. 1.0) THEN
         if (regionflag .eq. 1) then
            TERM6 = (C14T+c15T)*(D25-1.0)
          else
            TERM6 = C14T*(D25-1.0)
          endif
      ELSEIF (D25 .GT. 1.0 .AND. D25 .LE. 3.0) THEN
         TERM6 = 0.0
      ELSEIF (D25 .GT. 3.0)  THEN
         TERM6 = c16T*k3T*exp(-0.75)*( 1.0 - exp(-0.25*(D25-3.0)))
      ENDIF
      
C.....Now compute the hypocentral depth term..........
      if (depth .le. 7.0) then
         fhypH = 0.0
      elseif (depth .le. 20.0) then
         fhypH = depth - 7.0      
      else
         fhypH = 13.0
      endif
      if (mag .le. 5.5) then
          term7 = c17T*fhypH
      elseif (mag .le. 6.5) then
          term7 = (c17T + (c18T-c17T)*(mag-5.5))*fhypH
      else
          term7 = c18T*fhypH     
      endif

C.....Compute Rupture Dip term.............
      if (mag .le. 4.5) then
          term8 = c19T*dip
      elseif (mag .le. 5.5) then
          term8 = c19T*(5.5-mag)*dip      
      else 
          term8 = 0.0
      endif

C.....Compute anelastic attenuation term.....
      if (Rrup .le. 80.0) then
         term9 = 0.0
      else
         if (regionflag .eq. 0) then
            term9 = (c20T+Dc20CAT)*(Rrup-80.0)
         elseif (regionflag .eq. 1 .or. regionflag .eq. 3) then
             term9 = (c20T+Dc20JPT)*(Rrup-80.0)
         elseif (regionflag .eq. 2) then
             term9 = (c20T+Dc20CHT)*(Rrup-80.0)
         endif
      endif

      LnY = (TERM1+TERM2+TERM3+TERM4+TERM5+TERM6+TERM7+TERM8+TERM9)

C    Check that SA is not less than PGA for T<0.25sec
      if (specT .lt. 0.25) then
         if (lnY .lt. pgasoil ) then
            lnY = pgasoil
         endif
      endif

C.....Now compute the sigma value..........
      IF (Vs .LT. k1T) THEN
        alpha = k2T*pgarock*(1/(pgarock  
     &    +c*(Vs/k1T)**n) 
     &    -1/(pgarock + c))
      ELSE
        alpha = 0.0
      ENDIF

      If (Mag.le.4.5) then
	   tau_lnyB = t1T
	   tau_lnPGAB = t1(1)
	elseif (Mag.lt.5.5) then
	   tau_lnyB = t2T + 
     &          (t1T - t2T)*(5.5-mag)
	   tau_lnPGAB = t2(1) + 
     &          (t1(1) - t2(1))*(5.5-Mag)
	else
	   tau_lnyB = t2T
	   tau_lnPGAB = t2(1)
	endif

      tau = SQRT(tau_lnyB**2 +  
     &           (alpha * tau_lnPGAB)**2 +
     &           2.0*alpha*rhoT*tau_lnyB*tau_lnPGAB)

      If (Mag.le.4.5) then
	   phi_lny = phi1T
           phi_lnPGAB = phi1(1)
      elseif (Mag.lt.5.5) then
	   phi_lny = phi2T + 
     &          (phi1T - phi2T)*(5.5-mag)
	   phi_lnPGAB = phi2(1) + 
     &          (phi1(1) - phi2(1))*(5.5-mag)
      else
	   phi_lny = phi2T 
	   phi_lnPGAB = phi2(1) 
      endif

      phi_lnyB = SQRT(phi_lny**2 - flnAFT**2)

      phi_lnPGAB = SQRT(phi_lnPGAB**2 - flnAF(1)**2)

      phi = SQRT(phi_lny**2 + 
     &           (alpha*phi_lnPGAB)**2 +
     &           2.0*alpha*rhoT*phi_lnyB*phi_lnPGAB)
	
      Sigmatot = SQRT(phi**2 + Tau**2)

      period2 = period1
      
C     Convert ground motion to units of gals.

      lnY = lnY + 6.89
      sigma = sigmaTot

      return
      END

c ---------------------------------------------------------------------            
C ** Chiou and Youngs (NGA West2-2013 Model) Horizontal **
C     Earthquake Spectra Paper:
C        Update of the Chiou and Youngs NGA Model for the
C            Average Horizontal Component of Peak
C            Ground Motion and Response Spectra
C         B. S.J. Chiou and R.R. Youngs
C     Notes:
C        Applicable Range (see Abstract):  
C           3.5 <= M <= 8.5 Strike-slip
C           3.5 <= M <= 8.0 Reverse and Normal
C           Rrup <= 300 km
C           Ztor <= 20 km
C           180m/s <= Vs30m <= 1500m/s
C           Mainshock events only
C        Regional attenuation included based on Regionflag
C             0 = Global
C             1 = Japan/Italy
C             2 = Wenchuan (note only applicable for M7.9 event)
C         Sigma dependent on estimated or measured Vs30m based on 
C             Vs30_Class
C             0 = Estimated Vs30m
C             1 = Measured Vs30m
c ---------------------------------------------------------------------            

      Subroutine CY_NGAWest2_2013 ( m, Rrup, Rbjf, specT,
     1                     period2, lnY, sigma, iflag, 
     2                     vs, Delta, DTor, Ftype, depthvs10, vs30_class,
     3                     hwflag, Rx, regionflag, phi, tau )

C     Last Updated: 8/1/13

      parameter (MAXPER=25)
      REAL Period(MAXPER), C1(MAXPER), C1a(MAXPER), C1b(MAXPER)
      REAL cn(MAXPER), cm(MAXPER), c5(MAXPER), c6(MAXPER)
      REAL c7(MAXPER), c9(MAXPER), gamma1(MAXPER), gamma2(MAXPER)
      REAL phi1(MAXPER), phi2(MAXPER), phi3(MAXPER), phi4(MAXPER)
      REAL phi5(MAXPER), phi6(MAXPER), phi1jp(MAXPER), phi5jp(MAXPER), phi6jp(MAXPER)
      REAL tau1(MAXPER), tau2(MAXPER), sigma1(MAXPER), sigma2(MAXPER)
      REAL sigma3(MAXPER), c9a(MAXPER)
      REAL c3(MAXPER), gm(MAXPER), c9b(MAXPER)
      Real CHM(MAXPER), C1c(MAXPER), C1d(MAXPER), C7b(MAXPER), C8b(MAXPER)
      real C11(MAXPER), C11B(MAXPER)
      real gscaleJapIt(MAXPER), gscaleWen(MAXPER), sigma2Jap(MAXPER)
 
      REAL c1T, c1aT, c1bT, cnT, cmT, c5T, c6T, c7T, c9T, c9aT, c3T
      REAL gamma1T, gamma2T, phi1T, phi2T, phi3T, phi4T, sigma3T
      REAL phi5T, phi6T, tau1T, tau2T, sigma1T, sigma2T
      real C1cT, C1dT, C7bT, C11T, C11bT, CHMT
      REAL c2, c4, c4a, cRB, pi, d2r, gamma, gmT, c9bT
      real cc, cosdelta, r1, r2, r3, r4, hw, psa_ref, psa, a, b, c
      integer iflag, count1, count2, hwflag, vs30_class, regionflag
      REAL M, RRUP, RBJF, DTOR, Delta, specT, sigma, Ftype, Rx
      REAL period2, lnY, F_RV, F_NM, depthvs10, tau, rkdepth
      real c8, c8a, c8bT, deltaZ1, fd
      real NL0, sigma_NL0, F_Measured, F_Inferred, mz_TOR, deltaZ_TOR, coshM
      real gscaleJapItT, gscaleWenT, sigma2JapT, phi
      real phi1jpT, phi5jpT, phi6jpT

      data period     /
     1              0.0000, 0.0100, 0.0200, 0.0300, 0.0400, 0.0500,
     1              0.0750, 0.1000, 0.1200, 0.1500, 0.1700,
     1              0.2000, 0.2500, 0.3000, 0.4000, 0.5000,
     1              0.7500, 1.0000, 1.5000, 2.0000, 3.0000,
     1              4.0000, 5.0000, 7.5000,10.0000/
      data c1      /
     1             -1.5065, -1.5065, -1.4798, -1.2972, -1.1007, -0.9292,
     1             -0.6580, -0.5613, -0.5342, -0.5462, -0.5858,
     1             -0.6798, -0.8663, -1.0514, -1.3794, -1.6508,
     1             -2.1511, -2.5365, -3.0686, -3.4148, -3.9013,
     1             -4.2466, -4.5143, -5.0009, -5.3461/
      data c1a     /
     1             0.1650,  0.1650,  0.1650,  0.1650,  0.1650,  0.1650,
     1             0.1650,  0.1650,  0.1650,  0.1650,  0.1650,
     1             0.1650,  0.1650,  0.1650,  0.1650,  0.1650,
     1             0.1650,  0.1650,  0.1650,  0.1645,  0.1168,
     1             0.0732,  0.0484,  0.0220,  0.0124/
      data c1b     /
     1             -0.2550, -0.2550, -0.2550, -0.2550, -0.2550, -0.2550,
     1             -0.2540, -0.2530, -0.2520, -0.2500, -0.2480,
     1             -0.2449, -0.2382, -0.2313, -0.2146, -0.1972,
     1             -0.1620, -0.1400, -0.1184, -0.1100, -0.1040,
     1             -0.1020, -0.1010, -0.1010, -0.1000/
      data c1c     /
     1             -0.1650, -0.1650, -0.1650, -0.1650, -0.1650, -0.1650,
     1             -0.1650, -0.1650, -0.1650, -0.1650, -0.1650,
     1             -0.1650, -0.1650, -0.1650, -0.1650, -0.1650,
     1             -0.1650, -0.1650, -0.1650, -0.1645, -0.1168,
     1             -0.0732, -0.0484, -0.0220, -0.0124/
      data c1d     /
     1              0.2550,  0.2550,  0.2550,  0.2550,  0.2550,  0.2550,
     1              0.2540,  0.2530,  0.2520,  0.2500,  0.2480,
     1              0.2449,  0.2382,  0.2313,  0.2146,  0.1972,
     1              0.1620,  0.1400,  0.1184,  0.1100,  0.1040,
     1              0.1020,  0.1010,  0.1010,  0.1000/
      data cn      /
     1             16.0875, 16.0875, 15.7118, 15.8819, 16.4556, 17.6453,
     1             20.1772, 19.9992, 18.7106, 16.6246, 15.3709,
     1             13.7012, 11.2667,  9.1908,  6.5459,  5.2305,
     1              3.7896,  3.3024,  2.8498,  2.5417,  2.1488,
     1              1.8957,  1.7228,  1.5737,  1.5265/
      data cM      /
     1             4.9993,  4.9993,  4.9993,  4.9993,  4.9993,  4.9993,
     1             5.0031,  5.0172,  5.0315,  5.0547,  5.0704,
     1             5.0939,  5.1315,  5.1670,  5.2317,  5.2893,
     1             5.4109,  5.5106,  5.6705,  5.7981,  5.9983,
     1             6.1552,  6.2856,  6.5428,  6.7415/
      data c3      /
     1             1.9636,  1.9636,  1.9636,  1.9636,  1.9636,  1.9636,
     1             1.9636,  1.9636,  1.9795,  2.0362,  2.0823,
     1             2.1521,  2.2574,  2.3440,  2.4709,  2.5567,
     1             2.6812,  2.7474,  2.8161,  2.8514,  2.8875,
     1             2.9058,  2.9169,  2.9320,  2.9396/
      data c5      /
     1             6.4551, 6.4551, 6.4551, 6.4551, 6.4551, 6.4551,
     1             6.4551, 6.8305, 7.1333, 7.3621, 7.4365,
     1             7.4972, 7.5416, 7.5600, 7.5735, 7.5778,
     1             7.5808, 7.5814, 7.5817, 7.5818, 7.5818,
     1             7.5818, 7.5818, 7.5818, 7.5818/
      data cHM     /
     1             3.0956, 3.0956, 3.0963, 3.0974, 3.0988, 3.1011,
     1             3.1094, 3.2381, 3.3407, 3.4300, 3.4688,
     1             3.5146, 3.5746, 3.6232, 3.6945, 3.7401,
     1             3.7941, 3.8144, 3.8284, 3.8330, 3.8361,
     1             3.8369, 3.8376, 3.8380, 3.8380/
      data c6      /
     1             0.4908,  0.4908,  0.4925,  0.4992,  0.5037, .5048,
     1             0.5048,  0.5048,  0.5048,  0.5045, .5036,
     1             0.5016,  0.4971,  0.4919,  0.4807, .4707,
     1             0.4575,  0.4522,  0.4501,  0.4500, .4500,
     1             0.4500,  0.4500,  0.4500,  0.4500/
      data c7      /
     1             0.0352, 0.0352, 0.0352, 0.0352, 0.0352, 0.0352,
     1             0.0352, 0.0352, 0.0352, 0.0352, 0.0352,
     1             0.0352, 0.0352, 0.0352, 0.0352, 0.0352,
     1             0.0352, 0.0352, 0.0352, 0.0352, 0.0160,
     1             0.0062, 0.0029, 0.0007, 0.0003/
      data c7b     /
     1             0.0462,  0.0462,  0.0472,  0.0533,  0.0596,  0.0639,
     1             0.0630,  0.0532,  0.0452,  0.0345,  0.0283,
     1             0.0202,  0.0090, -0.0004, -0.0155, -0.0278,
     1            -0.0477, -0.0559, -0.0630, -0.0665, -0.0516,
     1            -0.0448, -0.0424, -0.0348, -0.0253/
      data c8b     /
     1             0.4833,  0.4833,  1.2144,  1.6421,  1.9456,  2.1810,
     1             2.6087,  2.9122,  3.1045,  3.3399,  3.4719,
     1             3.6434,  3.8787,  4.0711,  4.3745,  4.6099,
     1             5.0376,  5.3411,  5.7688,  6.0723,  6.5000,
     1             6.8035,  7.0389,  7.4666,  7.7700/
      data c9      /
     1             0.9228,  0.9228,  0.9296,  0.9396,  0.9661,  0.9794,
     1             1.0260,  1.0177,  1.0008,  0.9801,  0.9652,
     1             0.9459,  0.9196,  0.8829,  0.8302,  0.7884,
     1             0.6754,  0.6196,  0.5101,  0.3917,  0.1244,
     1             0.0086,  0.0000,  0.0000,  0.0000/
      data c9a     /
     1             0.1202,  0.1202,  0.1217,  0.1194,  0.1166,  0.1176,
     1             0.1171,  0.1146,  0.1128,  0.1106,  0.1150,
     1             0.1208,  0.1208,  0.1175,  0.1060,  0.1061,
     1             0.1000,  0.1000,  0.1000,  0.1000,  0.1000,
     1             0.1000,  0.1000,  0.1000,  0.1000/
      data c9b     /
     1             6.8607,  6.8607,  6.8697,  6.9113,  7.0271,  7.0959,
     1             7.3298,  7.2588,  7.2372,  7.2109,  7.2491,
     1             7.2988,  7.3691,  6.8789,  6.5334,  6.5260,
     1             6.5000,  6.5000,  6.5000,  6.5000,  6.5000,
     1             6.5000,  6.5000,  6.5000,  6.5000/
      data c11     /
     1                0.0,     0.0,     0.0,     0.0,     0.0,     0.0,
     1                0.0,     0.0,     0.0,     0.0,     0.0,
     1                0.0,     0.0,     0.0,     0.0,     0.0,
     1                0.0,     0.0,     0.0,     0.0,     0.0,
     1                0.0,     0.0,     0.0,     0.0/
      data c11b    /
     1            -0.4536, -0.4536, -0.4536, -0.4536, -0.4536, -0.4536,
     1            -0.4536, -0.4536, -0.4536, -0.4536, -0.4536,
     1            -0.4440, -0.3539, -0.2688, -0.1793, -0.1428,
     1            -0.1138, -0.1062, -0.1020, -0.1009, -0.1003,
     1            -0.1001, -0.1001, -0.1000, -0.1000/
      data gamma1 /
     1            -0.007146, -0.007146, -0.007249, -0.007869, -0.008316, -0.008743,
     1            -0.009537, -0.009830, -0.009913, -0.009896, -0.009787,
     1            -0.009505, -0.008918, -0.008251, -0.007267, -0.006492,
     1            -0.005147, -0.004277, -0.002979, -0.002301, -0.001344,
     1            -0.001084, -0.001010, -0.000964, -0.000950/
      data gamma2 /
     1            -0.006758, -0.006758, -0.006758, -0.006758, -0.006758, -0.006758,
     1            -0.006190, -0.005332, -0.004732, -0.003806, -0.003280,
     1            -0.002690, -0.002128, -0.001812, -0.001274, -0.001074,
     1            -0.001115, -0.001197, -0.001675, -0.002349, -0.003306,
     1            -0.003566, -0.003640, -0.003686, -0.003700/
      data gm /
     1             4.2542,  4.2542,  4.2386,  4.2519,  4.2960,  4.3578,
     1             4.5455,  4.7603,  4.8963,  5.0644,  5.1371,
     1             5.1880,  5.2164,  5.1954,  5.0899,  4.7854,
     1             4.3304,  4.1667,  4.0029,  3.8949,  3.7928,
     1             3.7443,  3.7090,  3.6632,  3.6230/
      data phi1    /
     1             -0.5210, -0.5210, -0.5055, -0.4368, -0.3752, -0.3469,
     1             -0.3747, -0.4440, -0.4895, -0.5477, -0.5922,
     1             -0.6693, -0.7766, -0.8501, -0.9431, -1.0044,
     1             -1.0602, -1.0941, -1.1142, -1.1154, -1.1081,
     1             -1.0603, -0.9872, -0.8274, -0.7053/
      data phi2    /
     1             -0.1417, -0.1417, -0.1364, -0.1403, -0.1591, -0.1862,
     1             -0.2538, -0.2943, -0.3077, -0.3113, -0.3062,
     1             -0.2927, -0.2662, -0.2405, -0.1975, -0.1633,
     1             -0.1028, -0.0699, -0.0425, -0.0302, -0.0129,
     1             -0.0016,  0.0000,  0.0000,  0.0000/
      data phi3    /
     1             -0.007010,-0.007010,-0.007279,-0.007354,-0.006977,-0.006467,
     1             -0.005734,-0.005604,-0.005696,-0.005845,-0.005959,
     1             -0.006141,-0.006439,-0.006704,-0.007125,-0.007435,
     1             -0.008120,-0.008444,-0.007707,-0.004792,-0.001828,
     1             -0.001523,-0.001440,-0.001369,-0.001361/
      data phi4    /
     1              0.102151, 0.102151, 0.108360, 0.119888, 0.133641, 0.148927,
     1              0.190596, 0.230662, 0.253169, 0.266468, 0.265060,
     1              0.255253, 0.231541, 0.207277, 0.165464, 0.133828,
     1              0.085153, 0.058595, 0.031787, 0.019716, 0.009643,
     1              0.005379, 0.003223, 0.001134, 0.000515/
      data phi5    /
     1              0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000,
     1              0.0000, 0.0000, 0.0000, 0.0000, 0.0000,
     1              0.0000, 0.0000, 0.0010, 0.0040, 0.0100,
     1              0.0340, 0.0670, 0.1430, 0.2030, 0.2770,
     1              0.3090, 0.3210, 0.3290, 0.3300/
      data phi6    /
     1              300.00, 300.00, 300.00, 300.00, 300.00, 300.00,
     1              300.00, 300.00, 300.00, 300.00, 300.00,
     1              300.00, 300.00, 300.00, 300.00, 300.00,
     1              300.00, 300.00, 300.00, 300.00, 300.00,
     1              300.00, 300.00, 300.00, 300.00/
      data tau1    /
     1               0.4000,  0.4000,  0.4026,  0.4063,  0.4095,  0.4124,
     1               0.4179,  0.4219,  0.4244,  0.4275,  0.4292,
     1               0.4313,  0.4341,  0.4363,  0.4396,  0.4419,
     1               0.4459,  0.4484,  0.4515,  0.4534,  0.4558,
     1               0.4574,  0.4584,  0.4601,  0.4612/
      data tau2    /
     1               0.2600,  0.2600,  0.2637,  0.2689,  0.2736,  0.2777,
     1               0.2855,  0.2913,  0.2949,  0.2993,  0.3017,
     1               0.3047,  0.3087,  0.3119,  0.3165,  0.3199,
     1               0.3255,  0.3291,  0.3335,  0.3363,  0.3398,
     1               0.3419,  0.3435,  0.3459,  0.3474/
      data sigma1  /
     1               0.4912,  0.4912,  0.4904,  0.4988,  0.5049,  0.5096,
     1               0.5179,  0.5236,  0.5270,  0.5308,  0.5328,
     1               0.5351,  0.5377,  0.5395,  0.5422,  0.5433,
     1               0.5294,  0.5105,  0.4783,  0.4681,  0.4617,
     1               0.4571,  0.4535,  0.4471,  0.4426/
      data sigma2  /
     1               0.3762,  0.3762,  0.3762,  0.3849,  0.3910,  0.3957,
     1               0.4043,  0.4104,  0.4143,  0.4191,  0.4217,
     1               0.4252,  0.4299,  0.4338,  0.4399,  0.4446,
     1               0.4533,  0.4594,  0.4680,  0.4681,  0.4617,
     1               0.4571,  0.4535,  0.4471,  0.4426/
      data sigma3  /
     1               0.8000,  0.8000,  0.8000,  0.8000,  0.8000,  0.8000,
     1               0.8000,  0.8000,  0.8000,  0.8000,  0.8000,
     1               0.8000,  0.7999,  0.7997,  0.7988,  0.7966,
     1               0.7792,  0.7504,  0.7136,  0.7035,  0.7006,
     1               0.7001,  0.7000,  0.7000,  0.7000/

C     Regional Scale factors for gamma term and Phi1, Phi5, and Phi6 terms.
C     Japan/Italy
      data gscaleJapIt / 1.5817, 1.5817, 1.574, 1.5544, 1.5502, 1.5391, 1.4804, 1.4094, 
     1              1.3682, 1.3241, 1.3071, 1.2931, 1.315, 1.3514, 1.4051, 1.4402, 
     2              1.528, 1.6523, 1.8872, 2.1348, 3.5752, 3.8646, 3.7292, 2.3763, 
     3              1.7679 /
      data phi1Jp / -0.6846, -0.6846, -0.6681, -0.6314, -0.5855, -0.5457, -0.4685, 
     1              -0.4985, -0.5603, -0.6451, -0.6981, -0.7653, -0.8469, -0.8999, 
     2              -0.9618, -0.9945, -1.0225, -1.0002, -0.9245, -0.8626, -0.7882, 
     3              -0.7195, -0.656, -0.5202, -0.4068 /
      data phi5JP / 0.459, 0.459, 0.458, 0.462, 0.453, 0.436, 0.383, 0.375, 0.377, 
     1              0.379, 0.38, 0.384, 0.393, 0.408, 0.462, 0.524, 0.658, 0.78, 
     2              0.96, 1.11, 1.291, 1.387, 1.433, 1.46, 1.464 /
      data phi6JP / 800.0, 800.0, 800.0, 800.0, 800.0, 800.0, 800.0, 800.0, 800.0, 
     1              800.0, 800.0, 800.0, 800.0, 800.0, 800.0, 800.0, 800.0, 800.0, 
     2              800.0, 800.0, 800.0, 800.0, 800.0, 800.0, 800.0 /

C     Wenchuan
      data gscaleWen / 0.7594, 0.7594, 0.7606, 0.7642, 0.7676, 0.7739, 0.7956, 
     1              0.7932, 0.7768, 0.7437, 0.7219, 0.6922, 0.6579, 0.6362, 
     2              0.6049, 0.5507, 0.3582, 0.2003, 0.0356, 0.0, 0.0, 0.0, 
     3              0.0, 0.0, 0.0031 /

C     Sigma2 values for Japan
      data sigma2jap  /
     1               0.4528, 0.4528, 0.4551, 0.4571, 0.4642, 0.4716, 0.5022, 
     1               0.523,  0.5278, 0.5304, 0.531,  0.5312, 0.5309, 
     1               0.5307, 0.531,  0.5313, 0.5309, 0.5302, 0.5276,
     1               0.5167, 0.4917, 0.4682, 0.4517, 0.4167, 0.3755 /

C Find the requested spectral period and corresponding coefficients
      nPer = 25
C First check for the PGA case (i.e., specT=0.0) 
      if (specT .eq. 0.0) then
         period1  = period(1)
         c1T      = c1(1)
         c1aT     = c1a(1)
         c1bT     = c1b(1)
         c1cT     = c1c(1)
         c1dT     = c1d(1)
         c3T      = c3(1)
         cHMT     = CHM(1)
         cnT      = cn(1)
         cmT      = cm(1)
         c5T      = c5(1)
         c6T      = c6(1)
         c7T      = c7(1) 
         c7bT      = c7b(1) 
         c8bT      = c8b(1)
         c9T      = c9(1)
         c9aT      = c9a(1)
         c9bT      = c9b(1)
         c11T      = c11(1)
         c11bT      = c11b(1)
         gamma1T  = gamma1(1)
         gamma2T  = gamma2(1)
         gmT      = gm(1)
         phi1T    = phi1(1)
         phi2T    = phi2(1)
         phi3T    = phi3(1)
         phi4T    = phi4(1)
         phi5T    = phi5(1)
         phi6T    = phi6(1)
         tau1T    = tau1(1)
         tau2T    = tau2(1)
         sigma1T = sigma1(1)
         sigma2T = sigma2(1)
         sigma2JapT = sigma2Jap(1)
         sigma3T = sigma3(1)
         gscaleJapItT = gscaleJapIt(1)
         phi1jpT = phi1jp(1)
         phi5jpT = phi5jp(1)
         phi6jpT = phi6jp(1)
         gscaleWenT = gscaleWen(1)
         goto 1011
      elseif (specT .gt. 0.0) then
C Now loop over the spectral period range of the attenuation relationship.
         do i=2,nper-1
            if (specT .ge. period(i) .and. specT .le. period(i+1) ) then
               count1 = i
               count2 = i+1
               goto 1020 
            endif
         enddo
      endif

C Selected spectral period is outside range defined by attenuaton model.
      write (*,*) 
      write (*,*) 'Chiou and Youngs (NGA West2-2013) Horizontal'
      write (*,*) 'attenuation model is not defined for a '
      write (*,*) ' spectral period of: ' 
      write (*,'(a10,f10.5)') ' Period = ',specT
      write (*,*) 'This spectral period is outside the defined'
      write (*,*) 'period range in the code or beyond the range'
      write (*,*) 'of spectral periods for interpolation.'
      write (*,*) 'Please check the input file.'
      write (*,*) 
      stop 99

C Interpolate the coefficients for the requested spectral period.
 1020       call interp (period(count1),period(count2),c1(count1),c1(count2),
     +                   specT,c1T,iflag)
            call interp (period(count1),period(count2),c1a(count1),c1a(count2),
     +                   specT,c1aT,iflag)
            call interp (period(count1),period(count2),c1b(count1),c1b(count2),
     +                   specT,c1bT,iflag)
            call interp (period(count1),period(count2),c1c(count1),c1c(count2),
     +                   specT,c1cT,iflag)
            call interp (period(count1),period(count2),c1d(count1),c1d(count2),
     +                   specT,c1dT,iflag)
            call interp (period(count1),period(count2),cn(count1),cn(count2),
     +                   specT,cnT,iflag)
            call interp (period(count1),period(count2),cm(count1),cm(count2),
     +                   specT,cmT,iflag)
            call interp (period(count1),period(count2),cHM(count1),cHM(count2),
     +                   specT,cHMT,iflag)
            call interp (period(count1),period(count2),c3(count1),c3(count2),
     +                   specT,c3T,iflag)
            call interp (period(count1),period(count2),c5(count1),c5(count2),
     +                   specT,c5T,iflag)
            call interp (period(count1),period(count2),c6(count1),c6(count2),
     +                   specT,c6T,iflag)
            call interp (period(count1),period(count2),c7(count1),c7(count2),
     +                   specT,c7T,iflag)
            call interp (period(count1),period(count2),c7b(count1),c7b(count2),
     +                   specT,c7bT,iflag)
            call interp (period(count1),period(count2),c8b(count1),c8b(count2),
     +                   specT,c8bT,iflag)
            call interp (period(count1),period(count2),c9(count1),c9(count2),
     +                   specT,c9T,iflag)
            call interp (period(count1),period(count2),c9a(count1),c9a(count2),
     +                   specT,c9aT,iflag)
            call interp (period(count1),period(count2),c9b(count1),c9b(count2),
     +                   specT,c9bT,iflag)
            call interp (period(count1),period(count2),c11(count1),c11(count2),
     +                   specT,c11T,iflag)
            call interp (period(count1),period(count2),c11b(count1),c11b(count2),
     +                   specT,c11bT,iflag)
            call interp (period(count1),period(count2),gamma1(count1),gamma1(count2),
     +                   specT,gamma1T,iflag)
            call interp (period(count1),period(count2),gamma2(count1),gamma2(count2),
     +                   specT,gamma2T,iflag)
            call interp (period(count1),period(count2),gm(count1),gm(count2),
     +                   specT,gmT,iflag)
            call interp (period(count1),period(count2),phi1(count1),phi1(count2),
     +                   specT,phi1T,iflag)
            call interp (period(count1),period(count2),phi2(count1),phi2(count2),
     +                   specT,phi2T,iflag)
            call interp (period(count1),period(count2),phi3(count1),phi3(count2),
     +                   specT,phi3T,iflag)
            call interp (period(count1),period(count2),phi4(count1),phi4(count2),
     +                   specT,phi4T,iflag)
            call interp (period(count1),period(count2),phi5(count1),phi5(count2),
     +                   specT,phi5T,iflag)
            call interp (period(count1),period(count2),phi6(count1),phi6(count2),
     +                   specT,phi6T,iflag)
            call interp (period(count1),period(count2),tau1(count1),tau1(count2),
     +                   specT,tau1T,iflag)
            call interp (period(count1),period(count2),tau2(count1),tau2(count2),
     +                   specT,tau2T,iflag)
            call interp (period(count1),period(count2),sigma1(count1),sigma1(count2),
     +                   specT,sigma1T,iflag)
            call interp (period(count1),period(count2),sigma2(count1),sigma2(count2),
     +                   specT,sigma2T,iflag)
            call interp (period(count1),period(count2),sigma2Jap(count1),sigma2Jap(count2),
     +                   specT,sigma2JapT,iflag)
            call interp (period(count1),period(count2),sigma3(count1),sigma3(count2),
     +                   specT,sigma3T,iflag)
            call interp (period(count1),period(count2),gscaleJapIt(count1),gscaleJapIt(count2),
     +                   specT,gscaleJapItT,iflag)
            call interp (period(count1),period(count2),phi1jp(count1),phi1jp(count2),
     +                   specT,phi1jpT,iflag)
            call interp (period(count1),period(count2),phi5jp(count1),phi5jp(count2),
     +                   specT,phi5jpT,iflag)
            call interp (period(count1),period(count2),phi6jp(count1),phi6jp(count2),
     +                   specT,phi6jpT,iflag)
            call interp (period(count1),period(count2),gscaleWen(count1),gscaleWen(count2),
     +                   specT,gscaleWenT,iflag)

 1011 period1 = specT                                                                                                              

c     Set the fault mechanism term.
C     fType     Mechanism                      Rake
C     ------------------------------------------------------
C      -1       Normal                   -120 < Rake < -60.0
C     1, 0.5    Reverse and Rev/Obl        30 < Rake < 150.0
C     0,-0.5    Strike-Slip and NMl/Obl        Otherwise
         if (ftype .eq. -1) then
            F_RV = 0.0
            F_NM = 1.0
         elseif (ftype .ge. 0.5) then
            F_RV = 1.0
            F_NM = 0.0
         else
            F_RV = 0.0
            F_NM = 0.0
         endif

C     Constant terms
        c2 = 1.06
        c4 = -2.1
        c4a = -0.5
        cRB = 50.0
        c8 = 0.2154
        c8a = 0.2695

        pi = atan(1.0)*4.0
        d2r = pi/180.0

        cc = c5T* cosh(c6T * max((M-cHMT),0.0))
        gamma = gamma1T + gamma2T/cosh(max((M-gmT),0.0))
C     Apply Regional scaling factor.
C     Regionflag = 0 Global
C     Regionflag = 1 Japan and Italy
C        Also set sigma2 equal to Japan specific value
C     Regionflag = 2 Wenchuan (note only for M7.9)
        if (regionflag .eq. 1 ) then
           gamma = gamma * gscaleJapItT
           sigma2T = sigma2JapT
        elseif (regionflag .eq. 2) then
           gamma = gamma * gscaleWenT        
        endif

        cosDELTA = cos(abs(DELTA)*d2r)

c Magnitude scaling
        r1 = c1T + c2 * (M-6.0) +
     1       (c2-c3T)/cnT *
     1             alog(1.0 + exp(cnT*(cMT-M)))

c Near-field magnitude and distance scaling
        r2 = c4 * alog(Rrup + cc)

c Distance scaling at large distance
        r3 = (c4a-c4)/2.0 *
     1            alog( Rrup*Rrup+cRB*cRB ) +
     1       Rrup * gamma

c Center Z_TOR on the Z_TOR-M relation in Chiou and Youngs (2013)
        if (F_RV.EQ.1) then
          if (M .le. 5.849) then
              mZ_TOR = 2.704*2.704
          else
              mZ_TOR = max(2.704-1.226*(M-5.849), 0.0)
              mZ_TOR = mZ_TOR * mZ_TOR
          endif
        else
          if (M .le. 4.970) then
              mZ_TOR = 2.673*2.673
          else
              mZ_TOR = max(2.673-1.136*(M-4.970), 0.0)
              mZ_TOR = mZ_TOR * mZ_TOR
          endif
        endif
        deltaZ_TOR = Dtor - mZ_TOR
        
c Scaling with other source variables (F_RV, F_NM, deltaZ_TOR, and Dip)
        coshM = cosh(2*max(M-4.5,0.0))
        cosDELTA = cos(DELTA*d2r)
        r4 = (c1aT+c1cT/coshM) * F_RV +
     1       (c1bT+c1dT/coshM) * F_NM +
     1       (c7T +c7bT/coshM) * deltaZ_TOR +
     1       (c11T+c11bT/coshM)* cosDELTA**2
        
c HW effect
        if (HWFlag .eq. 0) then
           hw = 0.0
        else
         hw = c9T * (cosDELTA) * (c9aT+(1-c9aT)
     1        *tanh(Rx/c9bT)) *
     1          (1.0 - sqrt(Rbjf**2+DTor**2)/(Rrup + 1))
        endif

C     Current version of the code sets cDPP=0 (i.e., no directivity)
c Directivity effect
c        cDPP = 0.0
c        fd = c8T * exp(-c8aT * (M-c8bT)**2) *
c     1       max(0.0, 1.0-max(0.0,Rrup-40.0)/30.0) *
c     1       min(max(0.0,M-5.5)/0.8, 1.0) * cDPP

c Predicted median Sa on reference condition (Vs=1130 m/sec)
        psa_ref = r1+r2+r3+r4+hw+fd

C     Set Phi1, Phi5, and Phi6 term for Japan is region is requested
        if (regionflag .eq. 1) then
           phi1T = phi1jpT
           phi5T = phi5jpT
           phi6T = phi6jpT
        endif       
        
c Linear soil amplification
        a = phi1T * min(alog(Vs/1130.0), 0.0)

c Nonlinear soil amplification
        b = phi2T *
     1      (exp(phi3T*(min(Vs,1130.0)-360.0)) - exp(phi3T*(1130.0-360.0)))
        c = phi4T

C Deviation from ln(Vs30) scaling: bedrock depth (Z1) effect.
        if (regionflag .eq. 1) then
           deltaZ1 = depthvs10*1000.0 -
     1     exp(-5.23/2.0 * alog((VS**2.0 + 412.0**2.0)/(1360.0**2.0 + 412.0**2.0)))      
        else
           deltaZ1 = depthvs10*1000.0 -
c     1  exp(-7.15/4.0 * log((VS**4.0 + 570.94**4.0)/(1360.0**4.0 + 570.94**4.0)))
     1     exp(-7.15/4.0 * alog((VS**4.0 + 571.0**4.0)/(1360.0**4.0 + 571.0**4.0)))
        endif
        rkdepth = phi5T * ( 1.0 - exp(-deltaZ1/phi6T ) )

c Sa on soil condition
        psa = psa_ref + (a + b * alog((exp(psa_ref)+c)/c)) + rkdepth

C Compute the sigma term

        NL0 = b * exp(psa_ref)/(exp(psa_ref)+c)
        tau = tau1T +
     1            (tau2T-tau1T)/1.5*(min(max(M,5.0),6.5)-5.0)
        sigma_NL0 = sigma1T +
     1              (sigma2T-sigma1T)/1.5*(min(max(M,5.0),6.5)-5.0)
C     Current code set for Measured Vs30 values (i.e., Vs30class=1)
      if (vs30_class .eq. 0) then
         F_measured = 0.0
         F_Inferred = 1.0
      elseif (vs30_class .eq. 1) then      
         F_measured = 1.0
         F_Inferred = 0.0
      endif

        sigma_NL0 = sigma_NL0 *
     1        sqrt(0.7*F_Measured+F_Inferred*sigma3T+(1+NL0)**2.0)
        sigma = sqrt((tau*(1.0+NL0))**2.0+sigma_NL0**2.0)

      phi = sigma_NL0
      tau = (tau*(1.0+NL0))
      
C     Convert ground motion to units of gals.
      lnY = psa + 6.89
      period2 = period1

      return
      end 
  
c ------------------------------------------------------------------            
C *** Abrahamson, Silva, and Kamai (NGA-West2 2013) Horizontal ****
C     Earthquake Spectra Paper:
C        Summary of the Abrahamson, Silva, and Kamai NGA-West2 
C            Ground-Motion Relations for Active Crustal REgions
C         N. A. Abrahamson, S. J. Silva, and R. Kamai
C     Notes:
C        Applicable Range (see Abstract):  
C           3 <= M <= 8.5
C           Rrup <= 300 km
C        Regional attenuation included based on Regionflag
C             0 = Global
C             1 = Taiwan
C             2 = China
C             3 = Japan
C         Mainshock and Aftershocks included based on MSASFlag
C             0 = Mainshocks
C             1 = Aftershocks
C         Sigma dependent on estimated or measured Vs30m based on 
C             Vs30_Class
C             0 = Estimated Vs30m
C             1 = Measured Vs30m
c ------------------------------------------------------------------            
      subroutine ASK_NGAWest2_2013 ( mag, dip, fType, fltWidth, rRup, Rjb,  
     1                     vs30, hwflag, lnY, sigma, specT, period2, ztor,
     2                     iflag, vs30_class, z10, Rx, Ry0, regionflag, msasflag,
     1                     phi, tau )

C     Last Updated: 8/1/13

      implicit none

      real mag, dip, fType, rRup, rjb, Rx, Ry0, vs30, SA1180,
     1      Z10,  ZTOR, fltWidth, lnSa, sigma, lnY, vs30_rock
      real Fn, Frv, specT, period2, CRjb, phi, tau, z10_rock, SA_rock
      integer hwflag, iflag, vs30_class, regionflag, msasflag

c     Vs30 class is to distinguish between the sigma if the Vs30 is measured
c     vs the VS30 being estimated from surface geology.
c         Vs30_class = 0 for estimated
c         Vs30_class = 1 for measured 

C     Current version is not programmed for Aftershock cases. 
C       For implementation of Aftershock a new distance metric, CRjb
C       will need to be computed and passed along to this subroutine. 

      CRjb = 999.9 

C     Set mechanism term and corresponding Frv and Fnm values.     
C     fType     Mechanism                      Rake
C     ------------------------------------------------------
C      -1       Normal                   -120 < Rake < -60.0
C     1, 0.5    Reverse and Rev/Obl        30 < Rake < 150.0
C     0,-0.5    Strike-Slip and NMl/Obl        Otherwise
C 
      if ( fType .eq. 1.0 ) then
        Frv = 1.0
        Fn = 0.0
      elseif ( fType .eq. 0.5 ) then
        Frv = 1.0
        Fn = 0.0
      elseif ( fType .eq. -1.0 ) then
        Frv = 0.0
        Fn = 1.0
      elseif ( fType .eq. -0.5 ) then
        Frv = 0.0
        Fn = 1.0
      else
        Frv = 0.0
        Fn = 0.0
      endif

c     Compute SA1180
      vs30_rock = 1180.
      z10_rock = 0.005
      SA_rock = 0.
      
      call ASK2013_v11_model ( mag, dip, fltWidth, ZTOR, Frv, Fn, rRup, rjb, rx, Ry0, 
     1                     vs30_rock, SA_rock, Z10_rock, hwflag, vs30_class,
     2                     specT, lnSa, phi, tau, iflag, regionflag, msasflag, CRjb )
      Sa1180 = exp(lnSa)

c     Compute Sa at spectral period for given Vs30

      call ASK2013_v11_model ( mag, dip, fltWidth, ZTOR, Frv, Fn, rRup, rjb, rx, Ry0, 
     1                     vs30, SA1180, Z10, hwflag, vs30_class,
     2                     specT, lnSa, phi, tau, iflag, regionflag, msasflag, CRjb )

c     compute Sa (given the PGA rock value)
      sigma = sqrt( phi**2 + tau**2 )

      lnY = lnSa + 6.89

      period2 = specT

      return
      end

c ----------------------------------------------------------------------
      subroutine ASK2013_v11_model ( mag, dip, FltWidth, ZTOR, Frv, Fn, rRup, rjb, Rx, Ry0, 
     1                     vs30, Sa1180, Z1, hwflag, vs30_class,
     3                     specT, lnSa, phi, tau, iflag, regionflag, msasflag, CRjb)
 
      implicit none
      
      integer MAXPER     
      parameter (MAXPER=24)
      real Vlin(MAXPER), b(MAXPER), c4(MAXPER), M1(MAXPER), a1(MAXPER)
      real a2(MAXPER), a3(MAXPER), a6(MAXPER), a8(MAXPER), a10(MAXPER)
      real a11(MAXPER), a12(MAXPER), a13(MAXPER), a14(MAXPER), a15(MAXPER)
      real a17(MAXPER), a43(MAXPER), a44(MAXPER), a45(MAXPER), a46(MAXPER)
      real a25(MAXPER), a28(MAXPER), a29(MAXPER), a31(MAXPER), a36(MAXPER)
      real a37(MAXPER), a38(MAXPER), a39(MAXPER), a40(MAXPER), a41(MAXPER), a42(MAXPER)
      real s1est(MAXPER), s2est(MAXPER), s1msr(MAXPER), s2msr(MAXPER)
      real s3(MAXPER), s4(MAXPER), s5(MAXPER), s6(MAXPER), period(MAXPER)
      real a4, a5, a7
      real VlinT, bT, c4T, M1T, a1T
      real a2T, a3T, a6T, a8T, a10T
      real a11T, a12T, a13T, a14T, a15T
      real a17T, a43T, a44T, a45T, a46T
      real a25T, a28T, a29T, a31T, a36T
      real a37T, a38T, a39T, a40T, a41T, a42T
      real s1estT, s2estT, s1msrT, s2msrT
      real s3T, s4T, s5T, s6T, c4_mag
      real phiA_est, phiA_msr, period1
      
      real M2
      real lnSa, SA1180, rjb, rRup, Rx, Ry0, dip, mag, vs30
      real HW_taper1, HW_taper2, HW_taper3, HW_taper4, HW_taper5
      real damp_dSA1180, sigAmp, fltWidth
      real f1, f4, f5, f6, f7, f8, f9, f10, f11, fReg, f12, f13
      real Ry1, ZTOR, Frv, Fn, SpecT
      real phiA, phiB, tauA, tauB, phi, tau
      integer vs30_class, hwflag, iflag, nPer, regionflag, msasflag
      real n, c, z1, z1_ref
      real R, V1, Vs30Star, hw_a2, h1, h2, h3, R1, R2, CRjb
      integer count1, count2, i
      real y1, y2, x1, x2, y1z, y2z, x1z, x2z

      data Period / 0.000, -1.000, 0.010, 0.020, 0.030, 0.050, 0.075, 0.100, 0.150,
     1       0.200, 0.250, 0.300, 0.400, 0.500, 0.750, 1.000, 1.500, 2.000, 3.000, 
     2       4.000, 5.000, 6.000, 7.500, 10.000 /
c      data Vlin / 660.0, 330.0, 660.0, 680.0, 770.0, 800.0, 800.0, 800.0, 740.0, 590.0,
c     1       495.0, 430.0, 360.0, 340.0, 330.0, 330.0, 330.0, 330.0, 330.0, 330.0, 330.0,
c     2       330.0, 330.0, 330.0 /
      data Vlin / 660.0, 330.0, 660.0, 680.0, 770.0, 915.0, 960.0, 910.0, 740.0, 590.0,
     1       495.0, 430.0, 360.0, 340.0, 330.0, 330.0, 330.0, 330.0, 330.0, 330.0, 330.0,
     2       330.0, 330.0, 330.0 /
      data b / -1.470, -2.020, -1.470, -1.459, -1.390, -1.219, -1.152, -1.230, -1.587, 
     1      -2.012, -2.411, -2.757, -3.278, -3.599, -3.800, -3.500, -2.400, -1.000, 0.000, 
     2      0.000, 0.000, 0.000, 0.000, 0.000 /
      data c4 / 4.5, 4.5, 4.5, 4.5, 4.5, 4.5, 4.5, 4.5, 4.5, 4.5, 4.5, 4.5, 4.5, 4.5, 4.5, 
     1      4.5, 4.5, 4.5, 4.5, 4.5, 4.5, 4.5, 4.5, 4.5 /
      data M1 / 6.75, 6.75, 6.75, 6.75, 6.75, 6.75, 6.75, 6.75, 6.75, 6.75, 6.75, 6.75, 6.75,
     1      6.75, 6.75, 6.75, 6.75, 6.75, 6.82, 6.92, 7.0, 7.06, 7.15, 7.25 /
c      data a1 / 0.587, 5.975, 0.587, 0.598, 0.602, 0.746, 1.021, 1.210, 1.442, 1.637, 1.701, 
c     1      1.712, 1.662, 1.571, 1.299, 1.043, 0.665, 0.329, -0.060, -0.299, -0.562, -0.875, -1.303, -1.928 /
      data a1 / 0.587, 5.975, 0.587, 0.598, 0.602, 0.707, 0.973, 1.169, 1.442, 1.637, 1.701, 
     1      1.712, 1.662, 1.571, 1.299, 1.043, 0.665, 0.329, -0.060, -0.299, -0.562, -0.875, -1.303, -1.928 /
      data a2 / -0.790, -0.919, -0.790, -0.790, -0.790, -0.790, -0.790, -0.790, -0.790, -0.790,
     1      -0.790, -0.790, -0.790, -0.790, -0.790, -0.790, -0.790, -0.790, -0.790, -0.790, 
     2      -0.765, -0.711, -0.634, -0.529 /
      data a3 / 0.275, 0.275, 0.275, 0.275, 0.275, 0.275, 0.275, 0.275, 0.275, 0.275, 0.275,
     1       0.275, 0.275, 0.275, 0.275, 0.275, 0.275, 0.275, 0.275, 0.275, 0.275, 0.275, 
     2       0.275, 0.275 /
      data a6 / 2.154, 2.366, 2.154, 2.146, 2.157, 2.085, 2.029, 2.041, 2.121, 2.224, 
     1       2.312, 2.338, 2.469, 2.559, 2.682, 2.763, 2.836, 2.897, 2.906, 2.889, 
     2       2.898, 2.896, 2.870, 2.843 /
      data a8 / -0.015, -0.094, -0.015, -0.015, -0.015, -0.015, -0.015, -0.015, -0.022, 
     1       -0.03, -0.038, -0.045, -0.055, -0.065, -0.095, -0.11, -0.124, -0.138, -0.172,
     2       -0.197, -0.218, -0.235, -0.255, -0.285 /
      data a10 / 1.735, 2.360, 1.735, 1.718, 1.615, 1.358, 1.258, 1.310, 1.660, 2.220, 2.770,
     1        3.250, 3.990, 4.450, 4.750, 4.300, 2.600, 0.550, -0.950, -0.950, -0.930, -0.910,
     2       -0.870, -0.800 /
      data a11 / 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
     1        0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0 /
      data a12 / -0.1, -0.1, -0.1, -0.1, -0.1, -0.1, -0.1, -0.1, -0.1, -0.1, -0.1, -0.1, 
     1       -0.1, -0.1, -0.1, -0.1, -0.1, -0.1, -0.1, -0.1, -0.1, -0.2, -0.2, -0.2 /
      data a13 / 0.6, 0.25, 0.6, 0.6, 0.6, 0.6, 0.6, 0.6, 0.6, 0.6, 0.6, 0.6, 0.58, 0.56, 
     1        0.53, 0.5, 0.42, 0.35, 0.2, 0.0, 0.0, 0.0, 0.0, 0.0 /
      data a14 / -0.3, 0.22, -0.3, -0.3, -0.3, -0.3, -0.3, -0.3, -0.3, -0.3, -0.24, -0.19,
     1        -0.11, -0.04, 0.07, 0.15, 0.27, 0.35, 0.46, 0.54, 0.61, 0.65, 0.72, 0.8 /
      data a15 / 1.1, 0.3, 1.1, 1.1, 1.1, 1.1, 1.1, 1.1, 1.1, 1.1, 1.1, 1.03, 0.92, 0.84, 0.68,
     1         0.57, 0.42, 0.31, 0.16, 0.05, -0.04, -0.11, -0.19, -0.3 /
      data a17 / -0.0072, -0.0005, -0.0072, -0.0073, -0.0075, -0.0080, -0.0089, -0.0095, 
     1       -0.0095, -0.0086, -0.0074, -0.0064, -0.0043, -0.0032, -0.0025, -0.0025, -0.0022,
     2       -0.0019, -0.0015, -0.0010, -0.0010, -0.0010, -0.0010, -0.0010 /
      data a25 / -0.0015, -0.0001, -0.0015, -0.0015, -0.0016, -0.0020, -0.0027, -0.0033, 
     1       -0.0035, -0.0033, -0.0029, -0.0027, -0.0023, -0.0020, -0.0010, -0.0005, -0.0004,
     2       -0.0002, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0 /
      data a28 / 0.0025, 0.0005, 0.0025, 0.0024, 0.0023, 0.0027, 0.0032, 0.0036, 0.0033, 
     1        0.0027, 0.0024, 0.0020, 0.0010, 0.0008, 0.0007, 0.0007, 0.0006, 0.0003, 
     2        0.0, 0.0, 0.0, 0.0, 0.0, 0.0 /
      data a29 / -0.0034, -0.0037, -0.0034, -0.0033, -0.0034, -0.0033, -0.0029, -0.0025,
     1        -0.0025, -0.0031, -0.0036, -0.0039, -0.0048, -0.0050, -0.0041, -0.0032, 
     2        -0.0020, -0.0017, -0.0020, -0.0020, -0.0020, -0.0020, -0.0020, -0.0020 /
      data a31 / -0.1503, -0.1462, -0.1503, -0.1479, -0.1447, -0.1326, -0.1353, -0.1128, 
     1       0.0383, 0.0775, 0.0741, 0.2548, 0.2136, 0.1542, 0.0787, 0.0476, -0.0163, -0.1203, 
     2      -0.2719, -0.2958, -0.2718, -0.2517, -0.1400, -0.0216 /
      data a36 / 0.265, 0.377, 0.265, 0.255, 0.249, 0.202, 0.126, 0.022, -0.136, -0.078, 0.037,
     1       -0.091, 0.129, 0.310, 0.505, 0.358, 0.131, 0.123, 0.109, 0.135, 0.189, 
     2        0.215, 0.150, 0.092 /
      data a37 / 0.337, 0.212, 0.337, 0.328, 0.320, 0.289, 0.275, 0.256, 0.162, 0.224, 
     1        0.248, 0.203, 0.232, 0.252, 0.208, 0.208, 0.108, 0.068, -0.023, 0.028, 
     2        0.031, 0.024, -0.070, -0.159 /
      data a38 / 0.188, 0.157, 0.188, 0.184, 0.180, 0.167, 0.173, 0.189, 0.108, 0.115,
     1        0.122, 0.096, 0.123, 0.134, 0.129, 0.152, 0.118, 0.119, 0.093, 0.084, 0.058, 
     2        0.065, 0.000, -0.050 /
      data a39 / 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
     1           0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0 /
      data a40 / 0.088, 0.095, 0.088, 0.088, 0.093, 0.133, 0.186, 0.160, 0.068, 0.048, 0.055, 
     1         0.073, 0.143, 0.160, 0.158, 0.145, 0.131, 0.083, 0.070, 0.101, 0.095, 0.133,
     2         0.151, 0.124 /
      data a41 / -0.196, -0.038, -0.196, -0.194, -0.175, -0.090, 0.090, 0.006, -0.156,
     1        -0.274, -0.248, -0.203, -0.154, -0.159, -0.141, -0.144, -0.126, -0.075, 
     2        -0.021, 0.072, 0.205, 0.285, 0.329, 0.301 /
      data a42 / 0.044, 0.065, 0.044, 0.061, 0.162, 0.451, 0.506, 0.335, -0.084, -0.178,
     1        -0.187, -0.159, -0.023, -0.029, 0.061, 0.062, 0.037, -0.143, -0.028, -0.097, 
     2         0.015, 0.104, 0.299, 0.243 /
      data a43 / 0.1, 0.28, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1,
     1        0.14, 0.17, 0.22, 0.26, 0.34, 0.41, 0.51, 0.55, 0.49, 0.42 /
      data a44 / 0.05, 0.15, 0.05, 0.05, 0.05, 0.05, 0.05, 0.05, 0.05, 0.05, 0.05, 0.05,
     1        0.07, 0.1, 0.14, 0.17, 0.21, 0.25, 0.3, 0.32, 0.32, 0.32, 0.275, 0.22 /
      data a45 / 0.0, 0.09, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.03, 0.06, 0.1, 
     1        0.14, 0.17, 0.2, 0.22, 0.23, 0.23, 0.22, 0.2, 0.17, 0.14 /
      data a46 / -0.05, 0.07, -0.05, -0.05, -0.05, -0.05, -0.05, -0.05, -0.05, -0.03, 0.0,
     1        0.03, 0.06, 0.09, 0.13, 0.14, 0.16, 0.16, 0.16, 0.14, 0.13, 0.1, 0.09, 0.08 /
      data s1est / 0.754, 0.662, 0.754, 0.760, 0.781, 0.810, 0.810, 0.810, 0.801, 0.789,
     1        0.770, 0.740, 0.699, 0.676, 0.631, 0.609, 0.578, 0.555, 0.548, 0.527, 0.505,
     2        0.477, 0.457, 0.429 /
      data s2est / 0.520, 0.51, 0.520, 0.520, 0.520, 0.530, 0.540, 0.550, 0.560, 0.565,
     1        0.570, 0.580, 0.590, 0.600, 0.615, 0.630, 0.640, 0.650, 0.640, 0.630, 0.630,
     2        0.630, 0.630, 0.630 /
      data s1msr / 0.741, 0.66, 0.741, 0.747, 0.769, 0.798, 0.798, 0.795, 0.773, 0.753,
     1        0.729, 0.693, 0.644, 0.616, 0.566, 0.541, 0.506, 0.48, 0.472, 0.447, 0.425,
     2        0.395, 0.378, 0.359 /
      data s2msr / 0.501, 0.51, 0.501, 0.501, 0.501, 0.512, 0.522, 0.527, 0.519, 0.514,
     1        0.513, 0.519, 0.524, 0.532, 0.548, 0.565, 0.576, 0.587, 0.576, 0.565, 0.568,
     2        0.571, 0.575, 0.585 /
      data s3 / 0.47, 0.38, 0.47, 0.47, 0.47, 0.47, 0.47, 0.47, 0.47, 0.47, 0.47, 0.47,
     1         0.47, 0.47, 0.47, 0.47, 0.47, 0.47, 0.47, 0.47, 0.47, 0.47, 0.47, 0.47 /
      data s4 / 0.36, 0.38, 0.36, 0.36, 0.36, 0.36, 0.36, 0.36, 0.36, 0.36, 0.36, 0.36, 
     1         0.36, 0.36, 0.36, 0.36, 0.36, 0.36, 0.36, 0.36, 0.36, 0.36, 0.36, 0.36 /
      data s5 / 0.54, 0.58, 0.54, 0.54, 0.55, 0.56, 0.57, 0.57, 0.58, 0.59, 0.61, 0.63,
     1         0.66, 0.69, 0.73, 0.77, 0.8, 0.8, 0.8, 0.76, 0.72, 0.7, 0.67, 0.64 /
      data s6 / 0.63, 0.53, 0.63, 0.63, 0.63, 0.65, 0.69, 0.7, 0.7, 0.7, 0.7, 0.7, 0.7,
     1         0.7, 0.69, 0.68, 0.66, 0.62, 0.55, 0.52, 0.5, 0.5, 0.5, 0.5 /

C Find the requested spectral period and corresponding coefficients
      nPer = 24

C First check for the PGA, PGV, PGD cases 
      if (specT .eq. 0.0) then
         period1 = period(1)
         a1T = a1(1)
         a2T = a2(1)
         a3T = a3(1)
         a6T = a6(1)
         a8T = a8(1)
         M1T = M1(1)
         a10T = a10(1)
         a11T = a11(1)
         a12T = a12(1)
         a13T = a13(1)
         a14T = a14(1)
         a15T = a15(1)
         a17T = a17(1)
         a43T = a43(1)
         a44T = a44(1)
         a45T = a45(1)
         a46T = a46(1)
         a25T = a25(1)
         a28T = a28(1)
         a29T = a29(1)
         a31T = a31(1)
         a36T = a36(1)
         a37T = a37(1)
         a38T = a38(1)
         a39T = a39(1)
         a40T = a40(1)
         a41T = a41(1)
         a42T = a42(1)
         VlinT = Vlin(1)
         bT = b(1)
         c4T = c4(1)
         s1estT = s1est(1)
         s2estT = s2est(1)
         s1msrT = s1msr(1)
         s2msrT = s2msr(1)
         s3T = s3(1)
         s4T = s4(1)
         s5T = s5(1)
         s6T = s6(1)
         goto 1011
      elseif (specT .eq. -1.0) then
         period1 = period(2)
         a1T = a1(2)
         a2T = a2(2)
         a3T = a3(2)
         a6T = a6(2)
         a8T = a8(2)
         M1T = M1(2)
         a10T = a10(2)
         a11T = a11(2)
         a12T = a12(2)
         a13T = a13(2)
         a14T = a14(2)
         a15T = a15(2)
         a17T = a17(2)
         a43T = a43(2)
         a44T = a44(2)
         a45T = a45(2)
         a46T = a46(2)
         a25T = a25(2)
         a28T = a28(2)
         a29T = a29(2)
         a31T = a31(2)
         a36T = a36(2)
         a37T = a37(2)
         a38T = a38(2)
         a39T = a39(2)
         a40T = a40(2)
         a41T = a41(2)
         a42T = a42(2)
         VlinT = Vlin(2)
         bT = b(2)
         c4T = c4(2)
         s1estT = s1est(2)
         s2estT = s2est(2)
         s1msrT = s1msr(2)
         s2msrT = s2msr(2)
         s3T = s3(2)
         s4T = s4(2)
         s5T = s5(2)
         s6T = s6(2)
         goto 1011
      endif
C   For other periods, loop over the spectral period range of the attenuation relationship.
      do i=3,nper-1
         if (specT .ge. period(i) .and. specT .le. period(i+1) ) then
            count1 = i
            count2 = i+1
            goto 1020 
         endif
      enddo

C Selected spectral period is outside range defined by attenuaton model.
      write (*,*) 
      write (*,*) 'Abrahamson, Silva, and Kamai (NGA West2-2013) Horizontal'
      write (*,*) 'attenuation model is not defined for a '
      write (*,*) ' spectral period of: ' 
      write (*,'(a10,f10.5)') ' Period = ',specT
      write (*,*) 'This spectral period is outside the defined'
      write (*,*) 'period range in the code or beyond the range'
      write (*,*) 'of spectral periods for interpolation.'
      write (*,*) 'Please check the input file.'
      write (*,*) 
      stop 99

C Interpolate the coefficients for the requested spectral period.
 1020       call interp (period(count1),period(count2),a1(count1),a1(count2),
     +                   specT,a1T,iflag)
            call interp (period(count1),period(count2),a2(count1),a2(count2),
     +                   specT,a2T,iflag)
            call interp (period(count1),period(count2),a3(count1),a3(count2),
     +                   specT,a3T,iflag)
            call interp (period(count1),period(count2),a6(count1),a6(count2),
     +                   specT,a6T,iflag)
            call interp (period(count1),period(count2),a8(count1),a8(count2),
     +                   specT,a8T,iflag)
            call interp (period(count1),period(count2),M1(count1),M1(count2),
     +                   specT,M1T,iflag)
            call interp (period(count1),period(count2),a10(count1),a10(count2),
     +                   specT,a10T,iflag)
            call interp (period(count1),period(count2),a11(count1),a11(count2),
     +                   specT,a11T,iflag)
            call interp (period(count1),period(count2),a12(count1),a12(count2),
     +                   specT,a12T,iflag)
            call interp (period(count1),period(count2),a13(count1),a13(count2),
     +                   specT,a13T,iflag)
            call interp (period(count1),period(count2),a14(count1),a14(count2),
     +                   specT,a14T,iflag)
            call interp (period(count1),period(count2),a15(count1),a15(count2),
     +                   specT,a15T,iflag)
            call interp (period(count1),period(count2),a17(count1),a17(count2),
     +                   specT,a17T,iflag)
            call interp (period(count1),period(count2),a43(count1),a43(count2),
     +                   specT,a43T,iflag)
            call interp (period(count1),period(count2),a44(count1),a44(count2),
     +                   specT,a44T,iflag)
            call interp (period(count1),period(count2),a45(count1),a45(count2),
     +                   specT,a45T,iflag)
            call interp (period(count1),period(count2),a46(count1),a46(count2),
     +                   specT,a46T,iflag)
            call interp (period(count1),period(count2),a25(count1),a25(count2),
     +                   specT,a25T,iflag)
            call interp (period(count1),period(count2),a28(count1),a28(count2),
     +                   specT,a28T,iflag)
            call interp (period(count1),period(count2),a29(count1),a29(count2),
     +                   specT,a29T,iflag)
            call interp (period(count1),period(count2),a31(count1),a31(count2),
     +                   specT,a31T,iflag)
            call interp (period(count1),period(count2),a36(count1),a36(count2),
     +                   specT,a36T,iflag)
            call interp (period(count1),period(count2),a37(count1),a37(count2),
     +                   specT,a37T,iflag)
            call interp (period(count1),period(count2),a38(count1),a38(count2),
     +                   specT,a38T,iflag)
            call interp (period(count1),period(count2),a39(count1),a39(count2),
     +                   specT,a39T,iflag)
            call interp (period(count1),period(count2),a40(count1),a40(count2),
     +                   specT,a40T,iflag)
            call interp (period(count1),period(count2),a41(count1),a41(count2),
     +                   specT,a41T,iflag)
            call interp (period(count1),period(count2),a42(count1),a42(count2),
     +                   specT,a42T,iflag)
            call interp (period(count1),period(count2),Vlin(count1),Vlin(count2),
     +                   specT,VlinT,iflag)
            call interp (period(count1),period(count2),b(count1),b(count2),
     +                   specT,bT,iflag)
            call interp (period(count1),period(count2),c4(count1),c4(count2),
     +                   specT,c4T,iflag)
            call interp (period(count1),period(count2),s1est(count1),s1est(count2),
     +                   specT,s1estT,iflag)
            call interp (period(count1),period(count2),s2est(count1),s2est(count2),
     +                   specT,s2estT,iflag)
            call interp (period(count1),period(count2),s1msr(count1),s1msr(count2),
     +                   specT,s1msrT,iflag)
            call interp (period(count1),period(count2),s2msr(count1),s2msr(count2),
     +                   specT,s2msrT,iflag)
            call interp (period(count1),period(count2),s3(count1),s3(count2),
     +                   specT,s3T,iflag)
            call interp (period(count1),period(count2),s4(count1),s4(count2),
     +                   specT,s4T,iflag)
            call interp (period(count1),period(count2),s5(count1),s5(count2),
     +                   specT,s5T,iflag)
            call interp (period(count1),period(count2),s6(count1),s6(count2),
     +                   specT,s6T,iflag)

 1011 period1 = specT                                                                                                              

C     Constant values
      n = 1.5
      M2 = 5.0
      a4 = -0.1
      a5 = -0.41
      a7 = 0.0

C     Set C term
      if (period1 .eq. -1.0) then
         c = 2400.0
      else
         c = 2.4
      endif

C     Magnitude dependent taper for C4 (eq. 4.4)
      if (mag .ge. 5.0) then
         c4_mag = c4T
      elseif (mag .ge. 4.0) then
         c4_mag = c4T - (c4T-1.0) * (5.0-mag)
      else
         c4_mag = 1.0
      endif 
     
c     Set distance (eq 4.3)
      R = sqrt(rRup**2 + c4_mag**2)
       	  
C     Base Model (eq 4.2)
      if ( mag .lt. M2 ) then
        f1 = a1T + a6T*(Mag-M2) + a7*(Mag-M2)**2 + a4*(M2-M1T) + a8T*(8.5-M2)**2 +
     1                (a2T + a3T*(M2-M1T)) * alog(R) + a17T*Rrup
      elseif ( mag .lt. M1T ) then
        f1 = a1T + a4*(Mag-M1T) + a8T*(8.5-Mag)**2 + (a2T + a3T*(Mag-M1T)) * alog(R) + a17T*Rrup
      else
        f1 = a1T + a5*(Mag-M1T) + a8T*(8.5-Mag)**2 + (a2T + a3T*(Mag-M1T)) * alog(R) + a17T*Rrup
      endif

c     style of faulting (eq 4.5 and 4.6) 
      if ( mag .lt. 4. ) then
        f7 = 0
        f8 = 0
      elseif ( mag .le. 5. ) then
        f7 = Frv * a11T * (mag-4.)
        f8 = Fn * a12T * (mag-4.)
      else 
        f7 = Frv * a11T
        f8 = Fn * a12T
      endif

c     ZTOR (eq 14)
      if (ZTOR .le. 20.) then 
        f6 = a15T * ZTOR/20.0
      else
        f6 = a15T
      endif    

c     Set VS30_star (eq 4.8 and 4.9)
      if ( specT .ge. 3.0 ) then
        V1 = 800.
      elseif ( specT .gt. 0.5 ) then
        V1 = exp( -0.35 * alog(specT/0.5)  + alog(1500.) )
      else
        V1=1500.
      endif      
      if ( vs30 .lt. v1 ) then
         vs30Star = vs30
      else
	vs30Star = v1
      endif		

c     Compute site amplification (Eq. 4.7)  
      if (vs30 .lt. vLinT) then
        f5 = a10T*alog(vs30Star/vLinT) - bT*alog(c+Sa1180) 
     1              + bT*alog(Sa1180+c*((vs30Star/vLinT)**(n)) )
      else
     	f5 = (a10T + bT*n) * alog(vs30Star/vLinT)
      endif

c     Set Regional z1 reference (eq 4.18)
      if (regionflag .ne. 3) then
         z1_ref = exp ( -7.67/4. * alog( (Vs30**4 + 610.**4)/(1360.**4+610.**4) ) ) / 1000.
      else
         z1_ref = exp ( -5.23/2. * alog( (Vs30**2 + 412.**2)/(1360.**2+412.**2) ) ) / 1000.
      endif 
      
C     Soil Depth Model (eq 4.17)
C     Updated 8/1/13
      if ( vs30 .le. 150.0 ) then
         y1z = a43T
         y2z = a43T 
         x1z = 50.0
         x2z = 150.0
      elseif ( vs30 .le. 250.0 ) then
         y1z = a43T
         y2z = a44T 
         x1z = 150.0
         x2z = 250.0
      elseif ( vs30 .le. 400.0 ) then
         y1z = a44T
         y2z = a45T 
         x1z = 250.0
         x2z = 400.0
      elseif ( vs30 .le. 700.0 ) then
         y1z = a45T
         y2z = a46T 
         x1z = 400.0
         x2z = 700.0
      else
         y1z = a46T
         y2z = a46T 
         x1z = 700.0
         x2z = 1000.0
      endif
C     Calculation f10 term and set it equal to zero for Vs=1180m/s (i.e., reference condition)
      if (vs30 .eq. 1180.0) then
          f10 = 0.0
      else
         f10 = ( y1z + (Vs30-x1z)*(y2z-y1z)/(x2z-x1z))*alog( (z1 + 0.01) / (z1_ref+0.01) )
      endif

c     Compute HW taper1 (eq 4.11) 
      if ( dip .le. 30. ) then
        HW_taper1 = 60./ 45.
      else
        HW_taper1 = (90.-dip)/45.
      endif

c     Compute HW taper2 (eq. 4.12)
      hw_a2 = 0.2
      if( mag .gt. 6.5 ) then
        HW_taper2 = 1. + hw_a2 * (mag-6.5) 
      elseif ( mag .gt. 5.5 ) then
        HW_taper2 = 1. + HW_a2 * (mag-6.5) - (1.0 - HW_a2)*(mag-6.5)**2
      else
        HW_taper2 = 0.
      endif

c     Compute HW taper 3 (eq. 4.13)
C	  April 11, correction by ronnie for HW_taper3 when Rx.gt.R2
      h1 = 0.25
      h2 = 1.5
      h3 = -0.75
      R1 = fltWidth * cos(dip*3.1415926/180.)
      R2 = 3.*R1
      if ( Rx .le. R1 ) then
        HW_taper3 = h1 + h2*(Rx/R1) + h3*(Rx/R1)**2
      elseif ( Rx . lt. R2 ) then
        HW_taper3 = 1. - (Rx-R1)/(R2-R1)
      else
        HW_taper3 = 0.
      endif 

c     Compute HW taper 4 (eq 4.14)
      if ( ZTOR .lt. 10. ) then
        HW_taper4 = 1. - (ZTOR**2) / 100.
      else
        HW_taper4 = 0.
      endif
      
c     Compute HW taper 5 (eq. 13)  **** Ry0 version ***
      Ry1 = Rx * tan(20.*3.1415926/180.)
      if ( Ry0 .lt. Ry1 ) then
        HW_taper5 = 1.
      elseif ( Ry0-Ry1 .lt. 5. ) then
        HW_taper5 = 1. - (Ry0-Ry1) / 5.
      else
        HW_taper5 = 0.
      endif

c     Compute HW taper 5 (eq. 4.15b)  **** No Ry0 version ***     
c      if (Rjb .eq. 0. ) then
c        HW_taper5 = 1. 
c      elseif ( Rjb .lt. 30. ) then
c        HW_taper5 = 1 - Rjb/30.
c      else
c        HW_taper5 = 0.
c      endif

c     Hanging wall Model (eq 4.10)
      if ( HWFlag .eq. 1 ) then
        f4 = a13T * HW_taper1 * HW_taper2 * HW_taper3 * HW_taper4 * HW_taper5
      else
        f4 = 0.
      endif

C     Add aftershock factor (eq 4.21)
      if (msasflag .eq. 1) then
         if (CRjb .gt. 15.0) then
             f11 = 0.0
         elseif (CRjb .le. 5.0) then
             f11 = a14T
         else
             f11 = a14T * ( 1.0 - (CRjb - 5.0) /10.0) 
         endif
      elseif (msasflag .eq. 0) then
         f11 = 0.0
      endif 

C     Now apply the regional attenuation differences (eq 4.22)
C     Global No Change
      if (regionflag .eq. 0) then
         freg = 0.0
C     Taiwan
      elseif (regionflag .eq. 1) then
         f12 = a31T * alog(Vs30star/VlinT) 
         freg = f12 + a25T*Rrup 
C     China
      elseif (regionflag .eq. 2) then
         freg = a28T*Rrup 
C     Japan
      elseif (regionflag .eq. 3) then
         if (vs30 .lt. 150.0) then
             y1 = a36T
             y2 = a36T
             x1 = 50.0
             x2 = 150.0
         elseif (vs30 .lt. 250.0) then
             y1 = a36T
             y2 = a37T
             x1 = 150.0
             x2 = 250.0
         elseif (vs30 .lt. 350.0) then
             y1 = a37T
             y2 = a38T
             x1 = 250.0
             x2 = 350.0
         elseif (vs30 .lt. 450.0) then
             y1 = a38T
             y2 = a39T
             x1 = 350.0
             x2 = 450.0
         elseif (vs30 .lt. 600.0) then
             y1 = a39T
             y2 = a40T
             x1 = 450.0
             x2 = 600.0
         elseif (vs30 .lt. 850.0) then
             y1 = a40T
             y2 = a41T
             x1 = 600.0
             x2 = 850.0
         elseif (vs30 .lt. 1150.0) then
             y1 = a41T
             y2 = a42T
             x1 = 850.0
             x2 = 1150.0
         else
             y1 = a42T
             y2 = a42T
             x1 = 1150.0
             x2 = 3000.0
         endif
         f13 = y1 + (y2-y1)/(x2-x1) * (vs30-x1)
         freg = f13 + a29T*Rrup 
      endif

C     Set the Sigma Values
      if (regionflag .ne. 3)  then
c     Compute within-event term, phiA, at the surface for linear site response (eq 7.1)
        if (mag .lt. 4.0) then
           phiA_est = s1estT
        elseif (mag .le. 6.0) then
           phiA_est = s1estT + ((s2estT-s1estT)/2.0)*(mag-4.0)
        else
           phiA_est = s2estT
        endif

c     Compute within-event term, phiA, for known Vs30
        if (mag .lt. 4.0) then
           phiA_msr = s1msrT
        elseif (mag .le. 6.0) then
           phiA_msr = s1msrT + ((s2msrT-s1msrT)/2.0)*(mag-4.0)
        else
           phiA_msr = s2msrT
        endif

C     choose phiA by Vs30 class
        if (vs30_class .eq. 0 ) then
	     phiA = phiA_est
        elseif (vs30_class .eq. 1) then
	     phiA = phiA_msr
        else
	     stop 99
        endif

C     Set Sigma values for Japan Region
      else

C calculate phi_A for Japan (eq. 7.3)
        if (Rrup .lt. 30) then
           phiA = s5T        
        elseif (Rrup .le. 80) then
           phiA = s5T + (s6T-s5T)/50*(Rrup-30)
        else
           phiA = s6T
        endif
      endif
	  
c     Compute between-event term, tau (eq. 7.2)
      if (mag .lt. 5.0) then
         tauA = s3T
      elseif (mag .le. 7.0) then
         tauA = s3T + ((s4T-s3T)/2.0)*(mag-5.0)
      else
         tauA = s4T
      endif
      tauB = tauA

c     Compute phiB, within-event term with site amp variablity removed (eq. 7.7)
      sigAmp = 0.4
      phiB = sqrt( phiA**2 - sigAmp**2)
      
c     Compute parital derivative of alog(soil amp) w.r.t. alog(Sa1180) (eq. 7.10)
      if ( vs30 .ge. vLinT) then
        dAmp_dSa1180 = 0.
      else
        dAmp_dSa1180 = bT*Sa1180 * ( -1. / (Sa1180+c) 
     1              + 1./ (Sa1180 + c*(vs30/vLinT)**(n)) )
      endif

C     Compute phi, with non-linear effects (eq. 7.8)
      phi = sqrt( phiB**2 * (1. + dAmp_dSa1180)**2 + sigAmp**2 )

C     Compute tau, with non-linear effects (eq. 7.9)
      tau = tauB * (1. + dAmp_dSa1180)
      
c     Compute median ground motion (eq. 1)
      lnSa = f1 + f4 + f5 + f6 + f7 + f8 + f9 + f10 + f11 + freg 

      return
      end
 
 

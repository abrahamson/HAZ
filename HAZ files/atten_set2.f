C     Various Attenuation Models
c ---------------------------------------------------------------------            
      Subroutine Ambraseys_2005 ( m, dist, ftype, specT,
     1                     period2, lnY, sigma, iflag )

      implicit none

      integer MAXPER, iflag, count1, count2, nPer, i
      parameter (MAXPER=62)
      real Period(MAXPER), a1(MAXPER), a2(MAXPER), a3(MAXPER), a4(MAXPER),  
     1     a5(MAXPER), a6(MAXPER), a7(MAXPER), a8(MAXPER), a9(MAXPER), 
     2     a10(MAXPER), sig1_a(MAXPER), sig1_b(MAXPER), sig2_a(MAXPER), 
     3     sig2_b(MAXPER), M, Dist, period2, ftype, SS, SA, Fn, Ft, Fo, 
     4     logY, sig1, sig2, lnY, sigma, a1T, a2T, a3T, a4T, a5T, a6T 
      real a7T, a8T, a9T, a10T, sig1_aT, sig1_bT, sig2_aT, sig2_bT,
     1     period1, specT

      data period / 0.000, 0.050, 0.055, 0.060, 0.065, 0.070, 0.075, 0.080, 
     1           0.085, 0.090, 0.095, 0.100, 0.110, 0.120, 0.130, 0.140, 
     2           0.150, 0.160, 0.170, 0.180, 0.190, 0.200, 0.220, 0.240,
     3           0.260, 0.280, 0.300, 0.320, 0.340, 0.360, 0.380, 0.400, 
     4           0.420, 0.440, 0.460, 0.480, 0.500, 0.550, 0.600, 0.650, 
     5           0.700, 0.750, 0.800, 0.850, 0.900, 0.950, 1.000, 1.100,
     6           1.200, 1.300, 1.400, 1.500, 1.600, 1.700, 1.800, 1.900,
     7           2.000, 2.100, 2.200, 2.300, 2.400, 2.500 /
      data a1  / 2.522, 3.247, 3.125, 3.202, 3.442, 3.504, 3.472, 3.526, 
     1           3.320, 3.309, 3.479, 3.596, 3.453, 3.330, 3.249, 2.993, 
     2           2.725, 2.738, 2.692, 2.665, 2.713, 2.632, 2.483, 2.212, 
     3           2.058, 1.896, 1.739, 1.728, 1.598, 1.477, 1.236, 1.070, 
     4           0.998, 1.045, 0.980, 0.874, 0.624, 0.377, 0.359, 0.130,
     5          -0.014, -0.307, -0.567, -0.519, -0.485, -1.133, -1.359, -1.675,
     6          -1.982, -2.226, -2.419, -2.639, -2.900, -2.695, -3.209, -3.313,
     7          -3.063, -3.043, -3.068, -3.996, -4.108, -4.203 /
      
      data a2 / -0.142, -0.225, -0.206, -0.212, -0.242, -0.249, -0.240, -0.248,
     1          -0.215, -0.211, -0.240, -0.258, -0.239, -0.214, -0.195, -0.154,
     2          -0.111, -0.120, -0.114, -0.110, -0.118, -0.109, -0.088, -0.051, 
     3          -0.036, -0.010, 0.009, 0.001, 0.020, 0.034, 0.071, 0.091, 
     4           0.096, 0.085, 0.093, 0.103, 0.139, 0.174, 0.158, 0.182, 
     5           0.198, 0.236, 0.279, 0.262, 0.249, 0.369, 0.403, 0.437,
     6           0.477, 0.511, 0.533, 0.550, 0.587, 0.564, 0.630, 0.647, 
     7           0.586, 0.578, 0.575, 0.740, 0.758, 0.768 /

      data a3 / -3.184, -3.525, -3.418, -3.444, -3.571, -3.576, -3.521, -3.520,
     1          -3.381, -3.353, -3.420, -3.511, -3.398, -3.300, -3.254, -3.088, 
     2          -2.909, -2.912, -2.907, -2.907, -2.989, -2.990, -2.941, -2.823,
     3          -2.878, -2.732, -2.667, -2.688, -2.667, -2.641, -2.534, -2.474, 
     4          -2.469, -2.540, -2.564, -2.530, -2.410, -2.317, -2.343, -2.294,
     5          -2.305, -2.201, -2.083, -2.177, -2.246, -1.957, -1.848, -1.711, 
     6          -1.636, -1.605, -1.541, -1.443, -1.351, -1.564, -1.410, -1.424, 
     7          -1.372, -1.435, -1.448, -0.829, -0.755, -0.714 /

      data a4 /  0.314, 0.359, 0.345, 0.347, 0.365, 0.367, 0.358, 0.358, 
     1           0.336, 0.332, 0.345, 0.360, 0.345, 0.329, 0.321, 0.297, 
     2           0.270, 0.274, 0.275, 0.276, 0.288, 0.289, 0.281, 0.265, 
     3           0.263, 0.251, 0.244, 0.251, 0.246, 0.244, 0.227, 0.219, 
     4           0.220, 0.231, 0.234, 0.231, 0.212, 0.196, 0.206, 0.202, 
     5           0.205, 0.191, 0.170, 0.186, 0.199, 0.143, 0.124, 0.108, 
     6           0.095, 0.089, 0.080, 0.074, 0.060, 0.086, 0.069, 0.067, 
     7           0.070, 0.080, 0.083, -0.025, -0.038, -0.044 /
     
      data a5 /  7.6, 7.4, 7.1, 7.4, 7.7, 7.9, 8.0, 8.1, 8.0, 7.9, 7.8, 
     1           7.9, 7.9, 8.0, 8.2, 8.2, 8.3, 8.2, 8.2, 8.1, 8.1, 8.1, 
     2           7.9, 7.6, 7.3, 7.5, 7.1, 7.1, 7.2, 6.9, 6.7, 6.3, 5.9, 
     3           6.3, 6.3, 6.2, 6.1, 6.1, 5.4, 5.0, 4.8, 4.7, 5.2, 4.9, 
     4           4.5, 5.5, 6.0, 5.5, 5.4, 5.5, 6.0, 4.9, 5.2, 6.5, 5.4, 
     5           5.9, 4.2, 4.3, 4.2, 5.1, 5.3, 5.1 /
     
      data a6 /  0.137, 0.098, 0.085, 0.079, 0.069, 0.064, 0.064, 0.069, 
     1           0.067, 0.064, 0.062, 0.065, 0.077, 0.070, 0.069, 0.065, 
     2           0.067, 0.085, 0.091, 0.098, 0.112, 0.124, 0.136, 0.156, 
     3           0.179, 0.193, 0.192, 0.207, 0.216, 0.230, 0.247, 0.256, 
     4           0.259, 0.269, 0.278, 0.286, 0.289, 0.293, 0.311, 0.318, 
     5           0.327, 0.318, 0.332, 0.341, 0.354, 0.353, 0.357, 0.373, 
     6           0.389, 0.395, 0.408, 0.405, 0.387, 0.380, 0.391, 0.386, 
     7           0.421, 0.404, 0.394, 0.349, 0.338, 0.325 /
     
      data a7 /  0.050, 0.005, 0.004, 0.002, 0.001, -0.002, -0.003, -0.002, 
     1           0.010, 0.014, 0.014, 0.025, 0.041, 0.045, 0.043, 0.042, 
     2           0.044, 0.049, 0.053, 0.049, 0.059, 0.070, 0.078, 0.087, 
     3           0.077, 0.074, 0.069, 0.073, 0.078, 0.091, 0.100, 0.097, 
     4           0.100, 0.114, 0.122, 0.130, 0.133, 0.137, 0.136, 0.149, 
     5           0.154, 0.148, 0.178, 0.183, 0.191, 0.204, 0.211, 0.213, 
     6           0.226, 0.215, 0.237, 0.229, 0.216, 0.212, 0.174, 0.175, 
     7           0.177, 0.171, 0.160, 0.135, 0.119, 0.103 /

      data  a8 / -0.084, -0.096, -0.096, -0.103, -0.104, -0.114, -0.121, -0.116,
     1           -0.116, -0.119, -0.107, -0.095, -0.082, -0.081, -0.084, -0.074,
     2           -0.074, -0.069, -0.059, -0.057, -0.050, -0.033, -0.033, -0.037, 
     3           -0.024, -0.023, -0.034, -0.021, -0.010, -0.013, -0.010, -0.013, 
     4           -0.021, -0.016, -0.011, 0.001, 0.004, -0.004, 0.008, 0.005,
     5           -0.011, -0.001, -0.003, 0.005, -0.003, -0.025, -0.013, -0.029,
     6           -0.014, -0.004, 0.028, 0.020, 0.019, 0.001, 0.012, 0.030, 
     7            0.008, 0.002, -0.007, -0.010, -0.024, -0.026 /
     
      data  a9 /  0.062, 0.078, 0.072, 0.073, 0.076, 0.068, 0.063, 0.074,
     1            0.075, 0.065, 0.073, 0.076, 0.072, 0.065, 0.056, 0.053, 
     2            0.067, 0.090, 0.087, 0.087, 0.090, 0.090, 0.086, 0.090,
     3            0.120, 0.112, 0.104, 0.118, 0.118, 0.107, 0.106, 0.115,
     4            0.116, 0.114, 0.108, 0.118, 0.126, 0.118, 0.118, 0.107, 
     5            0.105, 0.114, 0.083, 0.085, 0.072, 0.024, 0.024, -0.007,
     6           -0.017, -0.025, -0.040, -0.053, -0.056, -0.081, -0.035, -0.033,
     7           -0.019, -0.026, -0.034, -0.031, -0.050, -0.063 /

      data a10 / -0.044, -0.048, -0.050, -0.047, -0.035, -0.043, -0.046, -0.040,
     1           -0.039, -0.048, -0.051, -0.047, -0.052, -0.046, -0.059, -0.067, 
     2           -0.060, -0.061, -0.055, -0.054, -0.054, -0.039, -0.024, -0.020,
     3            0.010, 0.027, 0.012, 0.008, 0.005, -0.011, -0.018, -0.020,
     4           -0.024, -0.028, -0.029, -0.024, -0.026, -0.035, -0.028, -0.031,
     5           -0.032, -0.032, -0.062, -0.070, -0.082, -0.109, -0.101, -0.108,
     6           -0.095, -0.085, -0.091, -0.113, -0.131, -0.141, -0.154, -0.145, 
     7           -0.174, -0.164, -0.169, -0.125, -0.147, -0.155 /

      data sig1_a / 0.665, 0.708, 0.672, 0.687, 0.693, 0.647, 0.674, 0.756, 
     1              0.750, 0.727, 0.772, 0.747, 0.810, 0.753, 0.712, 0.650, 
     2              0.634, 0.724, 0.760, 0.736, 0.752, 0.784, 0.778, 0.770, 
     3              0.917, 0.947, 0.890, 0.917, 0.896, 0.846, 0.803, 0.793, 
     4              0.757, 0.787, 0.766, 0.778, 0.798, 0.841, 0.919, 0.867, 
     5              0.803, 0.774, 0.661, 0.694, 0.714, 0.309, 0.305, 0.306, 
     6              0.297, 0.296, 0.290, 0.292, 0.296, 0.302, 0.291, 0.290, 
     7              0.282, 0.281, 0.283, 0.282, 0.284, 0.285 /

      data sig1_b / -0.065, -0.069, -0.063, -0.065, -0.067, -0.059, -0.063, -0.076,
     1              -0.076, -0.072, -0.079, -0.075, -0.084, -0.075, -0.068, -0.059,
     2              -0.057, -0.072, -0.077, -0.073, -0.076, -0.080, -0.079, -0.077, 
     3              -0.101, -0.104, -0.095, -0.098, -0.095, -0.087, -0.080, -0.078,
     4              -0.072, -0.077, -0.074, -0.076, -0.079, -0.085, -0.099, -0.090, 
     5              -0.080, -0.076, -0.059, -0.064, -0.067, 0.000, 0.000, 0.000,
     6               0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 
     7               0.000, 0.000, 0.000, 0.000, 0.000, 0.000 /
     
      data sig2_a /  0.222, 0.249, 0.235, 0.237, 0.241, 0.225, 0.227, 0.252, 
     1               0.258, 0.249, 0.262, 0.249, 0.256, 0.240, 0.236, 0.218, 
     2               0.223, 0.251, 0.257, 0.251, 0.250, 0.251, 0.244, 0.235, 
     3               0.278, 0.285, 0.267, 0.273, 0.261, 0.254, 0.250, 0.244, 
     4               0.233, 0.241, 0.238, 0.240, 0.246, 0.268, 0.308, 0.301, 
     5               0.298, 0.278, 0.240, 0.253, 0.263, 0.121, 0.120, 0.118, 
     6               0.120, 0.119, 0.115, 0.111, 0.114, 0.117, 0.128, 0.133, 
     7               0.134, 0.134, 0.136, 0.137, 0.137, 0.137 /
     
      data sig2_b / -0.022, -0.024, -0.022, -0.023, -0.023, -0.021, -0.021, -0.025,
     1              -0.026, -0.025, -0.027, -0.025, -0.027, -0.024, -0.023, -0.020, 
     2              -0.020, -0.025, -0.026, -0.025, -0.025, -0.026, -0.025, -0.024,
     3              -0.030, -0.031, -0.028, -0.029, -0.028, -0.026, -0.025, -0.024,
     4              -0.022, -0.024, -0.023, -0.023, -0.024, -0.027, -0.033, -0.031, 
     5              -0.030, -0.027, -0.021, -0.023, -0.025, 0.000, 0.000, 0.000, 
     6               0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000,
     7               0.000, 0.000, 0.000, 0.000, 0.000, 0.000 /

C Find the requested spectral period and corresponding coefficients
      nPer = 62
C First check for the PGA case (i.e., specT=0.0) 
      if (specT .eq. 0.0) then
         period1 = period(1)
         a1T     = a1(1)
         a2T     = a2(1)
         a3T     = a3(1)
         a4T     = a4(1)
         a5T     = a5(1)
         a6T     = a6(1)
         a7T     = a7(1)
         a8T     = a8(1)
         a9T     = a9(1)
         a10T    = a10(1)
         sig1_aT = sig1_a(1)
         sig1_bT = sig1_b(1)
         sig2_aT = sig2_a(1)
         sig2_bT = sig2_b(1)
         goto 1011
         
      elseif (specT .gt. 0.0) then
C Now loop over the spectral period range of the attenuation relationship.
         do i=2,nPer-1
            if (specT .ge. period(i) .and. specT .le. period(i+1) ) then
               count1 = i
               count2 = i+1
               goto 1020 
            endif
         enddo
      endif

C Selected spectral period is outside range defined by attenuaton model.
      write (*,*) 
      write (*,*) 'Ambreseys et al 2005 Horizontal '
      write (*,*) 'attenuation model is not defined for a '
      write (*,*) ' spectral period of: ' 
      write (*,'(a10,f10.5)') ' Period = ',specT
      write (*,*) 'This spectral period is outside the defined'
      write (*,*) 'period range in the code or beyond the range'
      write (*,*) 'of spectral periods for interpolation.'
      write (*,*) 'Please check the input file.'
      write (*,*) 
      stop 99

C Interpolate the coefficients for the requested spectral period.
 1020       call interp (period(count1),period(count2),a1(count1),a1(count2),
     +                   specT,a1T,iflag)
            call interp (period(count1),period(count2),a2(count1),a2(count2),
     +                   specT,a2T,iflag)
            call interp (period(count1),period(count2),a3(count1),a3(count2),
     +                   specT,a3T,iflag)
            call interp (period(count1),period(count2),a4(count1),a4(count2),
     +                   specT,a4T,iflag)
            call interp (period(count1),period(count2),a5(count1),a5(count2),
     +                   specT,a5T,iflag)
            call interp (period(count1),period(count2),a6(count1),a6(count2),
     +                   specT,a6T,iflag)
            call interp (period(count1),period(count2),a7(count1),a7(count2),
     +                   specT,a7T,iflag)
            call interp (period(count1),period(count2),a8(count1),a8(count2),
     +                   specT,a8T,iflag)
            call interp (period(count1),period(count2),a9(count1),a9(count2),
     +                   specT,a9T,iflag)
            call interp (period(count1),period(count2),a10(count1),a10(count2),
     +                   specT,a10T,iflag)
            call interp (period(count1),period(count2),sig1_a(count1),sig1_a(count2),
     +                   specT,sig1_aT,iflag)
            call interp (period(count1),period(count2),sig1_b(count1),sig1_b(count2),
     +                   specT,sig1_bT,iflag)
            call interp (period(count1),period(count2),sig2_a(count1),sig2_a(count2),
     +                   specT,sig2_aT,iflag)
            call interp (period(count1),period(count2),sig2_b(count1),sig2_b(count2),
     +                   specT,sig2_bT,iflag)

 1011 period1 = specT                                                                                                              

C.....Compute the Ground motion.......

C.....Set the mechanism term.....................
c     Fo is for "odd" 
c     Don't know what to do with that.
      if (ftype .eq. 1.0) then
        Fn = 0.
        Fo = 0
        Ft = 1.
       elseif ( ftype .eq. -1. ) then
        Fn = 1.
        Fo = 0
        Ft = 0.
       else
        Fn = 0.
        Fo = 0
        Ft = 0.
       endif        

      ss = 0.0
      sa = 0.0
 
      logY = a1T + a2T*m +(a3T+a4T*m)*alog10(sqrt(dist**2+a5T**2))
     1       + a6T*Ss + a7T*Sa + a8T*Fn + a9T*Ft + a10T*Fo

C     Convert from m/s^2 to units of gals.
      logY = logY + 2. 

c     Convert median to natural log units
      lnY = logY*alog(10.0)

C     Compute Sigma 
      sig1 = sig1_aT + sig1_bT*m
      sig2 = sig2_aT + sig2_bT*m
      sigma = sqrt( sig1**2 + sig2**2)      

c     Convert sigma to ln units
      sigma = sigma * alog(10.)
      
      period2 = period1

      return
      end 


